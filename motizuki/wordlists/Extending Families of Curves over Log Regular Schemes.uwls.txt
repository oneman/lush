Extending
Families
of
Curves
over
Log
Regular
Schemes
by
Shinichi
Mochizuki
Abstract:
In
this
paper,
we
generalize
to
the
“log
regular
case”
a
result
of
de
Jong
and
Oort
which
states
that
any
morphism
(satisfying
certain
conditions)
from
the
complement
of
a
divisor
with
normal
crossings
in
a
regular
scheme
to
a
moduli
stack
of
stable
curves
extends
over
the
entire
regular
scheme.
The
proof
uses
the
theory
of
“regular
log
schemes
”
–
i.e.,
schemes
with
singularities
like
those
of
toric
varieties
–
due
to
K.
Kato
([9]).
We
then
use
this
extension
theorem
to
prove
that
(under
certain
natural
conditions)
any
scheme
which
is
a
successive
ﬁbration
of
smooth
hyperbolic
curves
may
be
compactiﬁed
to
a
successive
ﬁbration
of
stable
curves.
1991
Mathematics
Subject
Classiﬁcation:
Primary
subject:
14H10;
Secondary
Subject:
14E15.
§0.
Introduction
In
[9],
K.
Kato
introduced
the
notion
of
a
pair
(X,
DX
)
with
toric
singularities.
Roughly
speaking,
such
a
pair
consists
of
a
normal
scheme
X
and
a
divisor
DX
⊆
X
in
that
scheme
whose
singularities
are
modeled
on
the
same
sort
of
combinatorial
data
as
that
classically
used
to
describe
toric
varieties
(as
in
[17]).
Unlike
the
case
of
toric
varieties,
however,
where
there
is
a
base
ﬁeld,
the
notion
of
toric
singularities
as
in
[9]
is
absolute,
and
hence
does
not
require
one
to
work
over
any
speciﬁc
base.
Moreover,
Kato
associates
to
such
a
pair
(X,
DX
)
a
log
scheme
(X,
MX
)
(as
in
[8]).
Pairs
(X,
DX
)
with
toric
singularities
correspond
to
log
schemes
(X,
MX
)
which
are
log
regular.
Thus,
in
particular,
toric
varieties
over
a
ﬁeld
deﬁne
(log)
regular
log
schemes
–
in
fact,
the
theory
of
regular
log
schemes
which
are
varieties
over
a
ﬁeld
is
essentially
equivalent
to
the
theory
of
varieties
with
toroidal
singularities
(i.e.,
varieties
that
are
étale
locally
isomorphic
to
toric
varieties)
over
that
ﬁeld.
Alternatively,
one
may
think
of
log
regular
(X,
MX
)
as
a
sort
of
natural
“logarithmic
generalization”
of
the
classical
notion
of
a
pair
(X,
DX
)
where
X
is
regular
and
DX
is
a
divisor
with
normal
crossings.
In
[7],
it
is
shown
that:
If
X
is
regular,
and
DX
is
a
divisor
with
normal
crossings
in
X,
then
def
any
morphism
from
UX
=
X
−
DX
to
a
moduli
stack
Mg,r
of
pointed
1
stable
curves
(cf.
[3],
[10])
that
extends
to
the
generic
points
of
DX
and
maps
UX
into
the
open
substack
Mg,r
⊆
Mg,r
of
smooth
curves
necessarily
extends
to
a
morphism
X
→
Mg,r
.
In
the
present
paper,
we
generalize
this
result
of
de
Jong-Oort
to
the
case
of
pair
(X,
UX
)
with
arbitrary
toric
singularities:
Theorem
A.
(Extension
Theorem)
Let
(X,
M
)
be
a
regular
log
scheme.
Let
UX
⊆
X
be
the
interior
of
X,
i.e.,
the
open
subscheme
where
the
log
structure
M
is
trivial.
Write
c
def
def
M
=
Mg,r
,
M
=
Mg,r
.
Let
M
be
the
coarse
moduli
space
associated
to
Mg,r
.
Suppose
that
we
are
given
a
morphism
hUX
:
UX
→
M
c
which
satisﬁes
hUX
(UX
)
⊆
M.
Let
us
denote
by
hcUX
:
UX
→
M
the
composite
of
hUX
c
with
M
→
M
.
Then:
(1)
If
hUX
extends
over
the
generic
points
of
DX
,
then:
(i)
hcUX
extends
to
X;
(ii)
there
exists
a
surjective,
quasi-ﬁnite,
log
étale
morphism
(Y,
N
)
→
(X,
M
)
(where
(Y,
N
)
is
log
regular)
such
that
hUX
extends
over
Y
.
(2)
If
hUX
extends
over
all
points
of
X
of
height
≤
2,
and
X
is
a
local
complete
intersection,
then
hUX
extends
to
X.
(3)
If
for
some
l
≥
3
which
is
invertible
on
X,
hUX
admits
a
level
l
structure
(cf.
Deﬁnition
5.6),
then
hUX
extends
to
X.
Theorem
A
is
given
as
Theorem
6.1
in
the
text.
It
generalizes
Theorem
5.1
of
[7],
but
we
use
this
result
of
[7]
in
the
proof
of
Theorem
A
(so
we
do
not
obtain
a
new
proof
of
the
main
result
of
[7]).
Indeed,
the
proof
of
Theorem
A
runs
as
follows:
If
(X,
M
)
is
log
regular,
then
(étale
locally
on
X)
one
may
blow-up
(X,
M
)
to
obtain
a
log
regular
(Y,
N
)
such
that
Y
is
regular
and
the
divisor
DY
where
the
log
structure
N
is
nontrivial
is
a
divisor
with
normal
crossings.
Then
one
would
like
to
apply
the
main
result
of
[7]
to
(Y,
N
).
Unfortunately,
this
cannot
be
done
immediately
because
when
one
restricts
the
original
morphism
hUX
:
UX
→
M
to
UY
,
the
resulting
morphism
hUY
:
UY
→
M
no
longer
satisﬁes
the
same
hypotheses
as
hUX
at
the
generic
points
of
the
divisor
DY
.
In
order
to
get
around
this
technical
diﬃculty,
it
is
necessary
to
make
use
of
the
log
purity
theorem:
2
Theorem
B.
(Log
Purity
Theorem)
Let
(X,
M
)
be
a
regular
log
scheme.
Let
UY
→
UX
be
a
ﬁnite
étale
covering
of
the
interior
UX
of
X
which
is
tamely
ramiﬁed
over
the
generic
points
of
DX
→
X.
Let
Y
be
the
normalization
of
X
in
UY
.
Then
the
pair
(Y,
UY
)
is
toric
(cf.
Deﬁnition
1.2),
hence
deﬁnes
a
regular
log
scheme
(Y,
N
).
Moreover,
UY
→
UX
extends
uniquely
to
a
log
étale
morphism
(Y,
N
)
→
(X,
M
).
This
result
is
given
as
Theorem
3.3
in
the
text.
It
is
the
“log
regular
analogue”
of
the
classical
purity
theorem
which
states
that
if
X
is
a
regular
scheme,
and
U
⊆
X
is
an
open
subscheme
such
that
the
codimension
in
X
of
X
−
U
is
≥
2,
then
any
ﬁnite
étale
covering
of
U
extends
(uniquely)
to
a
ﬁnite
étale
covering
of
X.
It
was
proven
originally
by
K.
Kato
([5]).
Since,
however,
Kato’s
proof
is
not
widely
available
in
written
form,
and,
moreover,
this
log
purity
result
plays
an
essential
role
in
the
proof
of
Theorem
A,
we
decided
to
give
an
independent
treatment
of
Theorem
B
in
the
present
paper.
In
fact,
the
author
discovered
Theorem
B
(independently
of
the
work
of
Kato)
in
the
course
of
trying
to
prove
Theorem
A,
and
only
afterwards
(as
a
result
of
communication
with
K.
Fujiwara)
did
the
author
learn
of
the
existence
of
Kato’s
proof.
In
fact,
the
proof
of
the
present
paper
diﬀers
somewhat
from
that
of
[5].
The
proof
of
Theorem
B
that
we
give
here
runs
as
follows:
We
would
like
to
reduce
to
the
regular
case,
where
one
has
the
classical
purity
theorem.
To
do
this,
we
blow
up
(X,
M
)
to
form
some
(X

,
M

)
for
which
X

is
regular.
Moreover,
we
show
that
the
“relative
π1
”
of
the
blow-up
morphism
X

→
X
is
trivial,
so
no
information
concerning
coverings
is
lost
by
pulling
back
to
X

.
This
triviality
of
the
relative
π1
is
essentially
an
exercise
in
the
combinatorics
of
toric
varieties
(Theorem
2.1).
Now
we
would
like
to
apply
the
classical
purity
theorem
to
the
pull-back
of
the
given
covering
to
X

.
The
problem
(cf.
the
above
discussion)
is
that
since
X

has
new
divisors,
i.e.,
divisors
that
map
to
primes
of
codimension
≥
2
in
X,
it
is
no
longer
clear
that
the
pulled-back
covering
over
X

still
satisﬁes
the
hypotheses
of
Theorem
B,
i.e.,
we
do
not
know
that
the
new
covering
is
tamely
ramiﬁed
over
the
new
divisors.
To
get
around
this
problem,
we
construct
(Proposition
2.2),
for
each
new
divisor
p
of
X

,
an
intermediate
blow-up
X

→
X
such
that
X

→
X
factors
through
X

in
a
neighborhood
of
the
given
new
divisor
p
.
Moreover,
the
construction
is
such
that
if
p
maps
to
a
prime
p
of
height
h
≥
3
in
X,
then
it
maps
to
a
prime
p
of
height
<
h
in
X

.
Also,
the
blow-up
X

→
X
has
the
property
that
its
ﬁbers
are
of
dimension
≤
1.
In
particular,
divisors
of
X

map
to
primes
of
X
of
height
≤
2.
Thus,
by
using
induction
on
h
and
applying
the
induction
hypothesis
to
the
prime
p
of
X

,
we
see
that
we
can
reduce
Theorem
B
to
the
case
h
=
2.
In
dimension
2,
however,
every
regular
log
scheme
is
(étale
locally)
“isogenous”
to
one
which
arises
from
a
divisor
with
normal
crossings
in
a
regular
scheme
(Corollary
1.8).
Thus,
we
reduce
to
the
regular
case,
where
we
can
apply
the
classical
purity
theorem.
This
completes
our
summary
of
the
proof
of
Theorem
B.
Returning
to
the
proof
of
Theorem
A,
once
one
has
the
log
purity
theorem,
one
can
reduce
Theorem
A
to
the
case
where
hUX
:
UX
→
M
admits
a
level
l
structure
(for
some
prime
l
≥
3
–
cf.
Deﬁnition
5.6).
In
this
case,
hUX
automatically
extends
to
the
generic
points
of
DY
.
Thus,
applying
the
main
result
of
[7]
allows
one
to
complete
the
proof
of
Theorem
A.
3
Once
one
has
Theorem
A,
one
can
use
it
to
compactify
(cf.
Theorem
C
below)
hyperbolic
polycurves,
i.e.,
successive
families
of
hyperbolic
curves,
as
follows:
Let
S
be
a
scheme.
A
family
of
hyperbolic
curves
U
→
S
over
S
is
a
family
of
smooth
compact
genus
g
curves
with
precisely
r
points
removed,
for
some
nonnegative
integers
g
and
r
such
that
2g
−
2
+
r
≥
1
(see
Deﬁnition
4.4
for
a
precise
deﬁnition).
A
hyperbolic
polycurve
(cf.
Deﬁnition
4.6)
U
→
S
is
a
morphism
which
factors
as
a
composite
of
a
ﬁnite
number
of
morphisms,
each
of
which
is
a
family
of
hyperbolic
curves.
The
moduli
stack
Mg,r
of
(“split”
–
cf.
Deﬁnition
5.2)
hyperbolic
curves
is
a
smooth
algebraic
stack
over
Z
which
is
not
proper.
To
compactify
it,
it
is
necessary
to
introduce
the
notion
of
a
stable
curve
(cf.
Deﬁnition
4.3;
[3,10]).
In
this
paper,
we
shall
think
of
a
family
of
stable
curves
as
a
pair
(X
→
S,
DM
),
where
X
→
S
is
a
proper
family
of
curves
and
DM
(the
“divisor
of
marked
points”)
is
a
divisor
in
X
(such
that
X
→
S
and
D
satisfy
certain
properties).
A
stable
polycurve
(cf.
Deﬁnition
4.5)
is
a
pair
(X
→
S,
D)
which,
roughly
speaking,
factors
as
a
composite
of
a
ﬁnite
number
of
families
of
stable
curves.
If
(X
→
S,
D)
is
a
stable
polycurve,
then
X
→
S
is
necessarily
proper.
def
It
is
easy
to
see
that
if
(X
→
S,
D)
is
a
stable
polycurve,
then
if
we
let
UX
=
X
−
D,
and
US
be
the
image
of
UX
in
S,
then
UX
→
US
is
a
hyperbolic
polycurve.
Thus,
one
may
think
of
(X
→
S,
D)
as
a
sort
of
compactiﬁcation
of
UX
→
US
.
Then
the
following
result
(Corollary
7.4
in
the
text)
states
that
under
certain
natural
conditions,
such
compactiﬁcations
always
exist
and
are
functorial
in
UX
→
US
:
Theorem
C.
(Compactiﬁcation
Theorem)
Let
(S,
MS
)
be
a
regular
log
scheme.
Let
US
⊆
S
be
the
interior
of
S.
Let
UX
→
US
be
polyhyperbolic
and
saturated
(cf.
Deﬁnitions
4.6,
7.3).
Then
UX
→
US
may
be
compactiﬁed
to
a
(log)
polystable
(X,
MX
)
→
(S,
MS
)
(cf.
Deﬁnition
4.5,
7.1).
Moreover,
this
compactiﬁcation
is
natural
in
the
following
sense:
Suppose
that
(S

,
MS

)
is
a
regular
log
scheme,
and
let
(X,
MX
)
→
(S,
MS
),
and
(X

,
MX

)
→
(S

,
MS

)
be
log
polystable
with
associated
hyperbolic
polycurves
UX
→
US
and
UX

→
US

,
respectively.
Suppose,
moreover,
that
we
are
given
a
commutative
diagram:
UX
⏐
⏐

−→
US
⏐
⏐

⊆
S
⏐
⏐

UX

−→
US

⊆
S
Then
the
square
on
the
left
“compactiﬁes”
uniquely
to
a
commutative
diagram:
(X,
MX
)
⏐
⏐

−→
(S,
MS
)
⏐
⏐

(X

,
MX

)
−→
(S

,
MS

)
4
In
particular,
it
makes
sense
to
speak
of
“the”
compactiﬁcation
of
UX
→
US
.
We
remark
that
in
an
earlier
version
of
this
paper
([15]),
we
proved
a
(weaker)
version
of
Theorems
A
and
C
above,
in
the
case
where
the
toric
pair
(S,
US
)
is
“polyregular,”
i.e.,
may
be
written
as
a
composite
of
“locally
stable
morphisms”
(cf.
Deﬁnition
4.1)
over
a
pair
arising
from
a
divisor
with
normal
crossings
in
a
regular
scheme.
Although
this
sort
of
treatment
(i.e.,
as
in
[15])
of
these
results
gives
rise
to
theorems
that
are
slightly
weaker
than
those
obtained
in
the
present
paper,
it
has
the
virtue
of
being
independent
of
the
theory
of
log
schemes
(cf.
[8,9]),
which
is
unfamiliar
to
some
algebraic
geometers.
The
main
reasons
why
the
polyregular
case
is
easier
to
treat
are
as
follows:
(1)
Polyregular
singularities
are
local
complete
intersections.
Moreover,
étale
coverings
and
line
bundles
on
dense
open
subsets
of
local
complete
intersection
schemes
tend
to
extend
over
the
whole
scheme
as
soon
as
they
extend
over
the
complement
of
a
closed
set
of
fairly
small
codimension
(cf.
the
theory
of
[18]).
This
allows
one
(using
certain
results
on
the
functoriality
of
the
indeterminacy
locus
–
cf.,
e.g.,
Lemma
5.2)
to
reduce
the
result
to
the
case
of
polyregular
singularities
of
dimension
≤
3.
(2)
Polyregular
singularities
in
dimension
≤
3
can
be
completely
classiﬁed
and
are
easy
to
understand.
For
instance,
their
singularities
can
be
resolved
explicitly.
This
means
that
one
does
not
have
to
use
such
“black
box-type”
results
as
Theorem
2.1.
In
§1,
we
review
basic
facts
about
regular
log
schemes.
In
§2,
we
analyze
in
some
detail
the
structure
of
the
sort
of
blow-ups
that
occur
when
one
resolves
toric
singularities.
This
analysis
is
used
to
prove
Theorem
B
(the
“log
purity
theorem”)
in
§3.
In
§4,
we
introduce
various
terminology
concerning
stable
curves
and
successive
families
of
stable
curves.
In
§5,
we
discuss
various
“well-known”
results
concerning
the
extendability
of
morphisms
deﬁned
on
an
open
dense
subset
of
a
given
normal
scheme.
In
§6,
we
then
explain
how
Theorem
A
follows
from
Theorem
B
and
the
main
result
of
[7].
Finally,
in
§7,
we
observe
that
Theorem
C
is
essentially
a
formal
consequence
of
Theorem
A.
Finally,
I
would
like
to
thank
Takeshi
Tsuji
for
explaining
to
me
various
basic
facts
concerning
regular
log
schemes,
and
Kazuhiro
Fujiwara
for
informing
me
of
the
work
of
Prof.
K.
Kato.
§1.
Generalities
on
Regular
Log
Schemes
Let
(X,
M
)
be
a
ﬁne
log
scheme
(as
in
[8]),
whose
underlying
scheme
X
is
noetherian.
×
⊆
OX
denote
the
subsheaf
of
the
structure
sheaf
of
X
consisting
of
invertible
Let
OX
sections.
Thus,
M
is
a
sheaf
of
abelian
monoids
in
the
étale
topology
of
X,
equipped
5
with
a
morphism
expM
:
M
→
OX
of
étale
sheaves
of
abelian
monoids,
and
expM
maps
×
×
exp−1
M
(OX
)
isomorphically
onto
OX
⊆
OX
.
(Note:
In
[8],
the
morphism
expM
is
often
denoted
“α.”)
If
P
is
a
abelian
monoid,
let
us
denote
by
P
gp
the
abelian
group
associated
to
P
.
Clearly,
this
operation
P
→
P
gp
of
passing
from
abelian
monoids
to
abelian
groups
is
compatible
with
sheaﬁﬁcation.
Thus,
let
us
denote
by
M
gp
the
étale
sheaf
of
abelian
groups
associated
to
M
.
Note
that
if
P
is
an
integral
monoid,
then
the
natural
map
P
→
P
gp
is
injective.
Since
we
have
assumed
that
(X,
M
)
is
ﬁne
(hence
integral),
it
×
follows
that
for
each
x
∈
X,
the
stalk
{M/exp−1
M
(OX
)}x
(where
x
is
the
spectrum
of
the
separable
closure
of
the
residue
ﬁeld
of
x)
is
an
integral
monoid.
An
integral
abelian
monoid
P
(written
additively)
is
called
saturated
if
for
every
a
∈
P
gp
such
that
n
·
a
∈
P
for
some
positive
integer
n,
it
follows
that
a
∈
P
⊆
P
gp
.
×
The
log
scheme
(X,
M
)
will
be
called
saturated
if,
for
each
x
∈
X,
{M/exp−1
M
(OX
)}x
×
is
saturated.
If
x
∈
X,
let
us
write
Ix
=
Mx
\OX,X/S
,
and
let
us
write
Ix
·
OX,x
for
expM
(Ix
)
·
OX,x
.
def
Let
us
henceforth
assume
that
(X,
M
)
is
saturated.
Then,
following
[9],
Deﬁnition
2.1,
we
make
the
following
deﬁnition:
Deﬁnition
1.1.
We
shall
say
that
(X,
M
)
is
(log)
regular
at
x
∈
X
if
OX,x
/Ix
·
OX,x
×
is
regular,
and,
moreover,
dim(OX,x
)
=
dim(OX,x
/Ix
·
OX,x
)
+
rankZ
(Mxgp
/exp−1
M
(OX,x
)).
We
shall
say
that
(X,
M
)
is
(log)
regular
if
(X,
M
)
is
regular
at
every
point
of
X.
Let
us
review
some
basic
properties
of
log
regular
(X,
M
)
(cf.
[9]
for
more
details).
If
(X,
M
)
is
log
regular
at
a
point
x
∈
X,
and
x
lies
in
the
closure
of
a
point
y
∈
X,
then
(X,
M
)
is
log
regular
at
y,
as
well
([9],
Proposition
7.1).
If
(Y,
N
)
→
(X,
M
)
is
a
log
smooth
morphism
of
saturated
log
schemes
such
that
X
and
Y
are
noetherian,
and
(X,
M
)
is
log
regular,
then
(Y,
N
)
is
also
log
regular
([9],
Theorem
8.2).
Suppose
that
(X,
M
)
is
log
regular.
Then
it
follows
that
X
is
normal
and
Cohen-Macaulay
([9],
Theorem
4.1).
Let
U
⊆
X
be
the
open
subscheme
on
which
the
log
structure
M
is
trivial.
We
shall
refer
to
this
open
subscheme
as
the
interior
of
X.
Let
D
⊆
X
be
the
complement
of
U
,
with
the
reduced
induced
scheme
structure.
(When
there
are
several
log
schemes
involved,
we
shall
write
UX
,
DX
,
MX
,
for
U
,
D,
and
M
to
show
that
they
are
the
respective
objects
associated
to
(X,
M
).)
Then
D
is
a
divisor
in
X,
and
the
morphism
exp

M
:×M
→
OX
is
isomorphic
(cf.
[9],
Theorem
11.6)
to
the
natural
(OX
i∗
OU
)
→
OX
,

morphism
×
”
denotes
the
subsheaf
of
OX
where
i
:
U
→
X
is
the
natural
inclusion,
and
“OX
i∗
OU
consisting
of
regular
functions
on
X
whose
restriction
to
U
is
invertible.
In
particular,
expM
is
necessarily
injective.
If
f
is
a
section
of
OX
that
lies
in
the
image
of
expM
,
then
we
shall
write
logM
(f
)
for
the
unique
section
of
M
that
maps
under
expM
to
f
.
Thus,
it
follows
that
whether
or
not
(X,
M
)
is
regular
is
an
intrinsic
property
of
the
pair
(X,
U
).
In
particular,
it
is
meaningful
to
make
the
following
deﬁnition:
Deﬁnition
1.2.
If
X
is
a
normal
scheme,
and
U
⊆
X
is
an
open
subscheme
of
X,
then
we
shall
call
(X,
U
)
a
toric
pair
if
(X,
U
)
arises
as
above
from
some
log
regular
log
6
structure
on
X.
If
(X,
U
)
is
a
toric
pair,
then
we
shall
refer
to
the
singularities
of
X
as
toric
singularities.
In
this
paper,
we
shall
say
that
a
closed
subscheme
D
in
a
regular
noetherian
scheme
X
is
a
“divisor
with
normal
crossings”
if
D
is
a
divisor
which,
étale
locally
on
X,
is
(scheme-theoretically)
deﬁned
by
a
product
t1
·
t2
·
.
.
.
·
tr
,
where
t1
,
.
.
.
,
tr
is
part
of
a
regular
system
of
parameters.
Thus,
if
D
is
a
divisor
with
normal
crossings
in
X,
then
def
(X,
U
)
(where
U
=
X
−D)
forms
a
toric
pair.
In
other
words,
one
may
think
of
the
notion
of
a
toric
pair
as
a
sort
of
generalization
of
the
notion
of
a
divisor
with
normal
crossings.
Now
let
us
suppose
that
(X,
M
)
is
log
regular
and
that
X
is
strictly
henselian
with
×
unique
closed
point
x
∈
X.
Let
P
=
Mx
/logM
(OX,x
).
Thus,
P
is
a
ﬁnitely
generated,
integral,
saturated
monoid.
Moreover,
P
does
not
contain
any
nonzero
invertible
elements,
i.e.,
a,
−a
∈
P
implies
a
=
0.
In
particular,
P
(and
hence
also
P
gp
)
is
torsion-free.
Thus,
P
gp
is
a
ﬁnitely
generated
free
abelian
group.
Moreover,
we
have
an
exact
sequence
of
abelian
groups
def
×
×
0
→
logM
(OX,x
)
(∼
)
→
M
gp
→
P
gp
→
0
=
OX,x
Since
P
gp
is
free,
it
follows
that
this
exact
sequence
always
splits.
Deﬁnition
1.3.
We
shall
refer
to
a
splitting
P
gp
→
M
gp
of
the
above
exact
sequence
as
a
clean
chart
at
x.
Note
that
we
also
have
an
exact
sequence
of
abelian
monoids:
×
)→M
→P
→0
0
→
logM
(OX,x
Moreover,
it
is
clear
that
this
exact
sequence
may
be
identiﬁed
with
the
pull-back
of
the
preceding
exact
sequence
via
P
→
P
gp
.
Thus,
a
clean
chart
induces
a
splitting
P
→
M
.
Note
that
such
a
splitting
P
→
M
deﬁnes
a
chart
(in
the
sense
of
[8])
for
the
log
scheme
(X,
M
).
If
a
clean
chart
has
been
ﬁxed,
then
we
shall
write
expM
(a)
(where
a
∈
P
gp
)
for
the
(rational)
section
of
OX
deﬁned
by
applying
to
a
the
composite
of
the
splitting
P
gp
→
M
gp
with
(the
morphism
induces
on
(−)gp
’s
by)
expM
:
M
→
OX
.
Let
n
be
a
positive
integer.
Then
we
would
like
to
deﬁne
a
morphism
(Y,
N
)
→
(X,
M
)
of
log
schemes
as
follows:
Let
us
write
Z[P
]
for
the
monoid
ring
of
P
over
Z.
Let
nP
:
Z[P
]
→
Z[P
]
denote
the
Z-algebra
morphism
induced
the
“multiplication
by
n”
on
P
.
Let
7
def
Y
=
X
×Z[P
],nP
Z[P
],
and
let
N
be
the
log
structure
associated
to
the
chart
P
→
OY
(where
this
“P
”
is
the
P
in
the
range
of
the
morphism
nP
).
Lemma
1.4.
(Y,
N
)
is
log
regular.
Moreover,
the
natural
morphism
Y
→
X
is
ﬁnite
gp
over
X,
and
ﬂat
of
degree
nrankZ
(P
)
over
UX
.
Proof.
The
last
sentence
is
immediate
from
the
deﬁnition
of
(Y,
N
).
Thus,
it
suﬃces
to
prove
that
(Y,
N
)
is
log
regular.
Since
log
regularity
is
stable
under
genericization
([9],
Proposition
7.1),
it
suﬃces
to
prove
that
(Y,
N
)
is
log
regular
at
the
unique
point
y
∈
Y
lying
over
x
∈
X.
Since
it
follows
immediately
from
the
deﬁnitions
that
OY,y
/Iy
·
OY,y
=
OX,x
/Ix
·
OX,x
,
we
thus
see
that
we
are
in
a
situation
where
we
can
apply
Theorem
6.1
of
[9].
One
thus
concludes
as
in
the
last
paragraph
of
the
proof
of
Theorem
8.2
of
[9],
p.
1087.
Deﬁnition
1.5.
We
shall
refer
to
(Y,
N
)
→
(X,
M
)
as
the
dilation
of
magnitude
n
associated
to
the
clean
chart
P
gp
→
M
gp
.
If
(Y,
N
)
→
(X,
M
)
is
a
dilation,
then
we
shall
refer
to
(Y,
N
)
as
a
dilate
of
(X,
M
).
Now
let
p
∈
X
be
a
point
of
X.
Let
us
write
Xp
for
the
strict
henselization
of
X
at
p.
Note
that
the
clean
chart
P
gp
→
M
gp
deﬁnes
a
morphism
P
gp
→
M
gp
→
M
gp
|X
such
p
that
×
P
gp
→
(M
gp
/(logM
(OX
)))|X
p
is
surjective.
In
particular,
there
exists
a
ﬁnitely
generated,
free
Z-module
Ppgp
⊆
P
gp
such
that
the
restriction
Ppgp
→
M
gp
|X
p
of
P
gp
→
M
gp
|X
to
Ppgp
deﬁnes
a
clean
chart
for
Xp
.
Since
dilations
of
Xp
with
respect
p
to
this
clean
chart
are
obtained
by
forming
the
normalization
of
Xp
in
the
ﬁnite,
ﬂat
covering
of
Up
obtained
by
extracting
roots
of
elements
of
the
image
of
Ppgp
in
OU
,
and
p
such
elements
may
also
be
obtained
as
elements
of
the
image
under
the
natural
morphism
OU
→
OU
of
elements
of
expM
(P
gp
),
it
thus
follows
that:
p
Proposition
1.6.
For
any
p
∈
X,
there
exists
a
clean
chart
for
Xp
such
that
any
dilation
of
Xp
with
respect
to
this
clean
chart
is
dominated
by
the
restriction
to
Xp
of
a
dilation
with
respect
to
the
given
clean
chart
P
gp
→
M
gp
of
X.
8
Finally,
before
continuing,
we
pause
to
consider
the
structure
of
P
in
greater
detail
in
the
case
rankZ
(P
gp
)
≤
2.
def
Proposition
1.7.
If
rankZ
(P
gp
)
=
1,
then
P
∼
=
N
=
{a
∈
Z
|
a
≥
0}.
If
rankZ
(P
gp
)
=
def
gp
2,
then
there
exist
a,
b
∈
PQ
=
P
gp
⊗Z
Q
such
that:
(i)
P
⊆
N
·
a
+
N
·
b;
(ii)
there
exists
a
positive
integer
l
such
that
l
·
a,
l
·
b
∈
P
.
Proof.
The
rank
1
case
is
trivial.
For
a
discussion
of
the
rank
2
case,
we
refer
to
the
discussion
preceding
Proposition
1.19
of
§1.7
of
[17].
Indeed,
in
the
notation
of
loc.
cit.,
if
α,
β
∈
P
are
the
primitive
elements
denoted
“n,
n
”
(in
the
third
paragraph
of
p.
24
of
def
def
[17]),
then
it
suﬃces
to
take
a
=
α/l,
b
=
β/l
for
some
appropriate
l.
Corollary
1.8.
If
rankZ
(P
gp
)
=
1,
then
X
is
regular
and
DX
is
a
regular
divisor
in
X.
If
rankZ
(P
gp
)
=
2,
then
there
exists
a
positive
integer
n
such
that
any
dilation
(Y,
N
)
→
(X,
M
)
of
magnitude
divisible
by
n
factors
through
some
(Y

,
M

)
such
that:
(i)
Y

is
regular,
and
DY

is
a
divisor
with
normal
crossings
in
Y

;
(ii)
the
morphisms
Y
→
Y

and
Y

→
X
are
ﬁnite
(over
X)
and
ﬂat
over
UX
.
Proof.
The
rank
1
case
is
trivial.
The
rank
2
case
follows
from
Proposition
1.7
by
letting
(Y,
N
)
→
(X,
M
)
be
the
dilation
of
magnitude
l,
and
letting
(Y

,
N

)
→
(X,
M
)
(respectively,
(Y,
N
)
→
(Y

,
N

))
be
the
morphism
deﬁned
by
Z[P
]
→
Z[N
·
a
+
N
·
b]
(respectively,
Z[N
·
a
+
N
·
b]
→
Z[
1l
·
P
]).
Note
that
the
log
regularity
of
(Y

,
N

)
follows
by
the
same
argument
as
that
used
in
the
proof
of
Lemma
1.4
to
prove
the
log
regularity
of
(Y,
N
).
Remark.
The
property
discussed
in
Corollary
1.8,
i.e.,
that
“up
to
isogeny”
every
toric
pair
is
“regular”
(i.e.,
arises
from
a
divisor
with
normal
crossings
in
a
regular
scheme)
is
false
in
dimensions
≥
3.
Indeed,
if
it
were
true,
then
it
would
follow
that
if
(X,
M
)
is
log
regular,
then
X
is
necessarily
locally
Q-factorial,
i.e.,
some
nonzero
multiple
of
every
Weil
divisor
on
X
is
Cartier.
On
the
other
hand,
an
easy
calculation
(involving
blowing
up
at
the
origin
u
=
v
=
x
=
y
=
0)
reveals
that
the
pair
1
1
def
def
X
=
Spec(k[[u,
v,
x,
y]]/(uv
−
xy))
⊇
U
=
X[
,
]
u
v
is
toric,
but
not
locally
Q-factorial.
9
§2.
Blow-ups
of
Regular
Log
Schemes
We
continue
with
the
notation
of
§1.
Thus,
we
assume
that
(X,
M
)
is
log
regular
and
that
X
is
strictly
henselian
with
unique
closed
point
x
∈
X.
In
fact,
in
this
§,
we
would
also
like
to
assume
that
X
is
the
spectrum
of
a
complete
local
ring.
Let
us
recall
the
apparatus
of
“fans,”
as
discussed
for
instance
in
[17],
p.
2.
Let
def
r
=
rankZ
(P
gp
).
Then
one
may
think
of
the
ﬁnitely
generated
saturated
monoid
P
as
being
deﬁned
(cf.
[17],
Proposition
1.1,
p.
3)
by
a
strongly
convex
rational
polyhedral
cone
σP
⊆
Rr
.
More
generally,
a
fan
is
a
nonempty
collection
of
strongly
convex
rational
polyhedral
cones
in
Rr
satisfying
certain
conditions
(cf.
[17],
p.
2).
If
Δ
is
the
fan
arising
from
a
locally
ﬁnite
nonsingular
subdivision
of
σP
(cf.
[17],
p.
23,
Corollary
1.18),
then
Δ
deﬁnes
a
proper,
birational
morphism
f
log
:
(Y,
N
)
→
(X,
M
)
(cf.
[9],
§10)
such
that
(Y,
N
)
is
log
regular;
Y
is
regular;
and
DY
⊆
Y
is
a
divisor
with
normal
crossings
in
Y
.
It
is
known
that
such
a
Δ
always
exists
(cf.
[17],
§1.5).
def
Let
Z
⊆
Y
be
an
irreducible
component
of
(Yx
)red
(where
Yx
=
f
−1
(x)).
Then
the
ideal
deﬁning
the
closed
subscheme
Z
⊆
Y
is
(Zariski)
locally
generated
by
sections
of
OY
of
the
form
expN
(a),
for
a
∈
P
gp
.
In
particular,
it
follows
immediately
that
Z
is
regular.
Let
us
deﬁne
the
closed
subscheme
DZ
⊆
Z
Zariski
locally
on
Z
as
the
restriction
to
Z
of
def
all
the
irreducible
components
of
DY
that
do
not
contain
Z.
Let
UZ
=
Z
−
DZ
.
Then
I
claim
that
Z
is
a
toric
variety
whose
torus
embedding
is
UZ
⊆
Z.
Indeed,
this
follows
immediately
from
the
fact
that,
Zariski
locally,
Z
is,
by
construction,
the
spectrum
of
the
monoid
ring
associated
to
some
quotient
of
a
submonoid
of
P
gp
.
Thus,
in
particular,
UZ
def
is
isomorphic
to
some
product
of
Gm
’s
over
k
=
k(x),
the
residue
ﬁeld
of
x
∈
X.
Let
us
write
Y
for
the
formal
scheme
obtained
by
completing
Y
along
the
proper
k-scheme
Yx
.
Next,
recall
that
there
is
a
certain
correspondence
between
certain
portions
of
Δ
or
σP
and
various
subobjects
of
Y
.
For
instance,
each
of
the
cones
σ
∈
Δ
corresponds
σ
⊆
Y
(cf.
Propositions
1.3,
1.4
of
[17],
p.
7).
Under
this
to
aﬃne
opens
Uσ
⊆
Y
,
U
correspondence,
the
cones
σ
∈
Δ
that
do
not
intersect
the
interior
Int(σP
)
of
σP
correspond
to
the
Uσ
⊆
Y
\Yx
,
while
the
cones
σ
∈
Δ
that
intersect
Int(σP
)
correspond
to
the
Uσ
that
intersect
the
ﬁber
Yx
.
Let
σ
∈
Δ
be
an
r-dimensional
(i.e.,
top
dimensional)
cone
in
Δ.
σ
is
the
Thus,
since
σ
is
nonsingular
(i.e.,
abstractly
isomorphic
to
Nr
),
it
follows
that
U
completion
of
Y
along
some
subscheme
Wσ
⊆
(Yx
)red
⊆
Y
,
where
Wσ
may
be
identiﬁed
with
a
closed,
reduced
subscheme
of
Ark
(i.e.,
r-dimensional
aﬃne
space
over
k)
which
is
the
union
of
a
ﬁnite
number
of
linear
subspaces
(passing
through
the
origin)
of
Ark
.
Note
that
each
of
these
linear
subspaces
is
an
open
dense
subset
of
some
Z
⊆
Y
of
the
sort
considered
in
the
preceding
paragraph.
We
would
like
to
consider
the
algebraic
fundamental
group
π1
(Y
)
(for
some
choice
of
basepoint
in
Yx
,
which,
for
convenience,
we
omit
in
the
following)
of
Y
.
Since
the
étale
site
10
is
invariant
under
nilpotent
thickenings,
it
follows
that
π1
(Y
)
=
π1
(Yx
)
=
π1
((Yx
)red
).
Let
Z
⊆
(Yx
)red
be
an
irreducible
component
of
(Yx
)red
.
Then
Z
is
a
smooth,
proper,
rational
variety
over
k.
In
particular,
its
fundamental
group
π1
(Z)
is
trivial.
(Indeed,
since
Z
is
a
proper,
toric
variety,
it
lifts
naturally
to
a
toric
variety
in
characteristic
zero.
Moreover,
since
π1
(Z)
is
a
quotient
of
this
toric
variety
in
characteristic
zero,
it
suﬃces
to
observe
that
the
fundamental
group
of
any
smooth,
proper
toric
variety
in
characteristic
zero
is
trivial
–
but
this
follows,
for
instance,
from
Proposition
1.9
of
[17],
p.
14.)
Now
let
Y

→
Y
be
an
arbitrary
ﬁnite
étale
covering.
Since
the
restriction
of
this
covering
to
any
Z
is
trivial,
it
follows
that
the
restriction
of
this
covering
to
each
of
the
irreducible
components
of
any
Wσ
(as
in
the
preceding
paragraph)
is
trivial.
But
since
all
the
irreducible
components
of
Wσ
pass
through
the
origin
in
Ark
,
it
follows
that
the
restriction
of
Y

→
Y
to
Wσ
is
trivial.

def


(Yx
)red
.
More
generally,
for
any
σ
∈
Δ
such
that
σ
Int(σP
)
=
∅,
let
Wσ
=
U
σ

Since
any
such
σ
is
a
face
of
an
r-dimensional
cone
σ
∈
Δ
(so
Wσ
⊆
Wσ
),
it
follows
that
the
restriction
of
Y

→
Y
to
any
such
Wσ
is
trivial.
Thus,
for
any
such
σ,
we
obtain
a
(trivial)
ﬁnite
étale
covering
Wσ
→
Wσ
.
Since
these
étale
coverings
are
compatible
with
respect
to
restriction
from
Wσ
to
Wτ
(where
τ
is
a
face
of
σ),
it
follows
that
we
may
construct
a
ﬁnite
étale
covering
C
→
Int(σP
)
as
follows:
For
each
σ
∈
Δ
as
above,
we
let
Cσ
→
σ
Int(σP
)
be
the
trivial
ﬁnite
étale
covering
whose
set
of
connected
components
is
equal
to
the
set
of
connected
components
of
Wσ
.
Then
because
of
thecompatibility
of
the
Wσ
→
Wσ
with
respect
to
restriction,
it
follows
that
the
Cσ
→
σ
Int(σP
)
glue
together
to
form
a
ﬁnite
étale
covering
C
→
Int(σP
)
of
the
topological
space
Int(σP
).
On
the
other
hand,
since
σP
is
a
convex
cone,
it
is
clear
that
Int(σP
)
is
simply
connected.
Thus,
the
covering
C
→
Int(σP
)
splits.
Since
the
covering
Y

→
Y
is
deﬁned
“by
the
same
combinatorics”
as
C
→
Int(σP
),
it
thus
follows
that
Y

→
Y
splits,
i.e.,
that
π1
(Y
)
is
trivial.
Since
f
:
Y
→
X
is
proper,
it
follows
from
the
“theorem
on
formal
functions”
(see,
e.g.,
Theorem
11.1
of
Chapter
III
of
[11])
that
π1
(Y
)
is
trivial.
We
summarize
the
above
discussion
in
the
following:
Theorem
2.1.
There
exists
a
proper,
birational
morphism
of
ﬁnite
type
f
log
:
(Y,
N
)
→
(X,
M
),
where
(Y,
N
)
is
log
regular;
Y
is
regular;
and
DY
is
a
divisor
with
normal
crossings
in
Y
.
Moreover,
this
morphism
may
be
chosen
so
that
any
irreducible
component
Z
of
f
−1
(x)red
is
a
smooth,
proper
toric
variety
such
that
the
torus
inside
Z
is
given
as
follows:
Let
DZ
⊆
Z
be
the
closed
subscheme
deﬁned
locally
on
Z
as
the
restriction
to
Z
of
all
the
irreducible
components
of
DY
that
do
not
contain
Z.
Then
the
torus
inside
Z
is
given
by
def
def
UZ
=
Z
−
DZ
.
In
particular,
UZ
is
isomorphic
to
a
product
of
Gm
’s
over
k
=
k(x)
(the
residue
ﬁeld
of
x
∈
X).
Finally,
the
fundamental
group
π1
(Y
)
is
trivial.
In
this
remainder
of
this
§,
we
would
like
to
analyze
the
structure
of
f
log
:
(Y,
N
)
→
(X,
M
)
at
the
generic
points
of
DY
in
greater
detail.
Let
pY
∈
Y
be
a
generic
point
of
DY
that
maps
to
x
∈
X.
Then
pY
deﬁnes
a
“valuation”
v:P
→N
11
on
P
by
letting
v(a)
(for
a
∈
P
)
be
the
order
at
pY
of
expN
(a).
Let
k(pY
)
be
the
residue
def
ﬁeld
of
pY
.
Thus,
k(pY
)
is
a
ﬁnitely
generated
ﬁeld
extension
of
k
=
k(x)
which
is
generated
(as
a
ﬁeld
extension
of
k)
by
the
images
of
expN
(a
−
b)
in
k(pY
),
where
a,
b
∈
P
range
over
all
pairs
of
elements
such
that
v(a)
=
v(b).
Now
suppose
that
the
height
htX
(x)
of
x
(as
point
of
X)
is
≥
2.
Since
X
is
the
spectrum
of
complete
local
ring,
it
follows
that
X
is
universally
catenary,
hence
that
the
transcendence
degree
of
k(pY
)
over
k
is
≥
1
(cf.
[13],
§14,
34).
Thus,
there
exist
a,
b
∈
P
such
that
v(a)
=
v(b),
and,
moreover,
the
image
of
expN
(a
−
b)
in
k(pY
)
is
transcendental
over
k.
Note
that
since
v(c)
>
0
for
all
nonzero
c
∈
P
,
it
follows
(from
the
fact
that
v(a
−
b)
=
0)
that
a
−
b
∈
/
P
.
Also,
there
does
not
exist
a
c
∈
P
such
that
a
and
b
are
both
multiples
of
c.
(For
if
this
were
the
case,
then
expN
(a
−
b)
=
1,
which
is
not
transcendental
over
k.)
Let
us
write
R
for
the
submonoid
of
P
gp
generated
by
P
and
a
−
b
=
0,
and
R
for
the
smallest
saturated
submonoid
of
P
gp
containing
R.
Thus,
R
is
a
ﬁnitely
generated
saturated
integral
monoid.
def
Let
Z
=
X[expM
(a)
·
(expM
(b))−1
]
(i.e.,
the
aﬃne
scheme
birational
to
X
which
is
obtained
from
X
by
adjoining
the
rational
function
in
brackets).
Let
(Z

,
Q
)
be
the
log
def
scheme
given
as
follows:
Z

=
X
⊗Z[P
]
Z[R
];
Q
is
the
log
structure
deﬁned
by
the
chart
given
by
the
natural
morphism
R
→
OZ

.
Thus,
we
have
a
natural
morphism
(Z

,
Q
)
→
(X,
M
)
of
saturated
log
schemes
such
that
Z

→
X
factors
through
Z.
Moreover,
it
is
clear
that
this
morphism
is
log
étale
(hence
log
smooth).
Thus,
it
follows
(by
[9],
Theorem
8.2)
that
(Z

,
Q
)
is
log
regular.
Moreover,
it
is
immediate
that
the
ﬁbers
of
Z
→
X
and
Z

→
X
have
dimension
≤
1,
and
that
Z

→
Z
is
ﬁnite.
Let
Zx
(respectively,
Zx
)
be
the
ﬁber
of
Z

→
X
(respectively,
Z
→
X)
over
x
∈
X.
Then
Zx
→
Zx
is
ﬁnite,
and
Zx
=
Spec(k[t]),
where
t
is
the
indeterminate
over
k
which
is
the
image
of
expN
(a
−
b).
Let
us
write
pZ
∈
Z
for
the
generic
point
of
Zx
.
Thus,
(since
X
is
universally
catenary)
htZ
(pZ
)
=
htX
(x)
−
1
≥
1.
Now
let
(Y

,
N

)
denote
the
Zariski
localization
of
(Y,
N
)
at
pY
.
Thus,
we
have
a
natural
localization
morphism
(Y

,
N

)
→
(Y,
N
).
Composing
this
morphism
with
f
log
gives
us
a
morphism
(Y

,
N

)
→
(X,
M
).
Moreover,
it
is
clear
from
the
deﬁnition
of
P

that
this
morphism
(Y

,
N

)
→
(X,
M
)
factors
through
(Z

,
Q
).
Thus,
we
get
a
morphism
Y

→
Z

→
Z.
Let
us
write
pY

∈
Y

for
the
point
induced
by
pY
.
Now
I
claim
that
the
image
in
Z
of
pY

is
pZ
∈
Z.
Indeed,
since
pY

∈
Y

maps
to
x
∈
X,
it
follows
that
the
image
in
Z
of
pY

lies
in
Zx
.
On
the
other
hand,
since
the
image
of
“t”
(i.e.,
the
indeterminate
such
that
Zx
=
Spec(k[t]))
in
k(pY

)
=
k(pY
)
is,
by
construction,
transcendental
over
k,
it
thus
follows
that
the
image
in
Z
of
pY

must
be
the
generic
point
of
Zx
,
i.e.,
pZ
.
This
completes
the
proof
of
the
claim.
Let
pZ

∈
Z

be
the
image
in
Z

of
pY

.
Thus,
htZ

(pZ

)
=
htZ
(pZ
)
=
htX
(x)
−
1.
Next,
let
us
denote
by
Z

the
strict
henselization
of
Z

at
pZ

.
Observe
that
the
pZ

original
clean
chart
P
gp
→
M
gp
deﬁnes
a
morphism
P
gp
→
(Q
)gp
such
that
P
gp
→
×
((Q
)gp
|Z

)/logM
(OZ
)
is
surjective.
In
particular,
there
exists
a
ﬁnitely
generated,

pZ

pZ

free
Z-module
Ppgp
⊆
P
gp
such
that
the
restriction
Z
12
Ppgp
→
(Q
)gp
|Z

Z
pZ

of
P
gp
→
(Q
)gp
|Z

to
Ppgp
deﬁnes
a
clean
chart
for
Z

.
Since
dilations
of
Z

pZ

pZ

Z
pZ


with
respect
to
this
clean
chart
are
obtained
by
forming
the
normalization
of
Z
in
the
pZ

ﬁnite,
ﬂat
covering
of
UZ

obtained
by
extracting
roots
of
elements
of
the
image
of
Ppgp
Z
p
Z
in
OUZ

,
and
such
elements
may
also
be
obtained
as
elements
of
the
image
under
the
pZ

natural
morphism
OU
→
OUZ

of
elements
of
expM
(P
gp
),
it
thus
follows
that:
There
pZ

exists
a
clean
chart
for
Z

such
that
the
interior
of
any
dilation
of
Z

with
respect
to
pZ

pZ

this
clean
chart
is
dominated
by
the
restriction
to
Z

of
the
interior
of
a
dilation
with
pZ

respect
to
the
given
clean
chart
P
gp
→
M
gp
of
X.
We
summarize
the
above
discussion
as
follows:
Proposition
2.2.
Let
(Y,
N
)
→
(X,
M
)
be
as
in
Theorem
2.1.
Let
pY
∈
Y
be
a
generic
point
of
DY
that
maps
to
x
∈
X.
Let
(Y

,
N

)
be
the
Zariski
localization
of
(Y,
N
)
at
pY
,
and
write
pY

∈
Y

for
the
point
of
Y

that
corresponds
to
pY
∈
Y
.
Suppose
that
the
height
of
x
∈
X
is
≥
2.
Then
the
morphism
(Y

,
N

)
→
(X,
M
)
factors
as
a
composite
of
two
morphisms
(Y

,
N

)
→
(Z

,
Q
)
→
(X,
M
)
such
that:
(1)
(Z

,
Q
)
is
log
regular;
(2)
the
morphisms
Y

→
Z

and
Z

→
X
are
birational;
in
fact,
Z

→
X
is
an
isomorphism
over
the
interior
UX
of
X;
(3)
the
ﬁbers
of
Z

→
X
have
dimension
≤
1
(thus,
in
particular,
any
point
of
Z

of
height
1
necessarily
maps
to
a
point
of
height
≤
2
in
X);
(4)
the
image
pZ

∈
Z

of
pY

∈
Y

satisﬁes
htZ

(pZ

)
=
htX
(x)
−
1.
for
the
strict
henselization
of
Z

at
pZ

,
then
there
exists
a
Moreover,
if
we
write
Z

pZ

clean
chart
for
Z

such
that
the
interior
of
any
dilation
of
Z

with
respect
to
this
clean
pZ

pZ

chart
is
dominated
by
the
restriction
to
UZ

of
the
interior
of
a
dilation
with
respect
to
pZ

the
given
clean
chart
P
gp
→
M
gp
of
X.
13
§3.
Log
Purity
In
this
§,
we
give
a
proof
of
an
unpublished
result
due
originally
to
K.
Kato
which
is
a
“log
regular
analogue”
of
the
well-known
classical
purity
theorem
([18],
Exposé
X,
p.
118,
Théorème
3.4)
on
extending
étale
covers
over
regular
schemes.
Lemma
3.1.
Let
(X,
M
)
be
a
regular
log
scheme.
Let
V
→
UX
be
a
ﬁnite
étale
covering
of
the
interior
UX
of
X
which
is
tamely
ramiﬁed
over
the
generic
points
of
the
divisor
DX
⊆
X.
Suppose
that
X
is
strictly
henselian
with
unique
closed
point
x
∈
X.
Then
there
exists
a
positive
integer
n
such
that
if
(Y

,
N

)
→
(X,
M
)
is
any
dilation
(cf.
Deﬁnition
1.5)
of
magnitude
divisible
by
n,
then
the
pull-back
of
the
covering
V
→
UX
to
UY

via
UY

→
UX
is
trivial.
Proof.
Note
ﬁrst
that
since
dilations
may
be
taken
to
have
arbitrarily
large
tame
ramiﬁcation
over
the
generic
points
of
DX
,
we
may
assume
that
V
→
UX
is
étale
over
the
generic
points
of
DX
.
The
rest
of
the
proof
will
be
by
induction
on
dim(X).
(Note
that
any
strictly
henselian
X
is
necessarily
ﬁnite-dimensional.)
The
case
dim(X)
=
1
is
trivial.
Now
suppose
that
dim(X)
=
2.
Then
the
lemma
follows
from
Corollary
1.8
(of
§1
of
the
present
paper),
together
with
the
classical
purity
theorem
(i.e.,
[18],
Exposé
X,
p.
118,
Théorème
3.4).
Now
let
us
assume
that
dim(X)
≥
3.
We
may
thus
assume
that
Lemma
3.1
holds
for
strictly
henselian
regular
log
schemes
of
dimension
≤
dim(X)
−
1.
In
particular,
it
follows
that
by
replacing
(X,
M
)
by
a
dilate
of
(X,
M
)
(cf.
Proposition
1.6
of
§1)
and
applying
étale
descent,
we
may
assume
that
V
→
UX
extends
to
a
ﬁnite
étale
covering
over
X
−
{x}.
Moreover,
by
completing
(X,
M
)
at
x
(and
using
faithful
ﬂat
descent),
we
may
assume
that
X
is
the
spectrum
of
a
complete,
local,
strictly
henselian
ring.
Let
(Y,
N
)
be
as
in
Theorem
2.1.
Let
(X
∗
,
M
∗
)
→
(X,
M
)
be
a
dilation
of
(X,
M
)
of
magnitude
divisible
by
some
positive
integer
n,
to
be
speciﬁed
below.
Let
(Y
∗
,
N
∗
)
→
(X
∗
,
M
∗
)
be
the
blow-up
of
(X
∗
,
M
∗
)
(as
in
Theorem
2.1)
constructed
using
the
same
nonsingular
subdivision
Δ
as
that
used
to
construct
(Y,
N
)
out
of
(X,
M
).
Thus,
we
have
a
commutative
diagram:
(Y
∗
,
N
∗
)
⏐
⏐

−→
(X
∗
,
M
∗
)
⏐
⏐

(Y,
N
)
−→
(X,
M
)
Now
I
claim
that
for
some
appropriate
choice
of
n,
the
morphism
V
→
UX
extends
to
a
ﬁnite
étale
covering
over
all
the
generic
points
pY
∗
∈
Y
∗
of
DY
∗
.
Indeed,
write
pY
∈
Y
for
the
image
in
Y
of
pY
∗
.
If
pY
maps
to
a
point
of
X
other
than
x,
then
the
claim
follows
from
the
fact
that
V
→
UX
already
extends
over
X
−
{x}.
Thus,
we
may
assume
that
pY
maps
to
x
∈
X.
In
particular,
we
are
in
the
situation
of
Proposition
2.2.
Let
(Z

,
Q
),
pZ

∈
Z

be
as
in
Proposition
2.2.
Now
observe
that
htZ

(pZ

)
=
htX
(x)
−
1
=
dim(X)
−
1,
and
that
14
V
→
UX
extends
to
a
ﬁnite
étale
covering
over
all
of
the
points
of
Z

of
height
1
(since
such
points
map
to
points
of
X
of
height
≤
2,
by
Proposition
2.2,
(3),
hence
to
points
in
X
−
{x}).
Thus,
it
follows
by
applying
the
induction
hypothesis
(plus
étale
descent,
and
the
statement
at
the
end
of
Proposition
2.2)
to
Z

that
for
some
appropriate
choice
of
pZ

n,
the
morphism
V
→
UX
extends
to
a
ﬁnite
étale
covering
over
the
normalization
Z
∗
of
Zp

(i.e.,
the
Zariski
localization
of
Z

at
pZ

)
in
UX
∗
.
Moreover,
since
Yp∗
∗
is
normal
Z
Y
and
maps
to
Zp

,
it
follows
that
Yp∗
∗
maps
to
Z
∗
.
Thus,
V
→
UX
extends
to
a
ﬁnite
Z
Y
étale
covering
over
Yp∗
∗
,
as
desired.
Since
DY
has
only
ﬁnitely
many
generic
points
pY
,
Y
taking
the
product
of
the
various
n’s
that
occur
for
each
pY
gives
us
an
“n”
for
which
the
claim
stated
above
is
valid.
This
completes
the
proof
of
the
claim.
To
simplify
notation,
let
us
replace
(X,
M
)
(respectively,
(Y,
N
))
by
(X
∗
,
M
∗
)
(respectively,
(Y
∗
,
N
∗
)).
Thus,
we
may
assume
that
the
morphism
V
→
UX
extends
to
a
ﬁnite
étale
covering
over
all
the
generic
points
of
DY
.
Since
DY
is
a
divisor
with
normal
crossings
in
the
regular
scheme
Y
,
we
may
thus
apply
the
classical
purity
theorem
to
conclude
that
V
→
UX
extends
to
a
ﬁnite
étale
covering
of
Y
.
On
the
other
hand,
by
Theorem
2.1,
π1
(Y
)
is
trivial.
That
is
to
say,
V
→
UX
extends
to
a
trivial
ﬁnite
étale
covering
of
Y
.
Since
Y
is
birational
to
UX
,
it
thus
follows
that
the
covering
V
→
UX
is
trivial,
as
desired.
Lemma
3.2.
In
the
situation
of
Lemma
3.1,
one
may
take
the
integer
n
to
be
prime
to
char(k),
the
characteristic
of
the
residue
ﬁeld
k
of
X
at
x.
Proof.
If
char(k)
=
0,
then
there
is
nothing
to
prove,
so
let
us
assume
that
char(k)
>
def
0.
Let
p
=
char(k).
Fix
a
clean
chart
for
(X,
M
),
and
let
(Y,
N
)
→
(X,
M
)
be
a
dilation
of
magnitude
p.
Assume
that
the
covering
V
→
UX
splits
over
Y
.
Then
it
suﬃces
to
prove
that
in
this
situation,
V
→
UX
necessarily
splits
over
X.
Note
that
there
always
exists
a
point
p
∈
X
of
height
one
such
that
p
∈
p
⊆
Γ(X,
OX
).
Let
s1
,
.
.
.
,
sr
∈
Γ(UX
,
OX
)
be
the
images
of
a
basis
e1
.
.
.
,
er
∈
P
gp
(under
the
composite
of
expM
with
the
clean
chart
P
gp
→
M
gp
).
Thus,
the
function
ﬁeld
k(Y
)
of
Y
is
obtained
1
1
from
the
function
ﬁeld
k(X)
of
X
by
adjoining
the
elements
s1p
,
.
.
.
,
srp
to
k(X).
Moreover,
Y
is
the
normalization
of
X
in
k(Y
).
For
i
=
1,
.
.
.
,
r,
let
Pi
be
the
saturation
of
P
in
<
P
gp
,
p1
·
e1
,
.
.
.
,
p1
·
ei
>⊆
p1
·
P
gp
.
Thus,
Pi
is
a
ﬁnitely
generated,
saturated,
integral
monoid
such
that
Pigp
=<
P
gp
,
p1
·
e1
,
.
.
.
,
p1
·
ei
>,
and
P
⊆
Pi
⊆
p1
·
P
.
Let
(Yi
,
Ni
)
be
the
def
log
scheme
obtained
from
X
by
letting
Yi
=
X
⊗Z[P
]
Z[Pi
],
and
taking
the
log
structure
Ni
to
be
that
associated
to
the
natural
chart
Pi
→
OYi
.
One
shows
as
in
Lemma
1.4
that
(Yi
,
Ni
)
is
log
regular.
Thus,
we
have
a
chain
of
morphisms
of
regular
log
schemes
factorizing
(Y,
N
)
→
(X,
M
):
(Y,
N
)
=
(Yr
,
Nr
)
→
(Yr−1
,
Nr−1
)
→
.
.
.
→
(Y1
,
N1
)
→
(X,
M
)
such
that
each
arrow
in
the
chain
is
ﬁnite
(over
X)
and
ﬂat
of
degree
p
(over
UX
).
Note
that
all
the
Yi
’s
are
local,
normal,
and
strictly
henselian.
Thus,
since
V
→
UX
is
tamely
15
ramiﬁed
over
the
generic
points
of
DX
,
it
follows
that
the
problem
is
as
follows:
Without
loss
of
generality,
we
may
assume
that
V
→
UX
is
connected
and
Galois.
Then
there
is
a
minimal
ﬁeld
KM
between
the
function
ﬁelds
k(X),
k(Y
)
of
X
and
Y
such
that
V
→
UX
splits
over
KM
.
Moreover,
KM
is
unramiﬁed
over
p.
Then
we
would
like
to
show
that
KM
=
k(X).
Thus,
by
localizing
at
p
and
considering
each
of
the
morphisms
(Yi+1
,
Ni+1
)
→
(Yi
,
Ni
),
we
see
that
we
are
reduced
to
proving
the
following
assertion:
(*)
Let
A
be
a
discrete
valuation
ring
with
residue
characteristic
p.
Let
K
be
the
quotient
ﬁeld
of
A.
Let
L
be
an
extension
of
K
of
degree
p
such
that
the
normalization
B
of
A
in
L
is
a
semilocal
Dedekind
domain
which
is
obtained
from
A
by
adjoining
pth
roots
of
elements
of
A.
Then
if
K

⊆
L
is
a
ﬁnite
extension
of
K
which
is
unramiﬁed
over
A,
then
it
follows
that
K

=
K.
Let
us
prove
(*):
First
of
all,
since
[L
:
K]
=
p,
if
K

=
K,
it
follows
that
L
=
K

.
But
this
implies
that
B
is
unramiﬁed
over
A.
Since
B
is
generated
over
A
by
pth
roots
of
elements
of
A,
it
follows
that
the
resulting
residue
ﬁeld
extensions
are
inseparable.
But
since
they
are
also
separable
(as
B
is
étale
over
A),
it
thus
follows
that
they
are
trivial.

(respectively,
B)

be
the
completion
of
A
(respectively,
B).
Thus,
B

is
a
direct
Let
A

Relative
to
this
description
of
B,

let
b
=
(a1
,
.
.
.
,
ap
)
∈
B

(where
product
of
p
copies
of
A.

be
such
that
bp
∈
A.

Then
it
follows
that
for
all
i,
j
=
1,
.
.
.
,
p,
we
have
a1
,
.
.
.
,
ap
∈
A)

On
the
other
api
=
apj
.
Thus,
a1
,
.
.
.
,
ap
all
have
the
same
image
in
the
residue
ﬁeld
of
A.


is
generated
over
A

by
such
b,
it
follows
that
any
element
(c1
,
.
.
.
,
cp
)
∈
B
hand,
since
B

satisﬁes
the
condition
that
the
ci
all
have
the
same
image
in
the
(where
c1
,
.
.
.
,
cp
∈
A)

But
this
is
absurd.
This
completes
the
proof
of
(*),
and
hence
of
the
residue
ﬁeld
of
A.
lemma.
The
following
is
an
unpublished
result
of
K.
Kato:
Theorem
3.3.
(Log
Purity
Theorem)
Let
(X,
M
)
be
a
regular
log
scheme.
Let
UY
→
UX
be
a
ﬁnite
étale
covering
of
the
interior
UX
of
X
which
is
tamely
ramiﬁed
over
the
generic
points
of
DX
→
X.
Let
Y
be
the
normalization
of
X
in
UY
.
Then
the
pair
(Y,
UY
)
is
toric
(cf.
Deﬁnition
1.2),
hence
deﬁnes
a
regular
log
scheme
(Y,
N
).
Moreover,
UY
→
UX
extends
uniquely
to
a
log
étale
morphism
(Y,
N
)
→
(X,
M
).
Proof.
Clearly,
one
may
assume
that
X
is
strictly
henselian.
Thus,
by
Lemmas
3.1
and
3.2,
it
follows
that
there
exists
an
integer
n
which
is
invertible
on
X
such
that
for
some
dilation
(Z,
L)
→
(X,
M
)
of
magnitude
n,
UY
→
UX
splits
over
UZ
.
Let
P
gp
→
M
gp
be
the
clean
chart
(cf.
Deﬁnition
1.3)
used
to
deﬁne
this
dilation.
Let
us
assume
(without
loss
of
generality)
that
UY
is
connected.
Then
the
function
ﬁeld
k(Y
)
of
UY
lies
between
the
function
ﬁelds
k(X)
(of
X)
and
k(Z)
(of
Z).
Moreover,
since
the
extension
k(Z)/k(X)
16
is
abelian
with
Galois
group
equal
to
(
n1
·
P
gp
)/P
gp
(tensored
with
the
group
of
nth
roots
of
unity),
it
follows
that
the
intermediate
ﬁeld
k(Y
)
corresponds
to
some
submodule
PYgp
of
n1
·
P
gp
that
contains
P
gp
.
Let
us
write
PY
for
the
smallest
saturated
submonoid
of
PYgp
containing
P
.
Thus,
we
have
P
⊆
PY
⊆
n1
·
P
;
PYgp
is
the
group
associated
to
PY
;
and
PY
is
a
ﬁnitely
generated
integral,
saturated
monoid.
Moreover,
if
we
equip
def
Y

=
X
×Z[P
]
Z[PY
]
with
the
log
structure
N

associated
to
the
natural
chart
deﬁned
by
PY
,
one
sees
immediately
(cf.
the
proof
of
Lemma
1.4)
that
(Y

,
N

)
is
log
regular,
and
that
the
natural
morphism
(Y

,
N

)
→
(X,
M
)
is
log
étale.
Moreover,
since
UY

may
be
identiﬁed
with
UY
,
and
Y

is
necessarily
normal,
it
follows
that
Y

may
be
identiﬁed
with
Y
,
and
that
(Y,
UY
)
=
(Y

,
UY

)
is
toric.
This
completes
the
proof
of
Theorem
3.3.
§4.
Families
of
Stable
Curves
Let
S
be
a
noetherian
scheme.
Let
f
:
X
→
S
be
a
morphism
of
ﬁnite
type,
and
DM
⊆
X
a
closed
subscheme.
Deﬁnition
4.1.
We
shall
call
(f
:
X
→
S,
DM
)
locally
stable
if
(1)
f
is
ﬂat;
(2)
the
geometric
ﬁbers
of
f
are
reduced,
connected,
one-dimensional,
and
have
at
most
nodes
as
singularities;
(3)
f
is
smooth
at
the
points
of
DM
,
and
DM
is
a
union
of
the
images
of
disjoint
sections
s1
,
.
.
.
,
sr
:
S
→
X.
We
shall
call
DM
the
divisor
of
marked
points.
When
DM
=
∅,
we
shall
simply
say
that
f
is
locally
stable.
Note
that
if
(f,
DM
)
is
locally
stable,
then
f
is
locally
stable.
It
is
easy
to
check
that
if
f
is
locally
stable,
then
it
is
a
local
complete
intersection,
and
in
particular,
Gorenstein.
Thus,
its
dualizing
sheaf
([12])
forms
a
natural
line
bundle
ωX/S
on
X.
In
general,
if
(f,
DM
)
is
locally
stable,
then
DM
⊆
X
forms
an
S-ﬂat
divisor
in
X;
thus,
one
may
consider
the
line
bundle
ωX/S
(DM
)
on
X.
We
remark
that
the
local
structure
of
locally
stable
morphisms
is
well-known
(cf.
[3]).
Indeed,
suppose
that
S
=
Spec(A),
where
A
is
a
complete
local
ring
with
separably
closed
residue
ﬁeld.
Suppose
further
that
(f
:
X
→
S,
DM
)
is
locally
stable,
and
that
x
∈
X
def

is
a
closed
point
of
X
lying
over
the
closed
point
s
∈
S
of
S,
and
write
B
=
O
X,x
(the
completed
local
ring
of
X
at
x).
Then
there
are
three
possibilities
for
the
local
structure
of
(X
→
S,
DM
):
17
(1)
f
is
smooth
at
x
and
x
∈
/
DM
:
Then
B
is
A-isomorphic
to
A[[t]]
(where
t
is
an
indeterminate).
(2)
f
is
smooth
at
x
and
x
∈
DM
:
Then
B
is
A-isomorphic
to
A[[t]]
(where
t
is
an
indeterminate)
and
DM
=
V
(t)
(i.e.,
DM
is
the
closed
subscheme
deﬁned
by
t).
(3)
f
is
not
smooth
at
x:
Then
B
is
A-isomorphic
to
A[[s,
t]]/(st
−
α),
where
s
and
t
are
indeterminates
and
α
∈
mA
(the
maximal
ideal
of
A).
In
fact,
for
an
arbitrary
locally
stable
(f
:
X
→
S,
DM
),
functions
such
as
“s”
and
“t”
can
be
found
after
étale
localization
on
X
and
S,
i.e.,
one
need
not
go
all
the
way
to
the
completions
of
X
and
S
at
the
points
in
question.
Lemma
4.2.
Suppose
that
(S,
US
)
is
a
toric
pair
(Deﬁnition
1.2)
–
i.e.,
US
is
the
interior
of
S.
Let
(f
:
X
→
S,
DM
)
be
locally
stable,
such
that
f
is
smooth
over
US
⊆
S.

def
Then
if
UX
=
f
−1
(US
)
(X
−
DM
)
⊆
X
(thus,
in
general,
UX
=
X
−
DM
),
then
(X,
UX
)
is
a
toric
pair.
In
particular,
X
is
normal.
Proof.
We
begin
by
proving
that
X
is
normal.
First,
we
observe
that
(by
the
above
discussion
of
the
local
structure
of
f
)
f
is
a
local
complete
intersection
morphism.
Thus,
to
check
that
X
is
normal,
it
suﬃces
to
check
that
X
is
regular
at
all
of
its
height
one
primes
(i.e.,
points).
Since
f
is
ﬂat,
such
primes
map
to
primes
of
height
≤
1
of
S.
Since
S
is
normal,
such
primes
of
S
will
be
regular.
Moreover,
since
f
is
smooth
over
US
,
hence
over
all
generic
points
of
S,
it
follows
(by
the
above
discussion
of
the
local
structure
of
f
)
that
it
suﬃces
to
check
the
following:
If
A
is
a
ﬁeld
or
a
complete
discrete
valuation
ring,
then
A[[t]]
and
A[[s,
t]]/(s
·
t
−
α)
(where
s
and
t
are
indeterminates
and
0
=
α
∈
mA
)
are
regular
at
primes
of
height
one.
But
this
is
clear.
This
completes
the
proof
that
X
is
normal.
Now
let
us
consider
the
monoid
def
M
=
OX

×
i∗
O
U
⊆
i∗
O
U
X
X
(where
i
:
UX
→
X
is
the
natural
inclusion).
It
follows
easily
from
the
above
discussion
of
the
local
structure
of
f
that
M
deﬁnes
a
ﬁne
log
structure
on
X.
Indeed,
in
case
(1)
above,
this
log
structure
is
simply
the
pull-back
to
X
of
the
log
structure
on
S.
In
case
(2)
above,
this
log
structure
is
the
result
of
adjoining
(to
the
pull-back
to
X
of
the
log
structure
on
S)
a
single
copy
of
N,
corresponding
to
some
deﬁning
equation
(i.e.,
“t”
in
the
above
discussion)
of
the
divisor
DM
.
In
case
(3)
above,
this
log
structure
is
the
result
of
adjoining
(to
the
pull-back
to
X
of
the
log
structure
on
S)
two
copies
of
N,
corresponding
(in
the
notation
of
the
above
discussion)
to
“s”
and
“t,”
together
with
a
single
relation,
corresponding
to
the
equation
“st
−
α.”
Let
us
denote
the
resulting
log
scheme
by
X
log
.
18
Since
X
is
normal,
it
follows
immediately
(from
the
above
deﬁnition
of
the
monoid
M
)
that
M
is
saturated.
Next,
let
us
observe
that
we
have
a
log
morphism
X
log
→
S
log
(of
saturated
ﬁne
log
schemes).
Moreover,
it
follows
easily
from
the
local
descriptions
of
the
preceding
paragraph
that
this
morphism
is
log
smooth.
Thus,
we
conclude
(by
[Kato2],
Theorem
8.2)
that
X
log
is
log
regular,
as
desired.
Deﬁnition
4.3.
We
shall
say
that
(f,
DM
)
is
stable
or
a
stable
curve
if
(f,
DM
)
is
locally
stable,
f
is
proper,
and
ωX/S
(DM
)
is
relatively
ample
over
S.
Suppose
that
(f,
DM
)
is
stable.
Then
note
that
f∗
ωX/S
forms
a
vector
bundle
on
S.
Naturally,
the
rank
of
this
vector
bundle
is
locally
constant.
When
it
is
constant,
we
shall
refer
to
this
rank
as
the
genus
g
of
(f,
DM
).
The
degree
of
the
divisor
DM
over
S
is
also
locally
constant
on
S.
When
it
is
constant,
we
shall
refer
to
this
degree
as
the
number
of
marked
points
r
of
(f,
DM
).
One
checks
easily
that
the
above
deﬁnition
of
a
stable
curve
is
equivalent
to
that
given
in
[3]
(when
DM
=
∅)
or,
more
generally,
a
pointed
stable
curve,
as
in
[10]
(except
that
in
the
above
deﬁnition
we
did
not
ﬁx
the
genus
or
the
number
of
marked
points,
and
we
did
not
assume
that
we
were
given
an
ordering
of
the
marked
points).
In
particular,
as
one
knows
from
[3]
and
[10],
there
is
a
natural
moduli
stack
Mg,r
→
Spec(Z)
of
r-pointed
stable
curves
of
genus
g
over
Z.
Moreover,
it
follows
from
the
condition
that
ωX/S
(D)
be
relatively
ample
that
2g
−
2
+
r
≥
1
Now
let
U
be
an
S-scheme
of
ﬁnite
type.
Deﬁnition
4.4.
We
shall
call
U
→
S
a
hyperbolic
curve
if
there
exists
a
surjective
étale
morphism
T
→
S,
together
with
a
stable
curve
(Y
→
T,
D)
such
that:
(i)
Y
→
T
is
def
smooth;
and
(ii)
UT
=
U
×S
T
is
T
-isomorphic
to
Y
−
D.
In
this
paper,
the
preﬁx
“poly-”
will
be
used
to
mean
“successive
extensions
or
families
of.”
Thus,
we
have
the
following
generalizations
of
“stable
curves”
and
“hyperbolic
curves”:
Let
f
:
X
→
S
be
a
morphism
of
ﬁnite
type,
and
D
⊆
X
a
closed
subscheme.
19
Deﬁnition
4.5.
We
shall
say
that
(f
:
X
→
S,
D)
is
polystable
or
a
stable
polycurve
if
the
following
data
exist:
a
factorization
X
=
X0
f0
−→
X1
f1
−→
X2
...
fi
Xi
−→
Xi+1
...
fn
Xn
−→
Xn+1
=
S
together
with
a
decomposition
D=
n+1

φ−1
i
(Di
)
i=0
(where
Di
⊆
Xi
is
a
closed
subscheme;
φ0
:
X
→
X
is
the
identity;
and,
for
each
i
=
def
1,
.
.
.
,
n
+
1,
we
let
φi
=
fi−1
◦
fi−2
◦
.
.
.
◦
f1
◦
f0
:
X
=
X0
→
Xi
)
of
D
into
a
(schematic)
union
of
closed
subschemes,
satisfying
the
following
properties:
(1)
For
each
i
=
0,
.
.
.
,
n,
the
pair
(fi
:
Xi
→
Xi+1
,
Di
)
is
a
stable
curve.
Moreover,
S
is
normal
in
a
neighborhood
of
Dn+1
,
and
Dn+1
is
a
reduced
divisor
in
S.
def
(2)
Let
Un+1
=
Xn+1
−
Dn+1
⊆
Xn+1
=
S.
For
i
=
0,
.
.
.
,
n,
if
Ui+1
⊆

def
−1
Xi+1
is
deﬁned,
then
let
Ui
=
fi+1
(Ui+1
)
(Xi
−
Di
)
⊆
Xi
.
Then
we
assume
that
(for
each
i
=
0,
.
.
.
,
n)
fi
is
smooth
over
Ui+1
(for
i
=
0,
.
.
.
,
n).
def
We
shall
refer
to
UX
=
X
−
D
=
U0
⊆
X0
=
X
as
the
interior
of
X.
In
particular,
it
follows
from
Lemma
4.2
if
(S,
Un+1
)
is
a
toric
pair,
and
(f,
D)
is
polystable,
then
(X,
U0
)
it
also
a
toric
pair.
In
this
situation,
we
shall
say
“(f,
D)
is
polystable
over
(S,
Un+1
),”
or
that
“(X,
U0
)
→
(S,
Un+1
)
is
polystable.”
If
(X,
MX
)
and
(S,
MS
)
are
the
log
schemes
associated
to
(X,
U0
)
and
(S,
Un+1
),
respectively,
then
we
shall
say
that
“(X,
MX
)
→
(S,
MS
)
is
(log)
polystable.”
Now
let
U
be
an
S-scheme
of
ﬁnite
type.
Deﬁnition
4.6.
We
shall
say
that
f
:
U
→
S
is
polyhyperbolic
or
a
hyperbolic
polycurve
if
the
following
data
exist:
a
factorization
U
=
U0
f0
−→
U1
f1
−→
U2
...
fi
Ui
−→
Ui+1
20
...
Un
fn
−→
Un+1
=
S
such
that
each
fi
(for
i
=
0,
.
.
.
,
n)
is
a
hyperbolic
curve.
Remark.
Some
people
are
in
the
habit
of
referring
to
hyperbolic
polycurves
as
“Artin
neighborhoods.”
In
fact,
strictly
speaking,
however,
these
two
notions
are
not
equivalent:
Indeed,
in
the
deﬁnition
of
an
Artin
neighborhood,
the
morphisms
fi
(of
Deﬁnition
4.6)
are
required
to
be
aﬃne.
On
the
other
hand,
in
the
deﬁnition
of
an
Artin
neighborhood,
the
genus
g
and
number
of
marked
points
r
need
not
satisfy
the
inequality
2g
−
2
+
r
≥
1.
Thus,
neither
of
these
two
notions
is
stronger
than
the
other.
§5.
Functoriality
of
the
Locus
of
Indeterminacy
Let
A
be
a
noetherian
ring.
Let
Z
be
an
integral,
projective
A-scheme
of
ﬁnite
type.
Thus,
we
assume
that
Z
admits
a
closed
immersion
Z
→
PN
A
into
some
projective
space
over
A.
In
particular,
there
exists
a
very
ample
line
bundle
L
on
Z.
Let
X
and
Y
be
normal,
connected,
separated
noetherian
schemes.
Let
α:Y
→X
be
a
ﬁnite
morphism.
Suppose
that
we
are
given
also
given
a
morphism
fU
:
U
→
Z
deﬁned
on
some
open
subscheme
U
⊆
X
such
that
X
−
U
has
codimension
≥
2
in
X.
Since
Z
is
separated,
it
follows
that
any
extension
of
fU
to
an
open
subset
U

⊆
X
that
contains
U
is
unique.
Thus,
there
exists
a
maximal
open
subscheme
U
⊆
X
to
which
fU
extends.
Deﬁnition
5.1.
We
shall
call
U
the
locus
of
determinacy
for
fU
,
and
we
shall
call
its
complement
X
−
U
(a
closed
subset
of
X)
the
locus
of
indeterminacy
for
fU
.
def
Let
V
=
α−1
(U
)
⊆
Y
.
Let
us
suppose
that
Y
−
V
has
codimension
≥
2
in
Y
.
Thus,
we
can
deﬁne
V
⊆
Y
,
i.e.,
the
locus
of
determinacy
for
α
◦
fU
.
Then
it
is
natural
to
ask
what
the
relationship
is
between
U
and
V
.
On
the
one
hand,
it
follows
tautologically
from
the
deﬁnitions
that
f
−1
(U
)
⊆
V
The
reverse
inclusion
is
more
subtle.
In
order
to
analyze
the
reverse
inclusion,
let
us
def
consider
the
line
bundle
LU
=
fU∗
L.
Note
that
since
X
is
normal
and
X
−
U
has
codimension
≥
2
in
X,
it
follows
that
any
extension
of
LU
to
an
open
subset
of
X
containing
21
U
is
unique.
Note
further
that
it
is
clear
(from
the
fact
that
fU
extends
to
a
morphism
fU
:
U
→
Z)
that
LU
extends
to
a
line
bundle
LU
on
U
.
Lemma
5.2.
V
=
α−1
(U
).
Suppose
that
LU
extends
to
a
line
bundle
LX
on
X.
Then
it
follows
that
Proof.
Note
that
since
Z
is
projective
over
A,
it
follows
that
Γ(Z,
L)
is
a
ﬁnitely
generated
A-module.
Let
s1
,
.
.
.
,
sN
∈
Γ(Z,
L)
be
a
set
of
generating
sections
of
Γ(Z,
L).
Note
that
each
si
may
be
pulled
back
to
a
section
si
|U
∈
Γ(U,
LU
)
which
extends
uniquely
(since
X
is
normal)
to
a
section
si
|X
∈
Γ(X,
LX
).
Now
I
claim
that:
def
(*)
The
closed
subset
FX
=
X
−
U
⊆
X
coincides
with
the
common
zero
locus
NX
(regarded
as
a
closed
subset
of
X)
of
the
sections
s1
|X
,
.
.
.
,
sN
|X
of
LX
over
X.
Indeed,
since
s1
,
.
.
.
,
sN
have
no
common
zeroes
on
Z,
one
concludes
immediately
that
s1
|X
,
.
.
.
,
sN
|X
have
no
common
zeroes
on
U
,
so
NX
⊆
FX
.
On
the
other
hand,
over
def
the
open
subscheme
U

=
X
−
NX
⊆
X,
since
s1
|U

,
.
.
.
,
sN
|U

have
no
common
zeroes
N
on
U

,
they
deﬁne
a
morphism
U

→
PN
A
whose
image
is
contained
in
Z
→
PA
(where
the
inclusion
“→”
is
that
deﬁned
by
s1
,
.
.
.
,
sN
)
and
whose
restriction
to
U
is
fU
.
Thus,
U

⊆
U
,
so
FX
⊆
NX
.
Thus,
FX
=
NX
.
This
completes
the
proof
of
the
claim.
def
Now
let
FY
=
Y
−
V
⊆
Y
(a
closed
subset
of
Y
).
Note
that
LV
extends
(uniquely)
to
a
line
bundle
LY
=
α∗
LX
on
Y
.
Thus,
we
have
sections
s1
|Y
,
.
.
.
,
sN
|Y
∈
Γ(Y,
LY
).
Let
NY
be
the
common
zero
locus
NY
(regarded
as
a
closed
subset
of
Y
)
of
the
sections
s1
|Y
,
.
.
.
,
sN
|Y
of
LY
over
Y
.
Then
by
the
same
argument
as
that
given
for
(*)
above,
we
have
that
FY
=
NY
.
On
the
other
hand,
since
si
|Y
=
α∗
(si
|X
)
(for
i
=
1,
.
.
.
,
N
),
it
is
clear
that
NY
=
α−1
(NX
)
(as
closed
subsets).
Thus,
we
obtain
that
FY
=
α−1
(FX
),
hence
that
V
=
α−1
(U
),
as
desired.
Corollary
5.3.
Suppose
that
α
:
Y
→
X
is
dominant,
and
V
=
Y
.
Then
U
=
X.
Proof.
Since
α
is
ﬁnite
and
dominant,
and
X
is
integral,
it
follows
that
α
is
surjective.
Since
fU
extends
to
a
morphism
Y
→
Z,
it
follows
that
LV
extends
to
a
line
bundle
LY
on
Y
.
Thus,
by
taking
the
norm
of
LY
,
we
obtain
a
line
bundle
on
X
which
extends
some
tensor
power
of
LU
.
In
particular,
by
replacing
the
original
very
ample
L
by
a
power
of
L,
we
see
that
we
can
apply
Lemma
5.2.
Thus,
U
=
α(α−1
(U
))
=
α(V
)
=
α(Y
)
=
X,
as
desired.
In
fact,
we
shall
often
wish
to
apply
Lemma
5.2
(or
Corollary
5.3)
when
Z
is
not
necessarily
a
projective
scheme
over
A,
but
instead
an
integral
algebraic
stack
over
A
whose
associated
coarse
moduli
space
(as
in
[4],
Chapter
1,
Theorem
4.10)
is
a
projective
22
scheme
over
A.
In
fact,
the
main
example
that
we
have
in
mind
is
the
moduli
stack
def
M
=
Mg,r
→
Spec(Z)
(for
some
nonnegative
integers
g
and
r
such
that
2g
−
2
+
r
≥
1
c
–
cf.
§1),
whose
associated
coarse
moduli
space
M
is
well-known
to
be
projective
over
Z
(cf.
[16],
Corollary
5.18).
Unfortunately,
we
cannot
apply
Lemma
5.2
or
Corollary
5.3
immediately
in
the
case
of
a
general
algebraic
stack
Z,
but
in
the
special
case
of
M,
we
can
still
make
use
of
Lemma
5.2
or
Corollary
5.3
by
applying
Lemma
5.2/Corollary
5.3
in
tandem
with
Lemma
5.4
or
Lemma
5.5
below.
Let
l
≥
3
be
a
prime
number.
Let
M
⊆
M
be
the
open
substack
parametrizing
smooth
curves.
Let
C
→
M
be
the
tautological
curve
over
M.
Let
J
→
M
be
the
Jacobian
of
the
tautological
curve.
Write
J
[l]
for
the
kernel
of
the
map
J
→
J
given
by
multiplication
by
l.
Thus,
J
[l]
⊗
Z[
1l
]
is
étale
over
M
⊗
Z[
1l
],
and
may
be
thought
of
as
a
local
system
of
abelian
groups
isomorphic
to
(Z/l
·
Z)2g
.
Write
M[l]
→
M
⊗
Z[
1l
]
for
the
ﬁnite
étale
covering
of
“level
structures,”
i.e.,
isomorphisms
of
this
local
system
with
(Z/l
·
Z)2g
.
Thus,
M[l]
is
étale
over
M
⊗
Z[
1l
],
and
tamely
ramiﬁed
over
the
divisor
at
inﬁnity
of
M
⊗
Z[
1l
]
(cf.,
e.g.,
§3.22,
3.23,
of
[14]).
The
following
two
lemmas
are
well-known
(cf.,
e.g.,
Lemma
2.1
of
[1]):
Lemma
5.4.
Let
X
be
a
normal,
connected,
separated
noetherian
scheme
with
generic
point
η.
Let
fη
:
η
→
M
be
a
morphism
that
lifts
to
a
morphism
hη
:
η
→
M[l],
where
l
c
c
is
invertible
on
X.
Write
fηc
:
η
→
M
for
the
composite
of
fη
with
M
→
M
.
Suppose
c
further
that
fηc
extends
to
a
morphism
f
c
:
X
→
M
.
Then
fη
extends
uniquely
to
a
morphism
f
:
X
→
M.
c
Proof.
Note
that
since
M
=
M
when
g
=
0,
we
may
assume
that
g
≥
1.
Moreover,
since
Mg,r
→
Mg,r−1
(where
2g
−
2
+
r
−
1
≥
1)
is
projective,
it
follows
that
we
may
assume
that
either
r
=
0,
or
g
=
r
=
1.
Thus,
in
the
following
we
assume
that
either
r
=
0
or
g
=
r
=
1.
By
standard
techniques
(e.g.,
replacing
X
by
a
scheme
of
ﬁnite
type
over
Z,
completing
at
a
prime,
and
then
enlarging
the
residue
ﬁeld),
we
may
assume
that
X
=
Spec(R),
where
R
is
a
complete
local
ring
with
separably
closed
residue
ﬁeld.
Let
us
denote
the
closed
point
of
X
by
x,
and
the
quotient
ring
of
R
by
K.
Let
M
c
be
the
strict
henselization
of
c
def
M
at
f
c
(x);
let
M
=
M
×Mc
M
c
.
Thus,
there
is
a
strict
henselian
regular
local
ring
Q,
def
equipped
with
the
action
of
a
ﬁnite
group
G,
such
that
M
is
the
quotient
of
M

=
Spec(Q)
by
G
“in
the
sense
of
stacks,”
and
M
c
=
Spec(QG
)
(cf.
[4],
Chapter
1,
Theorem
4.10).
Here,
G
is
the
automorphism
group
of
the
curve
f
c
(x)
(cf.
[4],
Chapter
1,
Theorem
4.10).
Moreover,
f
c
factors
through
M
c
.
Thus,
since
M
=
M
×Mc
M
c
,
it
follows
that
fη
factors
through
M
.
Denote
the
resulting
morphism
by
fηM
:
η
→
M
.
Now
I
claim
that:
(*)
The
morphism
fηM
:
η
→
M
factors
through
M

=
Spec(Q).
23
Before
proving
this
claim,
let
us
observe
that
this
claim
completes
the
proof
of
Lemma
5.4.
Indeed,
the
claim
states
that
fηM
:
η
→
M
factors
through
some
morphism
η
→
M

.
Moreover,
since
Q
is
ﬁnite
over
QG
,
X
is
normal,
and
we
have
a
morphism
X
→
M
c
,
we
thus
conclude
that
the
morphism
η
→
M

extends
to
a
morphism
X
→
M

.
Thus,
in
particular,
fηM
:
η
→
M
extends
to
a
morphism
X
→
M
,
so
fη
:
η
→
M
extends
to
a
morphism
f
:
X
→
M,
as
desired.
The
uniqueness
statement
follows
from
the
fact
that
M
is
a
separated
algebraic
stack.
Now
let
us
prove
(*).
Let
C
→
M
be
the
tautological
curve.
Write
m
∈
M
for
the
closed
point
of
M
,
and
Cm
for
the
ﬁber
of
C
→
M
over
m.
Note
that
since
l
is
invertible
∼
on
X,
it
follows
that
any
line
bundle
Lm
on
Cm
such
that
L⊗l
m
=
OCm
lifts
uniquely
to
def
a
line
bundle
L
on
C

=
C
×M
M

such
that
(L
)⊗l
∼
=
OC

.
It
thus
follows
that
the
th
“line
bundles
on
C
whose
l
power
is
trivial”
form
an
étale
local
system
on
M
which
is
étale
locally
isomorphic
to
(Z/l
·
Z)a
,
for
some
nonnegative
integer
a
≤
2g.
Let
us
denote
by
N
→
M
the
ﬁnite
étale
covering
parametrizing
isomorphisms
of
this
local
system
to
(Z/l
·
Z)a
.
Thus,
N
is
a
stack
parametrizing
curves
equipped
with
line
bundles
satisfying
certain
properties.
By
[2],
Corollaire
5.17,
and
[3],
Theorem
1.13,
the
curve
plus
line
bundle
pairs
corresponding
to
the
closed
points
of
N
have
no
automorphisms.
Thus,
N
is
in
fact
a
scheme.
More
precisely,
N
is
a
ﬁnite
disjoint
union
of
spectra
of
strictly
henselian
regular
local
rings.
Since
M

→
M
is
ﬁnite
étale,
it
thus
follows
that
the
morphism
N
→
M
factors
through
M

.
Thus,
to
prove
(*),
it
suﬃces
to
prove
that
fηM
:
η
→
M
factors
through
N
.
But
this
is
a
consequence
of
the
fact
that
the
l-torsion
points
of
the
Jacobian
of
the
curve
def
Cη
=
C
×M
η
are
all
deﬁned
over
η
(by
the
existence
of
hη
).
This
completes
the
proof
of
(*),
and
hence
of
Lemma
5.4.
Lemma
5.5.
Let
X
be
an
integral
separated
noetherian
scheme
with
generic
point
η.
Suppose,
moreover,
that
X
has
the
following
property:
(*)
The
completions
of
the
local
rings
of
X
are
normal
complete
intersections.
Let
fη
:
η
→
M
be
a
morphism.
Assume
that
either
(1)
fη
extends
over
all
the
points
of
X
of
height
≤
2;
or
(2)
X
is
regular
and
fη
extends
over
all
the
points
of
X
of
height
≤
1.
c
c
Write
fηc
:
η
→
M
for
the
composite
of
fη
with
M
→
M
.
Suppose
further
that
fηc
extends
c
to
a
morphism
f
c
:
X
→
M
.
Then
fη
extends
uniquely
to
a
morphism
f
:
X
→
M.
Proof.
By
(*),
we
reduce
immediately
(by
descent)
to
the
case
where
X
=
Spec(R),
where
R
is
a
complete
local
ring
with
separably
closed
residue
ﬁeld.
Now
let
us
use
the
24
notation
of
the
proof
of
Lemma
5.4.
Just
as
in
the
proof
of
Lemma
5.4,
it
suﬃces
to
show
that
the
morphism
fηM
:
η
→
M
factors
through
M

=
Spec(Q).
Note
that
M

→
M
is
a
ﬁnite
étale
morphism.
If
we
pull
it
back
via
fηM
,
we
thus
get
a
ﬁnite
étale
morphism
η

→
η.
Clearly,
it
suﬃces
to
show
that
η

→
η
admits
a
section.
But
note
that
the
assumptions
of
the
lemma
imply
that
η

→
η
extends
to
a
ﬁnite
étale
covering
either
over
the
primes
of
R
of
height
≤
2
(under
assumption
(1))
or
over
the
primes
of
R
of
height
≤
1
(under
assumption
(2),
in
which
case
R
is
regular).
In
either
case,
by
[18],
Exposé
X,
p.
118,
Théorème
3.4,
it
follows
that
η

→
η
extends
to
a
ﬁnite
étale
covering
X

→
X
over
X
=
Spec(R).
Since
X
is
strictly
henselian,
this
covering
thus
admits
a
section.
Thus,
η

→
η
also
admits
a
section,
as
desired.
Remark.
We
would
like
to
apply
Lemma
5.5
when
X
has
toric
singularities
(cf.
Deﬁnition
1.2).
Observe
that
in
this
case,
(since
the
completion
(at
a
point)
of
a
regular
log
scheme
is
again
a
regular
log
scheme)
X
automatically
satisﬁes
the
normality
part
of
the
assumption
(*)
in
Lemma
5.5
(cf.
the
discussion
following
Deﬁnition
1.1).
Before
continuing,
we
make
a
deﬁnition
which
will
be
important
in
the
following
§’s:
Let
X
be
a
normal
noetherian
scheme.
Let
D
⊆
X
be
an
eﬀective
Weil
divisor
in
X,
and
def
let
U
=
X
−
D.
Thus,
U
is
a
dense
open
subscheme
of
X.
Suppose
that
we
are
given
a
morphism
hU
:
U
→
M
such
that
hU
(U
)
⊆
M.
Deﬁnition
5.6.
Let
l
be
a
prime
number.
We
shall
say
that
hU
admits
a
level
l
structure
if
it
factors
through
M[l].
Note
that
it
follows
from
[2],
Corollaire
5.18
and
Proposition
5.7
(and
the
fact
that
Mg,r+1
→
Mg,r
is
projective)
that
if
hU
admits
a
level
l
structure,
then
hU
extends
(as
a
morphism
to
M)
over
the
generic
points
of
D.
Finally,
we
include
one
more
(well-known)
result
concerning
the
locus
of
indeterminacy
which
we
will
use
in
the
following.
Let
X,
U
,
Z,
and
A
be
as
above.
Moreover,
just
as
above,
we
assume
that
we
are
given
a
morphism
fU
:
U
→
Z
Assume
further
that
X
has
the
structure
of
an
A-scheme,
and
that
fU
is
a
morphism
of
A-schemes.
Then
we
have
the
following
result:
25
Lemma
5.7.
Suppose
that
φ
:
X

→
X
is
a
projective
morphism
between
normal,
connected,
separated
noetherian
schemes
which
is
an
isomorphism
over
U
.
Suppose,
moreover,
that
fU
:
U
→
Z
extends
to
X

and
that
for
each
x
∈
X,
this
extension
of
fU
maps
φ−1
(x)
⊆
X

to
a
point.
Then
fU
extends
to
X.
Proof.
Let
Γ
⊆
X
×A
Z
be
the
closure
(with
the
reduced
induced
scheme
structure)
in
X
×A
Z
of
the
graph
ΓU
⊆
U
×A
Z
of
fU
.
Let
Γ
⊆
X

×A
Z
be
the
graph
of
the
extension
def
to
X

of
fU
.
Let
U

=
φ−1
(U
).
Thus,
U

∼
=
U
.
Since
Γ
is
the
closure
of
the
graph
ΓU
of
the
composite
of
U

∼
=
U
with
fU
,
and
ΓU
maps
isomorphically
to
ΓU
under
the
morphism

φZ
:
X
×A
Z
→
X
×A
Z,
it
follows
that
φZ
maps
Γ
into
Γ.
Thus,
we
have
a
morphism
β
:
X
∼
=
Γ
→
Γ
together
with
a
projection
morphism
π
:
Γ
→
X
such
that
π
◦
β
=
φ.
Let
x
∈
X.
Then
by
assumption,
φ−1
(x)
⊆
X

maps
under
β
to
a
single
point
of
Γ
⊆
X
×A
Z.
In
particular,
(since
β
is
surjective)
it
follows
that
π
:
Γ
→
X
is
quasi-ﬁnite.
Since
π
is
also
projective,
it
follows
that
π
is
ﬁnite.
Since
π
is
an
isomorphism
over
U
,
Γ
is
integral,
and
X
is
normal,
it
thus
follows
that
π
is
an
isomorphism.
Thus,
fU
extends
to
X,
as
desired.
§6.
The
Extension
Theorem
If
g
and
r
are
nonnegative
integers
such
that
2g
−
2
+
r
≥
1,
let
us
write
Mg,r
→
Spec(Z)
for
the
moduli
stack
of
r-pointed
stable
curves
of
genus
g
over
Z,
and
Mg,r
⊆
Mg,r
for
the
open
substack
parametrizing
smooth
curves
(cf.
[3],
[10]).
The
following
is
the
main
result
of
the
present
paper:
Theorem
6.1.
(Extension
Theorem)
Let
(X,
M
)
be
a
regular
log
scheme.
Let
UX
⊆
X
be
the
interior
of
X,
i.e.,
the
open
subscheme
where
the
log
structure
M
is
trivial.
c
def
def
Write
M
=
Mg,r
,
M
=
Mg,r
.
Let
M
be
the
coarse
moduli
space
associated
to
Mg,r
.
Suppose
that
we
are
given
a
morphism
hUX
:
UX
→
M
c
which
satisﬁes
hUX
(UX
)
⊆
M.
Let
us
denote
by
hcUX
:
UX
→
M
the
composite
of
hUX
c
with
M
→
M
.
Then:
(1)
If
hUX
extends
over
the
generic
points
of
DX
,
then:
(i)
hcUX
extends
to
X;
(ii)
there
exists
a
surjective,
quasi-ﬁnite,
log
étale
morphism
26
(Y,
N
)
→
(X,
M
)
(where
(Y,
N
)
is
log
regular)
such
that
hUX
extends
over
Y
.
(2)
If
hUX
extends
over
all
points
of
X
of
height
≤
2,
and
X
is
a
local
complete
intersection,
then
hUX
extends
to
X.
(3)
If
for
some
l
≥
3
which
is
invertible
on
X,
hUX
admits
a
level
l
structure
(cf.
Deﬁnition
5.6),
then
hUX
extends
to
X.
Proof.
By
Lemma
5.5
(1),
it
follows
that
assertion
(1)
implies
assertion
(2).
Moreover,
part
(i)
of
assertion
(1)
follows
immediately
from
part
(ii)
of
assertion
(1);
Corollary
5.3;
and
the
technique
of
étale
descent.
(Note:
Up
to
étale
localization
on
X,
one
may
always
assume
that
the
morphism
Y
→
X
of
part
(ii)
is
ﬁnite!)
Next,
let
us
observe
(relative
to
the
proof
of
part
(ii)
of
assertion
(1))
that
by
the
log
purity
theorem
(Theorem
3.3),
it
follows
that
after
replacing
(X,
M
)
by
some
(Y,
N
)
as
in
part
(ii)
of
assertion
(1),
one
may
always
assume
that
hUX
:
UX
→
M
admits
a
level
l
structure
(cf.
Deﬁnition
5.6)
for
some
prime
l
≥
3.
Thus,
in
order
to
complete
the
proof
Theorem
6.1,
it
suﬃces
to
prove
assertion
(3).
In
order
to
prove
assertion
(3),
we
may
assume
(by
using
faithfully
ﬂat
descent)
that
X
is
the
spectrum
of
a
complete,
local,
strictly
henselian
ring
(with
closed
point
x).
Thus,
in
particular,
X
is
ﬁnite-dimensional.
The
rest
of
the
proof
will
be
by
induction
on
dim(X).
The
case
dim(X)
=
1
is
trivial.
The
case
dim(X)
=
2
follows
from
Corollaries
1.8,
5.3
(of
the
present
paper),
together
with
Theorem
5.1
of
[7].
Now
let
us
assume
that
dim(X)
≥
3.
We
may
thus
assume
that
Theorem
6.1
holds
for
regular
log
schemes
of
dimension
≤
dim(X)
−
1.
In
particular,
we
may
assume
that
hUX
extends
over
X
−
{x}.
Let
(Y,
N
)
→
(X,
M
)
be
a
blow-up
morphism
as
in
Theorem
2.1.
Note
that
the
fact
that
hUX
admits
a
level
l
structure
(for
some
prime
l
≥
3)
implies
that
hUX
extends
over
all
the
generic
points
of
DY
(cf.
the
discussion
following
Deﬁnition
5.6).
Since
DY
is
a
divisor
with
normal
crossings
in
the
regular
scheme
Y
,
we
may
thus
apply
Theorem
5.1
of
[7]
to
conclude
that
hUX
extends
over
Y
.
Let
us
denote
this
extension
by
hY
:
Y
→
M.
def
Let
Z
⊆
Y
be
as
in
Theorem
2.1.
Thus,
UZ
⊆
Z
is
a
product
of
Gm
’s
over
k
=
k(x).
Now
I
claim
that
(in
the
language
of
[7],
§3)
the
topological
type
of
the
curve
over
UZ
deﬁned
by
hY
|UZ
is
locally
constant
over
UZ
.
But
this
follows
by
the
same
argument
as
that
used
in
[7]
(cf.
especially
§5.2,
the
third
paragraph
of
p.
554;
§3):
Namely,
let
u
∈
UZ
.
Then
any
irreducible
component
of
DY
at
u
necessarily
contains
the
generic
point
of
UZ
(cf.
Theorem
2.1).
But
one
knows
in
general
([7],
§3)
that
the
topological
type
of
the
curve
deﬁned
by
hY
is
locally
constant
on
each
of
the
strata
deﬁned
by
the
various
intersections
of
the
irreducible
components
of
DY
(in
an
étale
neighborhood
of
u).
Thus,
it
follows
that
the
topological
type
of
the
curve
in
question
is
locally
constant
over
UZ
.
This
completes
the
proof
of
the
claim.
27
On
the
other
hand,
since
UZ
is
a
product
of
Gm
’s
over
k,
it
follows
from
Lemma
4.1
of
[7]
that
hcY
|UZ
is
constant.
Thus,
hcY
maps
Z
to
a
point.
Now
since
X
is
normal,
the
ﬁbers
of
Y
→
X
are
connected.
Thus,
it
follows
that
hcY
maps
f
−1
(x)red
to
a
point.
Thus,
by
Lemma
5.7,
it
follows
that
hcY
factors
through
X,
i.e.,
hcUX
extends
to
a
morphism
c
hcX
:
X
→
M
.
Finally,
by
Lemma
5.4,
we
conclude
that
hY
factors
through
X,
i.e.,
that
hUX
extends
to
a
morphism
hX
:
X
→
M,
as
desired.
Corollary
6.2.
Let
S
be
a
noetherian
scheme;
and
(f
:
X
→
S,
D)
be
polystable
(cf.
Deﬁnition
4.5).
Suppose
that
(X

,
U

)
is
a
toric
pair,
and
that
X

has
the
structure
of
an
S-scheme.
Let
hU

:
U

→
X
def
be
a
morphism
of
S-schemes
such
that
hU

(U

)
⊆
UX
=
X
−D.
Then
hU

extends
uniquely
to
a
morphism
hX

:
X

→
X.
Proof.
Suppose
that
the
composite
hU

[i
+
1]
:
U

→
Xi+1
of
hU

with
φi+1
:
X
→
Xi+1
extends
to
a
morphism
hX

[i+1]
:
X

→
Xi+1
(for
some
i
=
0,
.
.
.
,
n).
(For
instance,
in
the
case
i
=
n,
we
know
that
hU

[n
+
1]
extends
to
a
morphism
hX

[n
+
1]
:
X

→
Xn+1
=
S
–
indeed,
one
can
simply
take
the
structure
morphism
X

→
S
for
hX

[n
+
1].)
Then
we
would
like
to
show
that
hU

[i]
extends
to
a
morphism
hX

[i]
:
X

→
Xi
.
If
we
can
show
the
existence
of
hX

[i]
whenever
hX

[i
+
1]
is
assumed
to
exist,
then
reverse
induction
on
i
implies
the
conclusion
of
Corollary
6.2.
Thus,
it
suﬃces
to
show
(for
i
=
0,
.
.
.
,
n)
that
(*)
If
the
extension
hX

[i
+
1]
:
X

→
Xi+1
exists,
then
the
extension
hX

[i]
:
X

→
Xi
exists.
Let
us
show
(*).
First,
consider
the
stable
curve
(fi
:
Xi
→
Xi+1
,
Di
).
This
curve
deﬁnes
a
classifying
morphism
α
:
Xi+1
→
M
=
Mg,r
(for
some
g,
r).
Moreover,
Xi
→
Xi+1
may
be
identiﬁed
with
the
pull-back
by
α
of
the
tautological
curve
C
→
M,
i.e.,
Xi
=
C
×M,α
Xi+1
.
Let
θ
:
U

→
C
be
the
morphism
obtained
by
composing
U

→
Xi
with
the
projection
Xi
→
C.
Next,
observe
that
C
may
be
identiﬁed
with
Mg,r+1
.
Thus,
Theorem
6.1
implies
c
that
θ
c
:
U

→
C
extends
to
X

.
But
clearly
c
Xi
=
C
×M
Xi+1
→
C
×Mc
Xi+1
is
a
quasi-ﬁnite
(hence
ﬁnite)
surjective
morphism
of
projective
schemes
over
Xi+1
.
Morec
over,
we
have
just
seen
that
U

→
C
×Mc
Xi+1
extends
to
X

.
Thus,
Corollary
5.3
implies
that
U

→
Xi
extends
to
X

,
as
desired.
28
§7.
Application
to
Hyperbolic
Polycurves
Let
(S,
US
)
be
a
toric
pair.
Let
(X,
UX
)
→
(S,
US
)
be
polystable
(cf.
Deﬁnition
4.5).
Then
it
follows
immediately
from
the
deﬁnitions
(especially
property
(2)
of
Deﬁnition
4.5)
that
the
morphism
between
the
interiors
h
:
UX
→
US
is
a
hyperbolic
polycurve
(cf.
Deﬁnition
4.6).
Deﬁnition
7.1.
We
shall
refer
to
a
polyhyperbolic
morphism
h
:
UX
→
US
that
arises
in
the
above
fashion
from
a
polystable
(X,
UX
)
→
(S,
US
)
as
compactiﬁable.
Moreover,
if
h
is
compactiﬁable,
we
shall
refer
to
(X,
UX
)
→
(S,
US
)
as
a
compactiﬁcation
of
h.
Now
let
(S,
US
)
be
a
toric
pair;
and
let
h
:
UX
→
US
be
an
arbitrary
polyhyperbolic
morphism.
That
is
to
say,
we
do
not
assume
that
h
is
compactiﬁable.
In
this
§,
we
would
like
to
show
that
under
certain
conditions,
h
necessarily
admits
a
compactiﬁcation
which
is
“natural”
in
the
sense
that
it
is
functorial
with
respect
to
certain
types
of
morphisms.
Deﬁnition
7.2.
Let
UX
→
US
be
a
hyperbolic
curve.
We
shall
say
that
it
is
split
if
(cf.
Deﬁnition
4.4)
there
exists
a
stable
curve
(Y
→
US
,
DM
)
such
that:
(i)
Y
→
US
is
smooth;
(ii)
UX
is
US
-isomorphic
to
Y
−
DM
.
Let
l
be
a
prime
number
≥
3.
We
shall
say
that
UX
→
US
is
l-saturated
if
it
is
split,
and
the
corresponding
classifying
morphism
US
→
Mg,r
admits
a
level
l
structure
(cf.
Deﬁnition
5.6).
We
shall
say
that
UX
→
US
is
saturated
if
there
exist
(not
necessarily
distinct)
prime
def
def
numbers
l1
,
l2
≥
3
such
that:
(i)
the
open
subschemes
(US
)1
=
US
[
l11
]
and
(US
)2
=
US
[
l12
]
def
cover
US
;
(ii)
for
i
=
1,
2,
(UX
)i
=
UX
|(US
)i
→
(US
)i
is
li
-saturated.
29
Deﬁnition
7.3.
Let
UX
→
US
be
polyhyperbolic.
We
shall
say
that
it
is
split
(respectively,
l-saturated;
saturated)
if
each
of
the
Ui
→
Ui+1
(for
i
=
0,
.
.
.
,
n)
of
Deﬁnition
4.6
is
split
(respectively,
l-saturated;
saturated).
Corollary
7.4.
(Compactiﬁcation
Theorem)
Let
(S,
MS
)
be
a
regular
log
scheme.
Let
US
⊆
S
be
the
interior
of
S.
Let
UX
→
US
be
polyhyperbolic
and
saturated
(cf.
Deﬁnitions
4.6,
7.3).
Then
UX
→
US
may
be
compactiﬁed
to
a
(log)
polystable
(X,
MX
)
→
(S,
MS
)
(cf.
Deﬁnition
4.5,
7.1).
Moreover,
this
compactiﬁcation
is
natural
in
the
following
sense:
Suppose
that
(S

,
MS

)
is
a
regular
log
scheme,
and
let
(X,
MX
)
→
(S,
MS
),
and
(X

,
MX

)
→
(S

,
MS

)
be
log
polystable
with
associated
hyperbolic
polycurves
UX
→
US
and
UX

→
US

,
respectively.
Suppose,
moreover,
that
we
are
given
a
commutative
diagram:
UX
⏐
⏐

−→
US
⏐
⏐

⊆
S
⏐
⏐

UX

−→
US

⊆
S
Then
the
square
on
the
left
“compactiﬁes”
uniquely
to
a
commutative
diagram:
(X,
MX
)
⏐
⏐

−→
(S,
MS
)
⏐
⏐

(X

,
MX

)
−→
(S

,
MS

)
In
particular,
it
makes
sense
to
speak
of
“the”
compactiﬁcation
of
UX
→
US
.
Proof.
First,
we
prove
the
existence
of
a
polystable
(X,
UX
)
→
(S,
US
).
We
use
induction
on
the
“n”
appearing
in
Deﬁnition
4.6.
Thus,
we
assume
that
U1
→
US
has
been
compactiﬁed
to
some
(X1
,
U1
)
→
(S,
US
).
Moreover,
we
have
a
(split)
saturated
hyperbolic
curve
U0
→
U1
.
This
curve
gives
us
a
classifying
morphism
def
U1
→
M
⊆
M
=
Mg,r
(for
some
g,
r).
Because
of
the
naturality
assertion
in
Theorem
7.4,
it
suﬃces
to
construct
(X
→
S,
D)
locally
over
Spec(Z).
Thus,
the
saturatedness
assumption
implies
that
we
may
assume
that
U1
→
M
admits
a
level
l
structure
(for
some
prime
l
≥
3)
–
cf.
Deﬁnition
5.6.
Since
(X1
,
U1
)
is
toric
(by
Lemma
4.2),
applying
Theorem
6.1
implies
that
this
morphism
extends
to
a
morphism
X1
→
M.
Pulling
back
the
universal
curve
and
divisor
of
marked
points
over
M,
we
thus
obtain
a
compactiﬁcation
(X,
UX
)
→
(S,
US
),
as
desired.
30
Now
we
consider
the
naturality
assertion.
The
point
here
is
that
(X

,
UX

)
→
(S

,
US

)
is
polystable,
while
(X,
UX
)
is
toric.
Moreover,
X
has
an
S

-scheme
structure
such
that
all
the
morphisms
involved
are
S

-morphisms.
Thus,
we
may
apply
Corollary
6.2
to
conclude
that
we
get
a
morphism
from
X
→
S
to
X

→
S

,
as
desired.
This
completes
the
proof
of
Theorem
7.4.
We
conclude
this
paper
with
some
remarks
concerning
Corollary
7.4.
Remark
1.
Concerning
coverings
of
hyperbolic
polycurves:
In
characteristic
0,
it
is
easy
to
see
that
any
connected,
ﬁnite,
étale
cover
of
a
hyperbolic
polycurve
is
again
a
hyperbolic
polycurve.
Thus,
given
an
arbitrary
polyhyperbolic
U
→
T
,
there
exists
a
polyhyperbolic
U

→
T

such
that
U

(respectively,
T

)
is
ﬁnite
étale
over
U
(respectively,
T
)
and
such
that
U

→
T

is
(split
and)
saturated.
In
characteristic
p
or
mixed
characteristic,
however,
ﬁnite
étale
covers
of
hyperbolic
polycurves
need
not
be
hyperbolic
polycurves.
Thus,
when
the
base
is
not
of
characteristic
0,
it
is
often
a
nontrivial
task
to
construct
hyperbolic
polycurves
satisfying
the
hypotheses
of
Theorem
5.4.
Remark
2.
Concerning
the
“Saturatedness”
Hypothesis
in
Corollary
7.4:
This
hypothesis
may
strike
the
reader
as
being
unnecessarily
strong
since
there
certainly
exist
many
compactiﬁable
hyperbolic
polycurves
which
are
not
saturated.
On
the
other
hand,
from
another
point
of
view,
this
hypothesis
is,
in
fact,
rather
natural,
and
not
so
restrictive
at
all:
Indeed,
if
a
hyperbolic
polycurve
UX
→
US
admits
a
compactiﬁcation
(X,
UX
)
→
(S,
US
),
then
the
l-torsion
points
(for
l
invertible
on
S)
of
each
hyperbolic
curve
in
a
sequence
as
in
Deﬁnition
4.6
are
tamely
ramiﬁed
over
the
base
(i.e.,
the
next
higher
numbered
curve
in
a
sequence
as
in
Deﬁnition
4.6).
Thus,
the
compactiﬁcation
(X,
UX
)
→
(S,
US
)
necessarily
ﬁts
into
a
commutative
(in
general,
non-cartesian)
diagram:
(X

,
UX

)
⏐
⏐

−→
(S

,
US

)
⏐
⏐

(X,
UX
)
−→
(S,
US
)
where
the
vertical
arrows
are
ﬁnite,
Galois,
and
log
étale,
and
UX

→
US

is
a
saturated
hyperbolic
polycurve
(i.e.,
is
of
the
sort
that
is
treated
in
the
existence
part
of
Corollary
7.4).
In
fact,
if
the
Galois
groups
of
the
vertical
arrows
are
GX
,
GS
,
respectively,
then
(by
the
functoriality
part
of
Corollary
7.4)
GX
and
GS
act
on
the
above
commutative
diagram.
Thus,
if
we
form
the
quotient
of
the
above
commutative
diagram
by
these
actions
in
the
sense
of
stacks,
we
obtain
a
commutative
diagram
(Y,
UY
)
⏐
⏐

−→
(T,
UT
)
⏐
⏐

(X,
UX
)
−→
31
(S,
US
)
whose
vertical
arrows
are
now
proper,
quasi-ﬁnite,
log
étale,
and
birational
(even
isomorphisms
over
UX
and
US
!).
(Note
that
since,
in
general,
Y
and
T
are
algebraic
stacks,
“proper
+
quasi-ﬁnite
=
ﬁnite.”)
Thus,
in
summary,
although
there
exist
compactiﬁable
hyperbolic
polycurves
not
covered
by
the
existence
part
of
Corollary
7.4,
modulo
the
operation
of
putting
an
appropriate
stack
structure
on
the
compactiﬁcation
X
→
S
at
the
boundaries
X
−
UX
,
S
−
US
,
every
compactiﬁable
hyperbolic
polycurve
is,
in
fact,
covered
by
Corollary
7.4.
Remark
3.
Relationship
to
de
Jong’s
theory
of
alterations:
Corollary
7.4
gives
another
way
to
think
about
de
Jong’s
work
([6])
on
alterations.
For
instance,
suppose
that
R
is
a
Dedekind
domain
whose
quotient
ﬁeld
K
we
assume
(for
simplicity)
to
be
of
characteristic
0.
Let
XK
be
a
variety
over
K
(i.e.,
a
geometrically
irreducible
K-scheme).
It
is
a
wellknown
fact
in
algebraic
geometry
that
any
smooth
point
of
XK
admits
a
neighborhood
UK
⊆
XK
such
that
UK
is
an
“Artin
neighborhood.”
In
our
terminology,
by
taking
UK
to
be
suﬃciently
small,
one
may
assume
that
UK
is
a
hyperbolic
polycurve
over
K.
In
fact,
if
we
do
not
specify
a
point
of
XK
that
we
wish
to
have
belong
to
UK
,
then
it
is
an
easy
exercise
in
elementary
commutative
algebra
to
show
that
such
a
UK
exists.
Then
applying
Corollary
7.4
(cf.
also
Remarks
1
and
2
above),
we
see
immediately
that
there
exists
a
proper
algebraic
stack
(which
one
can
think
of
as
a
“stack-alteration”
of
XK
)
Z
→
Spec(R)
such
that:
(i)
(when
equipped
with
an
appropriate
log
structure)
Z
is
log
regular;
(ii)
UK
def
is
an
open
subscheme
of
ZK
=
Z
⊗R
K.
In
fact,
given
an
arbitrary
proper
model
X
→
Spec(R)
of
XK
over
R,
by
taking
UK
to
be
suﬃciently
small,
one
can
even
assume
that
Z
is
equipped
with
a
proper
R-morphism
Z
→X
(which
is
the
identity
on
UK
).
Indeed,
this
is
precisely
the
sort
of
“resolution
of
indeterminacy”
problem
that
is
already
solved
by
Corollary
7.4:
First
of
all,
we
may
cover
X
by
aﬃnes
{Uα
},
and
assume
that
each
Uα
is
embedded
in
some
aﬃne
space
over
R.
But
aﬃne
space
(which
is
just
a
product
of
A1
’s)
may
be
regarded
as
a
partial
compactiﬁcation
of
a
product
of
P1
−
{0,
1,
∞}’s,
which
are
hyperbolic
curves!
Thus,
by
taking
UK
⊆
XK
to
be
suﬃciently
small
–
i.e.,
so
small
that
it
is
contained
in
all
the
Uα
’s,
and,
moreover,
(relative
to
the
aﬃne
embedding
of
each
Uα
)
maps
into
the
open
subscheme
of
aﬃne
space
given
by
a
product
of
P1
−
{0,
1,
∞}’s
–
we
obtain
that
the
functoriality
portion
of
Corollary
7.4
implies
that
we
get
a
proper
R-morphism
Z
→
X
,
as
desired.
In
fact,
by
arguing
as
above,
Corollary
7.4
can
be
used
to
give
proofs
of
many
of
the
results
of
[6]
(cf.,
e.g.,
[15]
for
more
details).
Thus,
in
summary,
although
Corollary
7.4
appears
to
address
only
certain
speciﬁc
compactiﬁcation/resolution
of
indeterminacy
problems
(i.e.,
those
concerning
hyperbolic
32
polycurves),
in
fact,
because
of
the
ubiquity
of
hyperbolic
polycurves
in
algebraic
geometry
–
e.g.,
in
the
form
of
Artin
neighborhoods;
as
the
open
subscheme
(P1
−
{0,
1,
∞})N
⊆
(A1
)N
=
AN
in
aﬃne
space
–
Corollary
7.4
can
be
applied
to
a
fairly
large
and
diverse
collection
of
compactiﬁcation/resolution
of
indeterminacy
problems
in
algebraic
geometry.
Bibliography
[1]
D.
Abramovich
and
A.
Vistoli,
Complete
Moduli
for
Fibered
Surfaces,
preprint
(December
1997).
[2]
M.
Deschamps,
Réduction
semi-stable
in
L.
Szpiro,
Séminaire
sur
les
pinceaux
de
courbes
de
genre
au
moins
deux,
Astérisque
86
(1981).
[3]
P.
Deligne
and
D.
Mumford,
The
Irreducibility
of
the
Moduli
Space
of
Curves
of
Given
Genus,
IHES
Publ.
Math.
36
(1969),
75-109.
[4]
G.
Faltings
and
C.-L.
Chai,
Degenerations
of
Abelian
Varieties,
Springer
(1990).
[5]
K.
Fujiwara
and
K.
Kato,
Log
Etale
Topology
Theory,
preprint.
[6]
A.
J.
de
Jong,
Smoothness,
Semi-stability,
and
Alterations,
IHES
Publ.
Math
83
(1996),
51-93.
[7]
A.
J.
de
Jong
and
F.
Oort,
On
Extending
Families
of
Curves,
Journal
of
Alg.
Geom.
6
(1997),
545-562.
[8]
K.
Kato,
Logarithmic
Structures
of
Fontaine-Illusie,
Proceedings
of
the
First
JAMI
Conference,
Johns
Hopkins
Univ.
Press
(1990),
191-224.
[9]
K.
Kato,
Toric
Singularities,
Amer.
J.
Math.
116
(1994),
1073-1099.
[10]
F.
F.
Knudsen,
The
Projectivity
of
the
Moduli
Space
of
Stable
Curves,
II,
Math.
Scand.
52
(1983),
161-199.
[11]
R.
Hartshorne,
Algebraic
Geometry,
Graduate
Texts
in
Math.
52
(1997),
Springer.
[12]
R.
Hartshorne,
Residues
and
Duality,
Lect.
Notes
in
Math.
20
(1966),
Springer.
[13]
H.
Matsumura,
Commutative
Algebra
(Second
Edition),
The
Benjamin/Cummings
Publishing
Company
(1980).
[14]
S.
Mochizuki,
The
Geometry
of
the
Compactiﬁcation
of
the
Hurwitz
Scheme,
Publ.
RIMS,
Kyoto
Univ.
31,
No.
3
(1995),
355-441.
[15]
S.
Mochizuki,
Extending
Families
of
Curves
I:
Compactiﬁcation
of
Hyperbolic
Polycurves,
RIMS
Preprint
1188
(March
1998).
[16]
D.
Mumford,
Stability
of
Projective
Varieties,
Enseignement
Math.
(2)
23,
No.
1-2
(1977),
39-110.
[17]
T.
Oda,
Convex
Bodies
and
Algebraic
Geometry:
An
Introduction
to
the
Theory
of
Toric
Varieties,
Springer
(1988).
33
[18]
A.
Grothendieck
et
al.,
Cohomologie
locale
des
faisceaux
cohérents
et
théorèmes
de
Lefshetz
locaux
et
globaux,
North-Holland,
Amsterdam
(1968).
Shinichi
Mochizuki
Research
Institute
for
Mathematical
Sciences
Kyoto
University
Kyoto
606-01,
JAPAN
motizuki@kurims.kyoto-u.ac.jp
34
