The
Scheme-Theoretic
Theta
Convolution
by
Shinichi
Mochizuki
September
1999
Contents:
§0.
Introduction
§1.
The
Scheme-Theoretic
Fourier
Transform
§2.
Discrete
Gaussians
and
Gauss
Sums
§3.
Review
of
Degree
Computations
in
[HAT]
§4.
The
Fourier
Transform
of
an
Algebraic
Theta
Function:
The
Case
of
an
Étale
Lagrangian
Subgroup
§5.
The
Fourier
Transform
of
an
Algebraic
Theta
Function:
The
Case
of
a
Lagrangian
Subgroup
with
Nontrivial
Multiplicative
Part
§6.
Generic
Properties
of
the
Norm
§7.
Some
Elementary
Computational
Lemmas
§8.
The
Various
Contributions
at
Inﬁnity
§9.
The
Main
Theorem
§10.
The
Theta
Convolution
§0.
Introduction
In
this
paper,
we
continue
our
development
of
the
theory
of
the
Hodge-Arakelov
Comparison
Isomorphism
of
[HAT].
Our
main
result
concerns
the
invertibility
of
the
coeﬃcients
of
the
Fourier
transform
of
an
algebraic
theta
function.
Using
this
result,
we
obtain
a
modiﬁed
version
of
the
Hodge-Arakelov
Comparison
Isomorphism
of
[HAT],
which
we
refer
to
as
the
Theta-Convoluted
Comparison
Isomorphism.
The
signiﬁcance
of
this
modiﬁed
version
is
that
the
principle
obstruction
to
the
application
of
the
theory
of
[HAT]
to
diophantine
geometry
—
namely,
the
Gaussian
poles
—
partially
vanishes
in
the
theta-convoluted
context.
Thus,
the
results
of
this
paper
bring
the
theory
of
[HAT]
one
step
closer
to
possible
application
to
diophantine
geometry.
Perhaps
the
simplest
way
to
explain
the
main
idea
of
the
present
paper
is
the
following:
The
theory
of
[HAT]
may
be
thought
of
as
a
sort
of
discrete,
scheme-theoretic
version
of
1
the
theory
of
the
classical
Gaussian
e−x
(on
the
real
line)
and
its
derivatives
(cf.
[HAT],
Introduction,
§2).
The
reason
for
the
appearance
of
the
“Gaussian
poles”
—
which,
as
remarked
above,
constitute
the
principle
obstruction
to
the
application
of
the
theory
of
[HAT]
to
diophantine
geometry
—
is
that,
if,
for
instance,
P
(−)
is
a
polynomial
with
constant
coeﬃcients,
then,
at
its
most
fundamental
combinatorial
level,
the
“comparison
isomorphism”
of
[HAT]
may
be
thought
of
as
the
mapping
2
P
(−)
→
P
(
2
2
∂
)
e−x
=
P
(−2x)
·
e−x
∂x
from
a
certain
space
of
polynomials
—
which
constitutes
the
de
Rham
side
of
the
comparison
isomorphism
—
to
a
certain
space
of
set-theoretic
functions
—
which
constitutes
the
étale
side
of
the
comparison
isomorphism.
Roughly
speaking,
in
order
to
make
this
2
morphism
into
an
isomorphism,
it
is
necessary
to
eliminate
the
extra
factor
of
e−x
on
the
right.
Once
this
extra
factor
is
eliminated,
the
mapping
P
(−)
→
P
(−2x)
is
“manifestly”
an
isomorphism.
The
approach
of
[HAT]
to
making
this
mapping
into
an
isomorphism
is
to
introduce
poles
into
the
de
Rham
side
of
the
morphism
(i.e.,
the
“Gaussian
poles”),
which
amounts
(relative
to
the
above
discussion)
to
artiﬁcially
tensoring
the
left-hand
side
of
the
morphism
2
2
with
the
“symbol”
ex
,
which
then
is
to
map
to
the
“function”
ex
.
Once
this
operation
2
2
is
performed,
the
right-hand
side
becomes
P
(−2x)e−x
·
ex
=
P
(−2x),
so
we
get
an
isomorphism
P
(−)
→
P
(−2x)
as
desired.
The
problem
with
this
approach
of
[HAT]
is
that
for
diophantine
applications,
one
wishes
to
leave
the
de
Rham
side
of
the
comparison
isomorphism
untouched.
On
the
other
hand,
although
one
wishes
to
modify
the
étale
side,
one
wants
to
modify
it
in
such
a
way
that
the
resulting
modiﬁed
étale
side
still
admits
a
natural
Galois
action,
which
is
necessary
in
order
to
construct
the
arithmetic
Kodaira-Spencer
morphism
(cf.
[HAT],
Chapter
IX,
§3,
as
well
as
Remark
2
following
Theorem
10.1
in
the
present
paper).
In
the
present
paper,
the
approach
that
we
take
may
be
explained
in
terms
of
the
above
discussion
as
follows:
Instead
of
modifying
the
de
Rham
side
of
the
comparison
morphism,
we
modify
the
étale
side
by
“tensoring
it
with
the
inverse
of
the
line
bundle
deﬁned
by
the
image
on
the
étale
side
of
the
element
‘1’
(on
the
de
Rham
side).”
Of
course
2
2
this
image
is
simply
e−x
,
so
dividing
by
this
image
amounts
to
multiplying
by
ex
on
the
étale
side,
thus
giving
us
the
desired
isomorphism
P
(−)
→
P
(−2x).
Of
course,
in
the
theory
of
[HAT]
and
the
present
paper,
we
are
not
working
literally
with
the
Gaussian
or
even
classical
theta
functions,
but
rather
their
discrete
algebraic
analogues.
Thus,
it
is
not
surprising
that
many
of
the
technical
computations
of
this
paper
involve
certain
discrete
analogues
of
the
classical
Gaussian
on
the
real
line
(cf.
§2).
Since
the
correspondence
between
theta
functions
and
Gaussian
is,
in
essence,
that
the
Gaussian
represents
the
Fourier
transform
of
a
theta
function,
multiplying
by
a
Gaussian
corresponds,
at
the
level
of
theta
functions,
to
the
operation
of
convolution.
Thus,
the
operation
which
we
wish
to
perform
(cf.
the
preceding
paragraph)
on
the
étale
side
of
the
comparison
isomorphism
is
to
apply
the
inverse
of
convolution
with
the
theta
function.
In
2
the
present
paper,
we
refer
to
the
operation
of
convolution
with
the
theta
function
as
the
“theta
convolution.”
Thus,
the
key
technical
result
that
is
necessary
in
order
to
realize
the
philosophical
idea
explained
above
is
a
result
concerning
the
invertibility
of
the
theta
convolution.
Put
another
way,
since
our
theta
functions
(in
the
theory
of
[HAT]
and
the
present
paper)
are
the
algebraic
theta
functions
of
Mumford
(cf.
[Mumf1,2,3]),
we
thus
see
that
the
result
that
we
need
is
a
result
concerning
the
invertibility
of
the
coeﬃcients
of
the
Fourier
transform
of
certain
algebraic
theta
functions.
This
result
is
the
ﬁrst
main
result
of
this
paper
(Theorem
9.1).
We
refer
to
§9
for
explicit
technical
details
concerning
its
statement.
In
a
word,
this
result
states
that
the
coeﬃcients
of
the
Fourier
transform
of
certain
algebraic
theta
functions
are
invertible
in
characteristic
0
away
from
the
divisor
at
inﬁnity
(i.e.,
the
locus
where
the
elliptic
curve
in
question
degenerates).
Moreover,
in
mixed
characteristic
and
near
the
divisor
at
inﬁnity,
we
analyze
explicitly
the
extent
to
which
these
coeﬃcients
fail
to
be
invertible.
In
fact,
the
proof
of
this
result
proceeds
precisely
by
comparing
the
degree
of
the
line
bundle
(on
the
moduli
stack
of
elliptic
curves)
of
which
the
norm
of
the
Fourier
transform
(i.e.,
the
product
of
its
coeﬃcients)
is
a
section
to
the
degree
of
the
zero
locus
of
this
norm
in
a
neighborhood
of
the
divisor
at
inﬁnity.
A
rather
complicated
calculation
reveals
that
these
two
degrees
coincide.
This
coincidence
of
degrees
implies
that
the
norm
is
therefore
invertible
(in
characteristic
0)
away
from
the
divisor
at
inﬁnity.
Finally,
we
apply
our
ﬁrst
main
result
to
prove
our
second
main
result,
i.e.,
the
theta-convoluted
comparison
isomorphism
(Theorem
10.1).
Before
proceeding,
we
would
like
to
explain
several
ways
to
think
about
the
contents
of
this
paper.
First
of
all,
the
fact
that
the
coeﬃcients
of
the
Fourier
transform
of
certain
algebraic
theta
functions
are
invertible
away
from
the
divisor
at
inﬁnity
appears
(to
the
knowledge
of
the
author)
to
be
new
(i.e.,
it
does
not
seem
to
appear
in
the
classical
theory
of
theta
functions).
Thus,
one
way
to
interpret
Theorem
9.1
is
as
a
result
which
implies
the
existence
of
certain
interesting,
new
modular
units.
It
would
be
interesting
to
see
if
this
point
of
view
can
be
pursued
further
(cf.
the
Remark
following
Theorem
9.1).
Another
way
to
think
about
the
contents
of
this
paper
is
the
following.
The
classical
representation
of
the
Fourier
expansion
of
a
theta
function
—
i.e.,
the
representation
which
states
that
the
Fourier
coeﬃcients
are
essentially
a
“Gaussian”
—
arises
from
the
Fourier
expansion
of
the
restriction
of
a
theta
function
to
a
certain
particular
cycle
(or
copy
of
the
circle
S1
)
on
the
elliptic
curve
E
in
question.
More
explicitly,
if
one
thinks
of
this
elliptic
curve
E
as
being
E
=
C×
/q
Z
then
this
special
cycle
is
the
image
of
the
natural
copy
of
S1
⊆
C×
.
In
the
present
context,
we
are
considering
discrete
analogues
of
this
classical
complex
theory,
so
instead
of
working
with
this
S1
,
we
work
with
its
d-torsion
points
(for
some
ﬁxed
positive
integer
d),
i.e.,
μd
⊆
S1
⊆
C×
.
On
the
other
hand,
in
order
to
obtain
a
theory
valid
over
the
entire
moduli
stack
of
elliptic
curves,
we
must
consider
Fourier
expansions
of
theta
functions
restricted
not
just
3
to
this
special
cyclic
subgroup
of
order
d,
i.e.,
μd
⊆
E,
(with
respect
to
which
the
Fourier
expansion
is
particularly
simply
and
easy
to
understand),
but
rather
with
respect
to
an
arbitrary
cyclic
subgroup
of
order
d.
Viewed
from
the
classical
complex
theory,
considering
Fourier
expansions
arising
from
more
general
restriction
subgroups
amounts
to
considering
the
functional
equation
of
the
theta
function.
In
the
classical
complex
theory,
Gauss
sums
arise
naturally
in
the
functional
equation
of
the
theta
function.
Thus,
it
is
not
surprising
that
Gauss
sums
(and,
in
particular,
their
invertibility)
also
play
an
important
role
in
the
theory
of
the
present
paper.
In
fact,
returning
to
the
theory
of
the
Gaussian
on
the
real
line,
one
may
recall
that
one
“important
number”
that
arises
in
this
theory
√
is
the
integral
of
the
Gaussian
(over
the
real
line).
This
integral
is
(roughly
speaking)
π.
On
the
other
hand,
in
the
theory
of
this
paper,
Gaussians
correspond
to
“discrete
Gaussians”
(cf.
§2),
so
integrals
of
Gaussians
correspond
to
“Gauss
√
sums.”
That
is
to
say,
Gauss
sums
may
be
thought
of
as
a
sort
of
discrete
analogue
of
π.
Thus,
the
appearance
of
Gauss
sums
in
the
theory
of
this
paper
is
also
natural
from
the
point
of
view
of
the
above
discussion
of
the
“main
idea”
involving
Gaussians.
√
Indeed,
this
discussion
of
discrete
analogues
of
Gaussians
and
π
leads
one
to
suspect
that
there
is
also
a
natural
p-adic
analogue
of
the
theory
of
this
paper
involving
the
p-adic
ring
of
periods
Bcrys
.
Since
this
ring
of
periods
contains
a
certain
copy
of
Zp
(1)
which
may
be
thought
of
as
a
“p-adic
analogue
of
π,”
it
is
thus
natural
to
suspect
that
in
a
p-adic
analogue
of
the
theory
of
this
paper
some
“square
root
of
this
copy
of
Zp
(1)”
—
and,
in
particular,
its
invertibility
—
should
play
an
analogously
important
role
to
the
role
played
by
the
invertibility
of
Gauss
sums
in
the
present
paper.
We
hope
to
develop
such
a
p-adic
theory
in
a
future
paper
(cf.
also
[HAT],
Introduction,
§5.1).
Finally,
we
explain
the
contents
of
the
various
§’s
of
this
paper.
In
§1,
we
deﬁne
and
discuss
the
elementary
properties
of
the
Fourier
transform
of
a
ﬁnite
ﬂat
group
scheme.
In
§2,
we
discuss
the
“discrete
Gaussians”
and
their
“integrals”
(Gauss
sums)
that
arise
in
the
computations
of
this
paper.
In
§3,
we
formalize
the
necessary
technical
details
concerning
the
Fourier
transform
of
an
algebraic
theta
function.
This
formalization
results
in
the
appearance
of
various
degrees
of
line
bundles
and
divisors
on
the
moduli
stack
of
elliptic
curves
which
were
computed
in
[HAT];
in
§3,
we
review
these
computations.
In
§4,
5,
we
estimate
the
degree
of
vanishing
of
the
norm
of
the
Fourier
transform
of
an
algebraic
theta
function
in
a
neighborhood
of
inﬁnity.
It
turns
out
that
these
computations
diﬀer
somewhat
depending
on
the
“position”
of
certain
auxiliary
torsion
subgroups
of
the
elliptic
curve
that
are
necessary
in
order
to
deﬁne
our
Fourier
transform.
Roughly
speaking,
the
necesssary
computations
may
be
separated
into
two
cases
or
parts,
depending
on
the
position
of
these
auxiliary
torsion
subgroups.
The
two
cases
constitute,
respectively,
the
content
of
§4,
5.
In
§6,
we
investigate
when
the
norm
of
the
Fourier
transform
is
generically
zero.
In
§7,
we
perform
certain
complicated
but
elementary
computations
that
we
use
in
§8.
These
computations
are
at
the
level
of
high-school
mathematics
and,
in
particular,
have
nothing
to
do
with
arithmetic
geometry.
In
§8,
we
combine
the
estimates
of
§4,
5,
with
the
computations
of
§7
to
show
the
important
“coincidence
of
degrees”
discussed
above.
In
§9,
we
record
the
consequences
of
this
coincidence
of
degrees,
i.e.,
our
ﬁrst
main
4
result
(Theorem
9.1).
In
§10,
we
apply
Theorem
9.1
to
construct
the
theta-convoluted
comparison
isomorphism
(whose
realization
was,
as
explained
above,
the
main
motivation
for
the
theory
of
this
paper).
§1.
The
Scheme-Theoretic
Fourier
Transform
In
this
§,
we
extend
the
well-known
theory
of
Fourier
analysis
on
ﬁnite
abelian
groups
to
its
“schematic
analogue,”
Fourier
analysis
on
ﬁnite,
ﬂat
commutative
group
schemes.
Let
S
be
a
scheme.
Let
G→S

→
S
for
the
Cartier
dual
of
G
be
a
ﬁnite,
ﬂat
commutative
group
scheme
over
S.
Write
G

are
the
homomorphisms
([Shz],
§4).
Thus,
if
T
is
an
S-scheme,
the
T
-valued
points
of
G
def
GT
(
=
G
×S
T
)
→
(Gm
)T
.
Let
f
∈
Γ(G,
OG
)
be
a
function
on
G.
Then
we
deﬁne
its
Fourier
transform
f
∈

)
(where
T
is
an
S
O
)
as
follows:
The
value
of
f
on
a
T
-valued
point
γ
∈
G(T
Γ(G,

G
scheme)
is
given
by:
def
f(
γ)
=

f
·
(
γ
)−1
GT
/T

Here,
we
think
of

γ
as
an
(invertible)
function
on
GT
,
and
denote
by
“
GT
/T
”
the
trace
morphism
OGT
→
OT
(which
is
well-deﬁned
since
G
→
S
is
ﬁnite
and
ﬂat).
Since
this

O
).
This
deﬁnition
is
functorial
in
T
,
we
thus
obtain
a
well-deﬁned
element
f
∈
Γ(G,

G
completes
the
deﬁnition
of
the
Fourier
transform
of
f.
In
the
following,
we
shall
also
write
FG
(f)
(or
F
(f),
when
the
choice
of
G
is
clear)
for
f.
Next,
let
f,
g
∈
Γ(G,
OG
)
be
two
functions
on
G.
Then
in
addition
to
the
usual
product
f
·
g
∈
Γ(G,
OG
),
we
also
have
the
convolution
(product)
f
∗
g
∈
Γ(G,
OG
)
of
f,
g,
deﬁned
by:
def
(f
∗
g)(γ)
=

f(γ
·
(γ

)−1
)
·
g(γ

)
γ

∈G
5
(for
T
-valued
points
γ
∈
G(T
)).
Finally,
let
us
write
I(f)
for
the
function
obtained
by
pulling
f
back
via
the
inversion
morphism
[−1]
:
G
→
G
on
G.
Proposition
1.1.
Suppose
that
G
→
S
is
of
constant
rank
|G|,
and
that
the
integer
|G|
is
a
nonzero
divisor
on
S.
Then
we
have:
(i.)
|G|
·
I(f)
=
FG
(FG
(f)).
(ii.)
|G|
·
FG
(f
·
g)
=
FG
(f)
∗
FG
(g).
(iii.)
FG
(f
∗
g)
=
FG
(f)
·
FG
(g).
for
any
f
∈
Γ(G,
OG
).
Proof.
Since
|G|
is
a
nonzero
divisor
on
S,
we
may
assume
without
loss
of
generality
that
|G|
is
invertible
on
S,
and
hence
that
G
→
S
is
étale
([Shz],
§4,
Corollary
3).
Then
by
replacing
S
by
a
ﬁnite
étale
cover
of
S,
we
may
assume
that
G
→
S
is
of
the
form
Γ
×
S,
where
Γ
is
a
ﬁnite
abelian
group
(in
the
category
of
sets).
In
this
case,
the
stated
identities
are
well-known
(cf.,
e.g.,
[DyMc],
§4.5).

Now
let
us
suppose
that
we
have
an
exact
sequence
0→H
→G→K
→0
of
ﬁnite,
ﬂat
commutative
group
schemes
over
S.
Taking
Cartier
duals,
we
obtain
an
exact
sequence

→G
→H

→0
0→K
If
f
∈
Γ(K,
OK
)
is
a
function
on
K,
then
by
pull-back,
we
obtain
a
function
f|G
∈
Γ(G,
OG
),
which
we
also
denote
by
ResG
K
(f).
Now
suppose
that
K
→
S
is
of
constant
rank
|K|,
and
that
the
integer
|K|
is
a
nonzero
def
divisor
on
S.
Then
it
follows
that
over
SK
=
S[|K|−1
],
K|SK
→
SK
is
étale,
hence
that
H|SK
is
open
and
closed
in
GSK
.
Now
suppose
that
f
∈
Γ(H,
OH
)
is
a
function
on
H,
and
that
f
∈
Γ(G,
OG
)
is
a
function
on
G
such
that
f|H
=
f,
and,
moreover,
that
f|SK
vanishes
on
the
open
and
closed
subscheme
GSK
\HSK
⊆
GSK
.
Then
we
shall
write
IndG
H
(f)

Thus,
IndG
(f)
is
the
result
of
“extending
f
by
zero”
to
a
function
on
G.
Note
that
for
f.
H
such
an
f
is
necessarily
unique
(since
SK
is
schematically
dense
in
S,
and
f
is
uniquely
determined
on
HSK
and
GSK
\HSK
).
6
Proposition
1.2.
Suppose
that
G
→
S
is
of
constant
rank
|G|,
and
that
the
integer
|G|
is
a
nonzero
divisor
on
S.
Then:

(F
(f)).
G
(i.)
For
any
f
∈
Γ(K,
OK
),
we
have:
FG
(ResG
K
(f))
=
|H|
·
IndK

K
G
(ii.)
For
any
f
∈
Γ(H,
OH
)
such
that
IndG
H
(f)
exists,
we
have:
FG
(IndH
(f))
=

(F
(f)).
ResG

H
H
(iii.)
In
particular,
if
1G
is
the
constant
function
1
on
G,
and
δ0,G
is
the
“delta
distribution
at
the
origin”
(i.e.,
the
function
–
deﬁned
after
one
inverts
|G|
–
which
is
1
at
the
origin
and
0
elsewhere),
then
FG
(1G
)
=
|G|
·
δ0,G
.
,
and
FG
(δ0,G
)
=
1G
Proof.
Just
as
in
the
proof
of
Proposition
1.1,
it
suﬃces
to
verify
the
result
under
the
assumption
that
G
is
of
the
form
Γ×
S,
where
Γ
is
a
ﬁnite
abelian
group
of
order
invertible
on
S.
But
in
this
case,
the
result
is
well-known
(cf.,
e.g.,
[DyMc],
§4.5).

§2.
Discrete
Gaussians
and
Gauss
Sums
One
of
the
key
fundamental
results
in
classical
Fourier
analysis
on
the
real
line
√
is
that
the
Fourier
transform
of
a
Gaussian
is
(up
to
a
factor
which
typically
involves
π)
a
Gaussian.
In
this
§,
we
examine
the
discrete
analogue
of
this
phenomenon.
Here,
the
discrete
analogue
of
a
classical
Gaussian
is
a
“discrete
Gaussian,”
while
the
discrete
analogue
of
the
factor
that
appears
when
one
applies
the
Fourier
transform
is
a
Gauss
sum.
We
maintain
the
notations
of
§1.
Here,
we
assume
further
that
the
group
scheme
G
is
(noncanonically)
isomorphic
to
Z/N
Z,
for
some
positive
integer
N
which
is
invertible
on
S.
In
the
following,
we
assume
that
some
particular
isomorphism
G∼
=
(Z/NZ)
×
S
has
been
chosen.
Note
that
the
choice
of
such
an
isomorphism
endows
G
with
a
structure
of
“ring
scheme”
(i.e.,
arising
from
the
ring
structure
of
Z/N
Z).
In
particular,
if
γ
∈
G(S),
then
we
shall
write
(for
i
∈
Z≥1
)
i·γ
(respectively,
γ
i
)
for
the
result
of
adding
(respectively,
multiplying)
—
i.e.,
relative
to
this
ring
scheme
structure
—
γ
to
(respectively,
by)
itself
a
total
of
i
times.
Often,
by
abuse
of
notation,
we
shall
simply
write
γ
∈
G
for
the
N
elements
of
G(S)
deﬁned
by
Z/N
Z.
Let
χ
:
G
→
Gm
be
a
faithful
character
of
the
group
scheme
G.
Then
consider
the
function
7
ψ
:
G
→
Gm
def
deﬁned
by
ψ(γ)
=
χ(γ
2
).
Deﬁnition
2.1.
Such
a
function
ψ
on
G
(deﬁned
for
some
χ
as
above)
will
be
referred
to
as
a
discrete
Gaussian
(on
G).
In
the
following,
we
would
like
to
consider
the
Fourier
transform
of
a
discrete
Gaussian
and
show
that
this
Fourier
transform
is
essentially
another
discrete
Gaussian
(times
a
certain
Gauss
sum).
Let
us
ﬁrst
observe
that
since
χ
is
faithful,
the
characters
of
G
are
all
of
the
form
γ
→
χ(c
·
γ),
for
some
c
∈
Z/N
Z.
Let
us
then
compute
the
Fourier
coeﬃcient
of
ψ
for
the
character
χc
corresponding
to
an
even
c
=
2c
(where
c
∈
Z/N
Z):


χ(γ
2
−
2c
·
γ)
γ∈G


2
χ((γ
−
c
)2
)
=
χ(−(c
)
)
·
γ∈G

=
χ(−(c
)2
)
·
χ(γ
2
)
ψ(γ)
·
χ(−c
·
γ)
=
γ∈G
γ∈G
Write
def

G(χ,
N)
=
χ(γ
2
)
γ∈G
for
the
Gauss
sum
deﬁned
by
χ.
Then
the
above
calculation
shows
in
particular
that
for
N
odd
(in
which
case
all
c
may
be
written
as
c
=
2c
),
the
Fourier
transform
F
(ψ)
is
the
function
χc
→
G(χ,
N)·
χ(−
14
·
c2
).
This
function
is
clearly
a
constant
(=
G(χ,
N))
multiple
of
a
discrete
Gaussian.
Next,
we
consider
the
more
complicated
case
when
N
is
even.
When
N
is
even,
we
shall
write
N
=
2M.
First,
let
us
suppose
that
N
is
divisible
by
4.
In
this
case,
every
γ
∈
Z/N
Z
satisﬁes:
(γ
+
M)2
≡
γ
2
+
2M
·
γ
+
M
2
≡
γ
2
(modulo
N
).
Thus,
it
follows
that
the
function
ψ
on
G
∼
=
Z/N
Z
is
obtained
by
pulling
back
a
function
on
G/M
·
G
∼
Z/MZ
via
the
natural
projection
G
→
G/M
·
G.
In
particular,
it
=
follows
from
Proposition
1.2,
(i.),
that
the
Fourier
coeﬃcients
of
ψ
are
zero
for
odd
c
(i.e.,
c
which
cannot
be
written
in
the
form
c
=
2c
).
Thus,
we
see
that
the
above
calculation
8
implies
that
the
Fourier
transform
F
(ψ)
in
this
case
is
the
result
of
extending
by
zero
a

⊆G

whose
pull-back
to
constant
(=
G(χ,
N))
multiple
of
a
function
on
Z/MZ
∼
=
2·G
Z/N
Z
is
a
discrete
Gaussian
on
Z/N
Z.
Deﬁnition
2.2.
If
N
is
divisible
by
4,
and
ψ
is
a
function
on
G/MG
whose
pull-back
to
G
is
a
discrete
Gaussian
ψ
on
G,
then
we
shall
refer
to
ψ
as
a
reduced
discrete
Gaussian
on
G/MG.
If
N
is
odd,
then
we
will
also
refer
to
arbitrary
discrete
Gaussians
(as
in
Deﬁnition
2.1)
as
reduced
discrete
Gaussians.
Finally,
we
consider
the
case
of
odd
M.
In
this
case,
every
γ
∈
Z/N
Z
satisﬁes:
(γ
+
M)2
≡
γ
2
+
2M
·
γ
+
M
2
≡
γ
2
+
M
(modulo
N
).
In
particular,
it
follows
from
Proposition
1.2,
(i.),
that
the
Fourier
coeﬃcients
of
ψ
are
zero
for
even
c
(i.e.,
c
which
can
be
written
in
the
form
c
=
2c
).
Thus,
we
must
compute
the
coeﬃcients
for
odd
c
=
2c
+
M
(where
we
note
that
since
M
is
odd,
we
may
take
c
to
be
even):


χ(γ
2
−
2c
·
γ
−
M
·
γ)
γ∈G


2
χ((γ
−
c
)2
+
M
·
γ)
=
χ(−(c
)
)
·
γ∈G

χ(γ
2
+
M
·
γ)
=
χ(−(c
)2
)
·
ψ(γ)
·
χ(−c
·
γ)
=
γ∈G
γ∈G
Moreover,



χ(γ
+
M
·
γ)
=
χ(γ
)
−
2
γ∈G
2
γ∈2·G
χ((γ
+
M)2
)


γ∈2·G
χ(γ
2
)
−
=
γ∈2·G
γ∈2·G

=2·
χ(γ
2
+
2M
·
γ
+
M
2
)
χ(γ
2
)
γ∈2·G
2
=
2
·
G(χ
,
M)
(where
we
note
that
since
χ
is
faithful,
we
have
χ(M
2
)
=
χ(M)
=
−1).
Next,
let
us
recall
from
the
computations
of
Gauss
sums
in
[Lang],
pp.
86-87,
that
we
have
G(χ2
,
M)
=
χ2
,M
·
9
√
M
=0
where
4χ2
,M
=
1.
Similarly,
if
N
is
odd,
then
we
have
G(χ,
N)
=
χ,N
·
√
N
=0
where
4χ,N
=
1.
Finally,
if
N
is
even,
then
we
have
G(χ,
N)
=
χ,N
·
(1
+
i)
·
where
4χ,N
=
1,
i
=
√
√
N
=0
−1.
Thus,
we
see
that
we
have
proven
the
following
result:
def
Proposition
2.3.
Let
χ
:
G
→
Gm
be
a
faithful
character.
Let
ψ(γ)
=
χ(γ
2
)
be
the
discrete
Gaussian
on
G
associated
to
χ.
For
c
∈
Z/N
Z,
write
χc
for
the
character
def
G
→
Gm
deﬁned
by
χc
(γ)
=
χ(c
·
γ).
Then:
(i.)
Suppose
that
N
is
odd.
Then
1
{F
(ψ)}(χc
)
=
G(χ,
N)
·
χ(−
·
c2)
4
√
N
=
0
(and
4χ,N
=
1).
Thus,
F
(ψ)
is
equal
to

a
nonzero
multiple
of
a
discrete
Gaussian
on
G.
def

where
G(χ,
N)
=
γ∈G
χ(γ
2
)
=
χ,N
·
(ii.)
Suppose
that
N
=
2M
is
even,
but
M
is
odd.
Then
{F
(ψ)}(χc
)
=
0
if
c
∈
2Z/N
Z.
If
c
=
2c
+
M
for
c
∈
2Z/N
Z,
then
{F
(ψ)}(χc
)
=
2
·
G(χ2
,
M)
·
χ(−(c
)2
)
√
M
=
0
(and
4χ2
,M
=
1).
Thus,
F
(ψ)
is

of
the
extension
by
zero
of
equal
to
a
nonzero
multiple
of
the
translate
by
M
∈
Z/N
Z
∼
=G

(⊆
G).

a
discrete
Gaussian
on
2
·
G
def

where
G(χ2
,
M)
=
2
γ∈2Z/N
Z
χ(γ
)
=
χ2
,M
·
(iii.)
Suppose
that
N
=
2M
and
M
are
even.
Then
{F
(ψ)}(χc
)
=
0
if
c
∈
(2Z
+
M)/NZ.
If
c
=
2c
for
c
∈
Z/N
Z,
then
{F
(ψ)}(χc
)
=
G(χ,
N)
·
χ(−(c
)2
)
√
√
2
4
χ(γ
)
=

·
(1
+
i)
N
=
0
(and

=
1,
i
=
−1).
Thus,
χ,N
χ,N
γ∈G
∼
F
(ψ)
is
equal
to
a
nonzero
multiple
of
the
extension
by
zero
of
a
function
on
2
·
G
=
Z/MZ
whose
pull-back
to
Z/N
Z
is
a
discrete
Gaussian
on
Z/N
Z.
def

where
G(χ,
N)
=
Thus,
in
summary,
“the
Fourier
transform
of
a
reduced
discrete
Gaussian
is
itself
a
nonzero
multiple
(i.e.,
by
a
certain
Gauss
sum)
of
a
reduced
discrete
Gaussian.”
10
Remark.
Frequently,
we
will
work
with
ﬁnite,
ﬂat
group
schemes
G
of
order
N
over
bases
where
N
is
not
necessarily
invertible,
or
with
ﬁnite,
étale
group
schemes
which
are
étale
locally,
but
not
necessarily
globally,
isomorphic
to
Z/N
Z.
In
these
cases,
we
shall
also
refer
to
functions
on
G
as
(reduced)
discrete
Gaussians
if
they
become
(reduced)
discrete
Gaussians
as
in
Deﬁnition
2.2
after
N
is
inverted,
and
a
suitable
isomorphism
with
Z/N
Z
is
chosen
over
some
étale
covering
of
the
original
base.
§3.
Review
of
Degree
Computations
in
[HAT]
The
purpose
of
this
§
is
to
review
various
aspects
of
the
theory
of
[HAT]
in
characteristic
0,
and
to
explain
the
fundamental
set-up
of
the
theory
of
the
present
paper.
Let
S
log
be
a
Z-ﬂat
ﬁne
noetherian
log
scheme.
Let
us
assume
that
we
are
given
a
log
elliptic
curve
(cf.
[HAT],
Chapter
III,
§1.1)
C
log
→
S
log
over
S
log
which
is
smooth
over
a
schematically
dense
open
subscheme
of
S.
It
thus
follows
that
the
“divisor
at
inﬁnity”
(i.e.,
the
pull-back
via
the
associated
classifying
morphism
of
the
divisor
at
inﬁnity
of
(M1,0
)Z
)
is
a
Cartier
divisor
D
⊆
S.
Thus,
just
as
in
[HAT],
Chapter
IV,
§4,5,
we
have
a
stack
S∞
obtained
from
S
by
adjoining
the
roots
of
the
qparameters
at
the
locus
D
⊆
S
over
which
C
log
→
S
log
degenerates.
Over
S∞,
we
have
the
smooth
group
scheme
f
:
E∞,S
→
S∞
whose
connected
components
at
the
points
of
bad
reduction
are
in
natural
one-to-one
correspondence
with
Q/Z.
The
metrized
line
bundles
of
[Zh]
may
be
thought
of
as
living
on
E∞,S
.
Let
m,
d
be
positive
integers
such
that
m
does
not
divide
d.
Let
η
∈
E∞,S
(S∞
)
be
a
torsion
point
of
order
m.
Then
in
[HAT],
Chapter
V,
§1,
we
associated
to
this
data
certain
metrized
line
bundles
Lst,η
,
In
the
following
discussion,
we
will
denote
by
11
ev
Lst,η
L
ev
the
metrized
line
bundle
Lst,η
(respectively,
Lst,η
)
if
d
is
odd
(respectively,
even).
Note
that
the
push-forward
f∗
L
of
this
metrized
line
bundle
to
S∞
deﬁnes
a
metrized
vector
bundle
on
S∞
.
Moreover,
this
metrized
line
bundle
admits
the
action
of
a
certain
natural
theta
group
scheme
GL
(cf.
[HAT],
Chapter
IV,
§5).
Next,
let
us
assume
that
we
are
given
ﬁnite,
ﬂat
(i.e.,
over
S∞)
subgroup
schemes
G,
H
⊆
E∞,S
which
are
étale
locally
isomorphic
to
Z/dZ
in
characteristic
0
(i.e.,
after
tensoring
with
Q),
and
which
satisfy
H
×
G
=
d
E∞,S
⊆
E∞,S
(where
d
E∞,S
is
the
kernel
of
multiplication
by
d
on
E∞,S
).
We
shall
refer
to
G
as
the
restriction
subgroup
(since
its
principal
use
will
be
as
a
collection
of
points
to
which
we
will
restrict
sections
of
L),
and
H
as
the
Lagrangian
subgroup
(since
its
primary
use
will
be
to
descend
L
—
cf.
[HAT],
Chapter
IV,
Theorem
1.4).
In
the
following
discussion,
we
would
like
to
consider
the
Fourier
transforms
of
restrictions
of
sections
of
L
to
G.
If
d
is
odd,
then
the
datum
of
G
is
suﬃcient
for
this
purpose.
If,
however,
d
is
even,
then
in
order
to
take
the
Fourier
transform
of
a
restricted
section,
we
need
a
canonical
trivialization
of
the
restriction
L|G
.
Recall,
however,
from
[HAT],
Chapter
IV,
Theorem
1.6,
that
we
only
have
such
a
canonical
trivialization
over
2
·
G,
not
over
all
of
G.
Thus,
in
the
case
that
d
is
even,
we
must
assume
that
we
are
also
given
the
def
∞,S
def
=
E∞,S
/(d0
·
G),
where
d0
=
12
d.
Thus,
following
data:
First
of
all,
let
us
write
E
∞,S
factors
into
a
composite
of
two
morphisms
of
the
multiplication
by
2
morphism
on
E
degree
2:
∞,S
=
E∞,S
/(d0
·
G)
∞,S
→
E∞,S
→
E
E
∞,S
surjects
onto
d0
·G
⊆
E∞,S
.
Thus,
it
follows
by
elementary
Moreover,
the
2-torsion
of
E
group
theory
that
G
⊆
E∞,S
is
contained
in
the
image
of
the
d-torsion
of
E∞,S
.
Write
def

⊆
E
∞,S
for
the
inverse
image
of
G
⊆
E∞,S
in
E
∞,S
,
and
G
∞,S
→
G
=
Ker(E

E/E
∞,S
.
Then
we
have
an
exact
sequence
E∞,S
)
⊆
E

0
→
GE/E

→G→G→0
of
ﬁnite,
ﬂat
group
schemes
over
S∞
which
are
annihilated
by
d.
Then
in
the
even
case,
we
assume
that
we
given
the
following
additional
data:
12

that
splits
the
above
exact
sequence
(i.e.,
a
subgroup
scheme
Gspl
⊆
G
maps
isomorphically
onto
G).
∞,S
,
the
resulting
metrized
line
bundle
If
we
pull
the
metrized
line
bundle
L
back
to
E
L|E
has
degree
2d,
hence
admits
(by
[HAT],
Chapter
IV,
Theorem
1.6)
a
canonical
∞,S
∞,S
annihilated
by
d
—
in
particular,
over
trivialization
over
any
subgroup
scheme
of
E
Gspl
.
Moreover,
it
follows
(from
[HAT],
Chapter
IV,
Theorem
1.6,
(2))
that
if
we
modify
the
splitting
Gspl
by
some
homomorphism
α
:
G
→
GE/E

,
then
the
resulting
trivialization
diﬀers
from
the
trivialization
corresponding
to
the
given
Gspl
by
a
factor
given
by
the
→
μ2
(which
is
function
β
◦
α
:
G
→
μ2
,
for
some
ﬁxed
homomorphism
β
:
GE/E

independent
of
α).
Remark.
Suppose
just
for
the
remainder
of
this
Remark
that
S
is
of
characteristic
0.
Since
GE/E

is
a
ﬁnite
étale
group
scheme
of
rank
2
over
S∞
,
GE/E

is
abstractly
isomorphic
to
{±1}
∼
=”
holds
since
we
are
in
characteristic
zero).
Moreover,
I
claim
=
μ2
(where
the
“∼
that
β
is
the
unique
isomorphism
between
GE/E

and
μ2
.
Indeed,
if
this
were
not
the
case,
then
β
would
be
trivial,
and
we
would
obtain
that
the
trivialization
of
L|Gspl
=
L|G
is
independent
of
the
choice
of
splitting
Gspl
.
Moreover,
if
the
trivialization
is
independent
of
the
splitting
for
this
particular
choice
of
G,
then
it
follows
(by
considering
the
action
of
Galois
on
G
in
the
universal
case,
i.e.,
ﬁnite
étale
coverings
of
the
moduli
stack
(M1,0
)Q
)
that
this
holds
for
all
G.
On
the
other
hand,
if
this
holds
for
all
G,
then
it
would
follow
that
the
canonical
section
of
[HAT],
Chapter
IV,
Theorem
1.6,
extends
to
a
section
deﬁned
over
KL
(i.e.,
not
just
2
·
KL
)
whose
image
is
contained
in
the
subscheme
SL
of
symmetric
elements.
Also,
let
us
observe
that
since
the
image
of
this
extended
section
lies
in
SL
,
it
follows
(by
the
same
argument
as
that
used
to
prove
the
latter
part
of
[HAT],
Chapter
IV,
Theorem
1.6,
(2))
that
the
formula
“{σ(a+b)·σ(a)−1
·σ(b)−1
}2
=
[a,
b]”
of
[HAT],
Chapter
IV,
Theorem
1.6,
(2),
also
applies
to
this
extended
section.
But
this
implies
that
the
Weil
pairing
[−,
−]
on
d-torsion
points
of
the
universal
elliptic
curve
over
(M1,0
)Q
admits
a
square
root,
which
is
absurd.
(Indeed,
the
ﬁeld
of
constants
in
(i.e.,
algebraic
closure
of
Q
in)
the
ﬁeld
of
deﬁnition
of
these
d-torsion
points
in
the
universal
case
is
Q(e2πi/d
),
but
the
existence
of
such
a
square
root
would
imply
that
Q(e2πi/2d
)
⊆
Q(e2πi/d
),
which
is
false,
since
d
is
even.)
This
completes
the
proof
of
the
claim.
The
purpose
of
the
above
Remark
was
to
convince
the
reader
that
the
introduction
of
the
splitting
Gspl
is,
in
fact,
unavoidable.
Thus,
one
way
to
summarize
the
above
discussion
in
a
fashion
which
is
independent
of
the
choice
of
splitting
Gspl
is
the
following:
There
is
a
natural
Hom(G,
μ2
)-torsor
T2
→
S∞
13
determined
by
E∞,S
,
G,
which
is
nontrivial
in
general.
Moreover,
over
T2
,
the
restriction
L|G
admits
a
canonical
trivialization.
Thus,
at
any
rate,
if
we
assume
that
we
are
given
a
splitting
Gspl
whenever
d
is
even,
then
regardless
of
the
parity
of
d,
we
obtain
(cf.
[HAT],
Chapter
IX,
§3)
a
natural
isomorphism
L|G
∼
=
OG
⊗OS∞
K
def
where
K
=
L|e
is
the
restriction
of
L
to
the
identity
section
∈
E∞,S
(S∞
).
Similarly,
(since
our
assumptions
on
G
and
H
are
identical)
if
we
assume
that
we
are
given
a
splitting
Hspl
of
the
analogous
exact
sequence
for
H

0
→
HE/E

→H→H→0
whenever
d
is
even,
then
regardless
of
the
parity
of
d,
we
obtain
(cf.
[HAT],
Chapter
IX,
§3)
a
natural
subgroup
scheme
H
⊆
GL
which
is
Lagrangian
in
the
sense
of
[MB],
Chapitre
V,
Déﬁnition
2.5.1.
Note
that:
(1)
After
possibly
replacing
S
by
a
ﬁnite
ﬂat
cover,
such
an
Hspl
always
exists.
(2)
Unlike
in
[HAT],
Chapter
IV,
§1,
we
do
not
assume
that
H
is
isomorphic
either
to
Z/dZ
or
μd
over
S.
Let
us
write
def
E∞H
,S
=
E∞,S
/H
for
the
quotient
of
E∞,S
by
H.
Thus,
we
have
a
natural
isogeny
E∞,S
→
E∞H
,S
.
Moreover,
since
we
have
a
lifting
H
⊆
GL
of
H,
we
also
get
a
natural
metrized
line
bundle
LH
on
E∞H
,S
that
descends
L.
Write
fH
:
E∞H
,S
→
S∞
for
the
structure
morphism
of
E∞H
,S
.
Note
that
the
relative
degree
(i.e.,
with
respect
to
fH
)
of
LH
is
1.
Thus,
it
follows
that
(fH
)∗
LH
is
a
metrized
line
bundle
on
S∞
.
Write
M
=
{(fH
)∗
LH
}−1
def
Next,
let
us
observe
that
if
we
compose
the
Fourier
transform
FG
(tensored
with
K)
discussed
in
§1
with
the
trivialization
isomorphism
L|G
∼
=
OG
⊗OS∞
K
reviewed
above,
we
get
a
morphism
14
L|G
→
OG

⊗OS∞
K
If
we
then
compose
this
morphism
with
the
morphism
obtained
by
restricting
sections
of
LH
(ﬁrst
to
E∞,S
and
then)
to
G,
we
obtain
a
morphism
E
:
M−1
→
OG

⊗OS∞
K
which
maps
a
section
of
LH
to
the
Fourier
expansion
of
the
corresponding
algebraic
theta
function.
This
“theta
Fourier
expansion
morphism”
is
the
main
topic
of
the
present
paper.
Note
that
since
OG

has
a
natural
OS∞
-algebra
structure,
it
makes
sense
to
speak
of
the
norm
of
a
section
of
OG
.
Thus,
this
norm
will
form
a
section
of
OS∞
.
In
particular,
if
we
take
the
norm
of
E,
we
obtain
a
section
ν
∈
Γ(S∞
,
M⊗d
⊗
K⊗d
)
The
main
technical
goal
of
the
present
paper
is
to
show
that
ν
is
invertible
on
the
interior
US
⊆
S∞
of
S∞
(i.e.,
the
open
subscheme
where
the
log
structure
is
trivial).
This
goal
will
be
achieved
by
computing
the
order
of
the
zeroes
of
ν
at
the
points
at
inﬁnity,
and
comparing
the
sum
of
these
orders
to
the
degree
of
the
metrized
line
bundle
M⊗d
⊗
K⊗d
(in
the
universal
case,
i.e.,
when
the
base
is
given
by
the
moduli
stack
of
log
elliptic
curves
—
note
that
over
such
a
base,
the
notion
of
“degree”
makes
sense),
which
is
given
by
Propositions
3.1,
3.2,
below.
It
turns
out
that
these
two
numbers
coincide.
This
will
def
suﬃce
to
show
that
ν
is
invertible
on
the
interior
US
=
S
−
D.
Remark.
If
we
change
the
choice
of
splitting
Gspl
,
then
the
resulting
trivialization
gets
multiplied
(cf.
the
above
discussion)
by
some
character
G
→
μ2
.
The
eﬀect
of
such
a
multiplication
on
the
Fourier
transform
(cf.
Proposition
1.1,
(ii.))
is
given
by
the
automorphism
of
OG

induced
by
translation
by
this
character
G
→
μ2
(regarded
as

=
Hom(G,
Gm
)).
Clearly,
the
norm
is
unaﬀected
by
such
automoran
element
of
G
phisms.
In
particular,
the
norm
ν
is
independent
of
the
choice
of
splitting.
One
way
to
summarize
this
observation
in
a
way
that
does
not
involve
Gspl
explicitly
is
the
following:
The
Hom(G,
μ2
)-torsor
T2
→
S∞
discussed
above
deﬁnes
(via
the
natural
inclusion

a
natural
G-torsor

Hom(G,
μ2
)
→
Hom(G,
Gm
)
=
G)
TG

→
S∞
Moreover,
the
Fourier
transform
of
a
section
of
L|G
is
naturally
given
by
an
element
of
OT
⊗OS∞
K.
G

For
the
remainder
of
this
§,
let
us
assume
that
S
is
a
smooth,
proper
(not
necessarily
connected)
one-dimensional
scheme
over
C
(the
complex
number
ﬁeld
—
in
fact,
any
ﬁeld
15
of
characteristic
zero
will
do).
Also,
let
us
assume
that
the
log
structure
of
S
log
arises
from
a
ﬁnite
number
of
points.
For
simplicity,
we
assume
that
C
log
→
S
log
degenerates
at
all
the
points
at
which
the
log
structure
of
S
log
is
nontrivial.
Recall
from
[HAT],
Chapter
IV,
§5,
that,
under
these
assumptions,
it
makes
sense
to
consider
the
degree
of
a
metrized
vector
bundle
on
S∞
,
and
from
[HAT],
Chapter
V,
Proposition
1.1,
that:
1
Proposition
3.1.
We
have:
deg(M)
=
24d
(d
−
1)
·
log(q).
Remark.
Just
as
in
[HAT],
degrees
will
always
be
expressed
in
“log(q)”
units,
i.e.,
those
units
for
which
the
divisor
at
inﬁnity
of
the
moduli
stack
(M1,0
)C
has
degree
1.
Proof.
Since
we
are
working
here
with
“H-invariants”
(cf.
[HAT],
Chapter
IV,
Theorem
1.4)
of
the
push-forward
that
appears
in
[HAT],
Chapter
V,
Proposition
1.1,
the
degree
of
M−1
is
1d
times
the
degree
appearing
in
loc.
cit.

1
Proposition
3.2.
We
have:
deg(M⊗d
⊗
K⊗d
)
=
24
(d
−
1)
·
log(q)
+
d
·
[L
·
e].
Moreover,
[L
·
e]
=
0
if
d
is
odd,
and
1
1
1

1

=−
·
{φ1
(−d
·
ηι
+
)
·
log(q)
=
−
·
{φ1
(−d
·
ηι
+
)
−
φ1
(−d
·
ηι
)}
·
log(q)
d
ι
2
d
ι
2
if
d
is
even.
(Here,
ηι
denotes
the
element
of
Q/Z
(i.e.,
the
connected
component
of
the
special
ﬁber
of
E∞,S
→
S∞)
deﬁned
at
the
point
at
inﬁnity
ι
by
the
torsion
point
1
η
∈
E∞,S
(S∞
),
and
φ1
(θ)
=
12
θ2
−
12
|θ|
+
12
(for
|θ|
≤
12
)
is
the
function
of
[HAT],
Chapter
IV,
Proposition
4.4.)
Proof.
It
remains
only
to
remark
that
the
computation
of
[L
·
e]
follows
from
[HAT],
Chapter
V,
Proposition
1.2.

The
computation
underlying
the
coincidence
of
degrees
referred
to
above
is
quite
complicated
and
forms
the
topic
of
§4-8.
One
of
the
ingredients
that
we
will
need
in
this
computation
is
(a
certain
consequence
of)
the
rather
complicated
degree
computation
carried
out
in
[HAT],
Chapter
VI,
§3.
For
d
a
positive
integer
≤
d,
let
us
consider
the
sums
(cf.
the
computation
in
the
proof
of
[HAT],
Chapter
VI,
Theorem
3.1,
which
corresponds
to
the
case
d
=
d)


def
Z(d,
d
,
m)
=
d


1
ι
j=1
d
·
cj
(Case
Xι
)
·
log(q)
(where,
just
as
in
[HAT],
sums
over
ι
are
to
be
interpreted
as
averages,
in
keeping
with
the
principle
that
everything
is
to
be
in
“log(q)
units”).
Put
another
way,
this
number
is
the
16
sum
of
the
d
smallest
exponents
of
q
that
appear
in
the
q-expansion
of
the
theta
functions
that
arise
at
the
various
points
ι
at
inﬁnity.
It
is
not
diﬃcult
to
see
that
this
number
is
determined
uniquely
by
d,
d
,
and
m.
Proposition
3.3.
If
d
is
odd,
then
Z(d,
d
,
m)
=
d
((d
)2
−
1)
·
log(q)
24d
If
d,
d
are
even,
then
d
d

1
((d
)2
−
1)
·
log(q)
−
·
φ1
(−d
·
ηι
+
)
·
log(q)
24d
d
2
ι
d
d

1
=
{φ1
(−d
·
ηι
+
)
−
φ1
(−d
·
ηι
)}
·
log(q)
((d
)2
−
1)
·
log(q)
−
·
24d
d
2
ι
Z(d,
d
,
m)
=
Here,
ηι
denotes
the
element
of
Q/Z
(i.e.,
the
connected
component
of
the
special
ﬁber
of
E∞,S
→
S∞)
deﬁned
at
the
point
at
inﬁnity
ι
by
the
torsion
point
η
∈
E∞,S
(S∞
),
and
1
φ1
(θ)
=
12
θ2
−
12
|θ|
+
12
(for
|θ|
≤
12
)
is
the
function
of
[HAT],
Chapter
IV,
Proposition
4.4.
Proof.
For
d
odd,
the
result
follows
(even
when
d
is
even)
from
the
computations
in
[HAT],
Chapter
VI,
the
portion
of
the
proof
of
Theorem
3.1
entitled
“Computation
of
the
Degree
in
the
Odd
Case”
(which
reduce,
essentially,
to
[HAT],
Chapter
V,
Lemma
4.2).
For
d,
d
even,
the
result
follows
from
the
computations
in
[HAT],
Chapter
VI,
the
portion
of
the
proof
of
Theorem
3.1
entitled
“Computation
of
the
Degree
in
the
Even
Case.”

Remark.
Often,
when
the
entire
discussion
consists
of
degrees
“in
log(q)
units,”
we
will
omit
the
symbol
“log(q),”
as
in
[HAT].
Finally,
before
proceeding,
we
would
like
to
introduce
some
more
notation.
Let
us
write
m
=
def
m
(m,
d)
Thus,
put
another
way,
m
is
the
order
of
the
torsion
point
d
·
η.
Note
that
Z(d,
d
,
m)
depends
only
on
d,
d
,
and
m
,
i.e.,
it
may
be
thought
of
as
a
function
of
these
three
variables.
When
we
wish
to
think
of
it
that
way,
we
shall
write:
Z

(d,
d
,
m
)
for
Z(d,
d
,
m).
17
§4.
The
Fourier
Transform
of
an
Algebraic
Theta
Function:
The
Case
of
an
Étale
Lagrangian
Subgroup
In
this
§,
we
would
like
to
estimate
the
order
of
vanishing
of
the
section
ν
of
§3
at
those
points
at
inﬁnity
where
the
Lagrangian
subgroup
H
⊆
E∞,S
is
“of
étale
type,”
i.e.,
maps
injectively
into
the
group
of
connected
components
Q/Z
in
the
special
ﬁber.
We
maintain
the
notation
of
§3,
except
that
in
the
present
§,
we
work
in
a
neighborhood
of
inﬁnity,
i.e.,
we
assume
that
def
1
S
=
Spec(C[[q
2md
]])
1
(equipped
with
the
log
structure
deﬁned
by
the
divisor
V
(q
2md
))
and
that
the
onedimensional
semi-abelian
scheme
in
question
E
→
S
(i.e.,
the
one-dimensional
semi-abelian
scheme
whose
logarithmic
compactiﬁcation
is
C
log
→
S
log
)
is
the
Tate
curve
“Gm
/q
Z
.”
Write
U
for
the
standard
multiplicative
coordinate
on
the
Gm
that
uniformizes
E.
Since
we
chose
the
base
S
so
that
q
admits
a
2d-th
root
in
OS
,
it
follows
that
our
Lagrangian
∞,S
when
d
and
restriction
subgroups
H,
G
⊆
E∞,S
,
as
well
as
the
splittings
Gspl
,
Hspl
⊆
E
is
even,
are
all
deﬁned
over
S
(i.e.,
not
just
over
S∞
).
Let
us
denote
the
unique
“point
at
def
inﬁnity”
(i.e.,
the
special
point
of
S)
by
∞S
.
Also,
we
set
n
=
2m
(as
in
[HAT],
Chapter
IV,
§2,3).

Let
us
denote
by
E∞,S
another
copy
of
E∞,S
.
In
the
following,
we
would
like
to

think
of
E∞,S
as
a
covering
of
E∞,S
,
by
means
of
the
isogeny
given
by
the
morphism
“multiplication
by
n”:

E∞,S

def
[n]
−→
E∞,S


Write
L
=
L|E∞,S
.
Note
that
since
L
has
degree
n2
·
d,
it
follows
that

KL
=
n2
·d
E∞,S

We
would
like
to
think
of
E∞,S
as
admitting
a
Schottky
uniformization
by
“another
copy
of
Gm
,”
which
we
shall
denote
by
Gm
.
The
standard
multiplicative
coordinate
on
Gm
will
be
denoted
by
U

.
Thus,
(U

)n
=
U.
Also,
for
various
natural
numbers
N
,
we
shall
denote
the
copy
of
μN
that
sits
naturally
inside
Gm
by
μN
.
Next,
let
us
observe
that
the
natural
action
of
Gm
on
the
Schottky
uniformization
of


,
L
)
(cf.,
e.g.,
the
discussion
of
[HAT],
Chapter
IV,
§2,3)
induces
a
natural
action
(E∞,S

of
μn2
·d
on
L
(cf.,
e.g.,
the
discussion
at
the
beginning
of
[HAT],
Chapter
IV,
§2)
—
that
is,
we
get
a
homomorphism:
iSch
:
μn2
·d
→
GL
18
On
the
other
hand,
let
us
observe
that
since
L
is
deﬁned
by
translating
a
symmetric
line
bundle
by
a
torsion
point
of
order
m
(and
then
readjusting
the
integral
structure/metric
ev
—
cf.
the
deﬁnitions
of
Lst,η
,
Lst,η
in
[HAT],
Chapter
V,
§1),
it
follows
that
if
we
forget

about
the
adjustment
of
the
metric,
then
L
is
totally
symmetric
(i.e.,
equal
to
the
square
of
a
symmetric
line
bundle).
Moreover,
it
follows
from
the
discussion
preceding
[HAT],


Chapter
V,
Proposition
1.1,
that
the
curvature
of
L
is
symmetric,
which
implies
that
L
is,
in
fact,
totally
symmetric
as
a
metrized
line
bundle.
Thus,
since
n
is
even,
it
follows
from
[HAT],
Chapter
IV,
Theorem
1.6,
that
the
canonical
section
“σ”
of
loc.
cit.
deﬁnes
a
homomorphism:
iσ
:
μn·d
→
GL
(the
fact
that
the
content
of
[HAT],
Chapter
IV,
Theorem
1.6,
is
still
valid
when
we
consider
metrics
follows
as
in
the
discussion
of
[HAT],
Chapter
IX,
§3).
Thus,
it
is
natural
to
ask
whether
or
not
these
two
homomorphisms
coincide
on
μn·d
:
Lemma
4.1.
We
have:
iσ
=
iSch
|μn·d
.

Proof.
Recall
that
L
is
totally
symmetric
as
a
metrized
line
bundle,
and
that
the
action


of
Gm
on
the
Schottky
uniformization
of
the
pair
(E∞,S
,
L
)
is
also
symmetric
(cf.
[HAT],
Chapter
IV,
§2).
Thus,
it
follows
that
iSch
maps
into
SL
.
Then
it
follows
from
the
deﬁnition
of
the
canonical
section
“σ”
in
[HAT],
Chapter
IV,
§1,
(together
with
the
fact
that
iSch
is
a
homomorphism)
that
iSch
|μn·d
=
iσ
,
as
desired.

Next,
let
us
recall
that
the
push-forward
(fH
)∗
(LH
)
is
generated
by
a
section
whose
corresponding
theta
function
is
given
by
(cf.
[HAT],
Chapter
V,
Theorem
4.8;
[HAT],
Chapter
VII,
§6):

q
d
(
2
·k
+(iχ/n)·k)
·
U
k
·
(U

)iχ
·
χ(k)
·
θm
1
1
2
k∈Z
def
for
some
character
χ
:
Z
→
μn
(where
n
=
2m),
and
some
integer
iχ
∈
{−m,
−m
+
1,
.
.
.
,
−1,
0,
1,
.
.
.
,
m
−
1}.
Since
“(U

)iχ
·
θm
”
essentially
amounts
to
the
trivialization
in
question,
we
see
that
the
“actual
theta
function”
is
given
by:
def
Θ
=

q
d
(
2
·k
+(iχ
/n)·k)
·
U
k
·
χ(k)
1
1
2
k∈Z
Let
us
ﬁrst
consider
the
case
where
G
is
of
multiplicative
type,
i.e.,
G
=
μd
⊆
Gm
.
This
is
in
some
sense
the
most
fundamental
and
important
case
of
the
various
cases
(relative
to
the
“position”
of
G,
H
inside
d
E∞,S
)
that
will
be
considered
in
this
and
the
following
§.
19
(As
we
saw
in
the
Remark
following
Proposition
3.2,
the
norm
ν
is
independent
of
the
choice
∞,S
→
E∞,S
of
Gspl
.
Moreover,
let
us
note
that
since
d0
·
G
is
multiplicative,
the
isogeny
E
of
§3
is
“of
étale
type,”
i.e.,
it
lies
between
E∞,S
and
its
Schottky
uniformization.
Put
∞,S
is
Schottky-uniformized
by
the
same
Gm
as
E∞,S
.
another
way,
this
means
that
E
def
Thus,
it
makes
sense
to
stipulate
that
we
take
Gspl
=
μd
⊆
Gm
.)
In
this
case,
restriction

to
G
amounts
to
identifying
U
k
and
U
k
whenever
k
≡
k
modulo
d.
Now
according
to
the
theory
of
[HAT],
Chapter
VIII,
§2,3,4,
there
is
a
certain
special
set
of
d
consecutive
integers
KCrit
such
that
the
result
of
restricting
the
above
theta
function
to
G
=
μd
is
given
by:
def
Θμ
=

(U|μd
)k0
·
k0
∈Z/dZ
=



q
d
(
2
·k
+(iχ/n)·k)
·
χ(k)
1
1
2
k∈Z,
k≡k0
(mod
d)
2
q
d
(
2
·k
+(iχ/n)·k)
·
(U|μd
)k
·
(χ(k)
+
k
)
·
{1
+
(smaller
powers
of
q)}
1
1
k∈KCrit
where
k
is
a
certain
n-th
root
of
unity
if
k
is
exceptional
(cf.
[HAT],
Chapter
VIII,
Lemmas
4.3,
4.4),
and
k
=
0
otherwise
(i.e.,
if
k
is
not
exceptional).
There
is
at
most
one
exceptional
k
in
the
set
KCrit
.
Moreover,
the
exponents
of
q
appearing
in
the
above
sum
are
precisely
the
d
numbers
1d
·cj
(for
j
=
1,
.
.
.
,
d)
appearing
in
the
deﬁnition
of
Z(d,
d,
m).
Moreover,
since
the
set
KCrit
consists
of
k
consecutive
integers,
it
follows
that
the
above
function
on
μd
is
essentially
the
Fourier
expansion
of
the
restriction
of
the
theta
function
in
question
to
G
=
μd
.
Thus,
we
obtain
that
the
degree
of
vanishing
at
∞S
of
the
norm
ν
constructed
in
§3
—
which
we
shall
denote
by
deg(ν)
—
is
≥
the
“ι
portion”
of
the
sum
in
the
deﬁnition
of
Z(d,
d,
m),
where
ι
corresponds
to
the
point
at
inﬁnity
∞S
where
we
have
localized
in
the
present
discussion.
(Here,
we
say
“≥,”
rather
than
“=”
since
we
dot
know
whether
or
not
the
coeﬃcient
χ(k)
+
k
which
appeared
above
is
nonzero.)
In
particular,
if
we
average
over
all
the
possible
ι’s
(which
corresponds
to
all
possible
torsion
points
η
of
order
precisely
m,
weighted
in
the
proper
fashion),
we
obtain
that
the
resulting
average
Avgη
(deg(ν))
satisﬁes
the
following:
Lemma
4.2.
We
have:
Avgη
(deg(ν))
≥
Z(d,
d,
m)
for
any
G
of
multiplicative
type
(i.e.,
for
which
G
=
μd
⊆
Gm
).
Thus,
it
remains
to
consider
the
case
when
G
is
not
necessarily
of
multiplicative
type.
Let
us
ﬁrst
observe
that
since
Im(G)
=
Im(d
E∞,S
)
⊆
E∞H
,S
is
independent
of
G,
it
follows
that
even
in
the
case
where
G
is
not
necessarily
of
multiplicative
type,
we
are
in
eﬀect
restricting
the
sections
of
(fH
)∗
LH
to
the
same
points
as
in
the
case
where
G
is
of
multiplicative
type.
The
eﬀect
of
using
a
diﬀerent
(e.g.,
a
non-multiplicative)
G
is
that
20
a
diﬀerent
G
results
in
a
diﬀerent
trivialization
at
those
points.
Thus,
in
particular,
the
resulting
theta
functions
diﬀer
by
a
factor
given
by
some
function
ψ
:
μd
→
Gm
.
Since
ultimately
we
are
interested
in
Fourier
transforms
of
theta
functions,
we
thus
see
that:
The
net
eﬀect
(of
using
a
non-multiplicative
G)
on
the
Fourier
transform
of
the
theta
function
in
question
is
to
convolute
by
d−1
·
F
(ψ)
(cf.
Proposition
1.1,
(ii.)).
Thus,
in
the
following,
we
propose
to
compute
ψ
and
its
Fourier
transform
F
(ψ),
and
then
consider
the
degree
of
the
zero
locus
at
inﬁnity
of
the
convolution
of
d−1
·
F
(ψ)
with
the
Fourier
transform
of
the
theta
function
considered
above.
To
compute
the
diﬀerence
ψ
in
trivializations
arising
from
G,
we
must
introduce
some
def
new
notation,
as
follows.
First,
we
write
Gμ
=
μd
⊆
Gm
.
Since
H
is
of
étale
type,
it
follows
that
Gμ
×
H
=
d
E∞,S
.
Note
that
since
H
injects
into
the
group
of
connected
components
of
the
special
ﬁber
of
E∞,S
,
we
get
a
natural
identiﬁcation
H
=
Z/dZ
Thus,
we
shall
think
of
d
E∞,S
as
Gμ
×H
=
μd
×Z/dZ.
Then
relative
to
this
decomposition,
G
may
be
written
as
the
graph
of
some
homomorphism
αG
:
μd
→
Z/dZ.

.
In
fact,
in
order
to
calculate
ψ,
we
will
need
to
lift
the
above
data
on
E∞,S
to
E∞,S

Of
course,
many
of
the
lifted
data
on
E∞,S
will
not
be
uniquely
determined
by
the
original
data
on
E∞,S
,
but
this
will
not
matter,
since
diﬀerent
choices
of
lifts
will
not
aﬀect
the
end
result.
Thus,
write
def
Gμ
=
μn2
·d
(so
n
·
Gμ
lifts
Gμ
)
and
choose
an

H

=
Z/n2
·
dZ
⊆
E∞,S
(where
the
identiﬁcation
of
H

with
Z/n2
·
dZ
is
assumed
to
be
given
by
the
natural

)
homomorphism
of
H

into
the
group
of
connected
components
of
the
special
ﬁber
of
E∞,S



such
that
n·H
lifts
H.
Finally,
we
choose
a
G
⊆
n2
·d
E∞,S
deﬁned
by
some
homomorphism
αG
:
μn2
·d
→
Z/n2
·
dZ
such
that
n
·
G
lifts
G.
Let
us
write
σ

:
2
·
KL
→
GL
21
for
the
canonical
section
of
[HAT],
Chapter
IV,
Theorem
1.6.
We
are
now
ready
to
compute
ψ
:
μd
→
Gm
.
Let
a
∈
μd
=
Gμ
.
Select
a
lifting
def
def
a
∈
n
·
Gμ
of
a.
Let
a1
∈
m
·
Gμ
be
such
that
2
·
a1
=
a
.
Write
b1
=
αG
(a1
);
b
=
2b1
;
b
for
the
image
of
b
in
E∞,S
(i.e.,
b
=
αG
(a)).
Then
it
essentially
follows
from
the
deﬁnitions
that:
ψ(α)
=
σ

((a
,
b
))
·
σ

(b
)−1
·
σ

(a
)−1
·
χex
(a
)
where
χex
:
n
·
Gμ
→
Gm
is
a
character.
(Indeed,
this
essentially
follows
from
the
fact
that
σ

,
as
well
as
the
sections
of
GL
used
in
§3
to
deﬁne
the
trivialization
of
L|G
and
the
subgroup
H
⊆
GL
are
all
homomorphisms
on
n
·
H

,
n
·
G
,
G,
and
H.
Thus,
the
restrictions
of
two
such
sections
to
the
same
subgroup
diﬀer
from
one
another
by
various
characters.
This
is
what
leads
to
the
“extra
factor”
χex
.)
On
the
other
hand,
by
[HAT],
Chapter
IV,
Theorem
1.6,
(2),
we
have
σ

((a
,
b
))
·
σ

(b
)−1
·
σ

(a
)−1
=
([b1
,
a1
]
)2

(where
[−,
−]
is
the
pairing
associated
to
L
).
Clearly,
the
right-hand
side
of
this
equality
is
a
2d-th
root
of
unity.
Thus,
(since
ψ(−)d
=
1)
we
obtain
that
χex
(−)2d
=
1.
Now
suppose
that
d
is
odd.
In
this
case,
we
may
choose
a
and
a1
to
be
of
odd
order.
This
implies
that
b
and
and
b1
are
also
of
odd
order.
Since
it
makes
sense
to
multiply
elements
of
odd
order
by
12
,
we
thus
obtain:
([b1
,
a1
]
)2
=
([b
,
a
]
)
2
=
[b,
a]
2
1
1
(where
[−,
−]
is
the
pairing
associated
to
L).
In
particular,
we
get
χex
(−)d
=
1.
By
abuse
of
notation,
let
us
write
χex
(a)
for
χex
(a
).
That
is,
we
have:
ψ(a)
=
[a,
αG
(a)]−
2
·
χex
(a)
1
for
some
χex
:
Gμ
→
μd
.
This
completes
the
case
when
d
is
odd.
Now
suppose
that
d
is
even.
In
this
case,
we
obtain:
ψ(a)
=
([a1
,
αG
(2a1
)]
)−1
·
χex
(a
)
Note
that
a1
is
well-deﬁned
up
to
the
addition
of
an
element
a
∈
m
·
d
·
Gμ
=
μ2n
.
Moreover,
one
checks
easily
that
the
pairing
(x,
y)
→
[x,
αG
(y)]
on
Gμ
×Gμ
is
symmetric.
Thus,
22
[a1
+
a
,
αG
(2a1
+
2a
)]
=
[a1
,
αG
(2a1
)]
·
[a
,
αG
(2a1
)]
·
[a1
,
αG
(2a
)]
·
[a
,
αG
(2a
)]
=
[a1
,
αG
(2a1
)]
·
[a
,
αG
(a
)]
·
[a
,
αG
(a
)]
·
[a
,
αG
(2a
)]
=
[a1
,
αG
(2a1
)]
·
[a
,
αG
(2a
)]
·
[a
,
αG
(2a
)]
=
[a1
,
αG
(2a1
)]
·
[??,
n
·
d
·
αG
(a
+
a
)]
=
[a1
,
αG
(2a1
)]
where
we
use
that
n
·
d
·
a
=
0;
(since
d
is
even)
n
·
d
·
a
=
0.
Thus,
it
follows
that
([a1
,
αG
(2a1
)]
)−1
depends
only
on
a
(i.e.,
not
on
the
choice
of
lifting
a1
).
In
particular,
(since
ψ(a)
manifestly
only
depends
on
a)
we
obtain
that
χex
(a
)
depends
only
on
a.
By
abuse
of
notation,
we
will
write
χex
(a)
for
χex
(a
).
Thus,
in
summary:
Lemma
4.3.
Let
a
∈
Gμ
=
μd
.
Then
if
d
is
odd,
then
ψ(a)
=
[a,
αG
(a)]−
2
·
χex
(a)
1
for
some
character
χex
:
Gμ
→
μd
.
If
d
is
even,
and
a1
∈
m
·
Gμ
satisﬁes
2a1
→
a,
then
ψ(a)
=
([a1
,
αG
(2a1
)]
)−1
·
χex
(a)
for
some
character
χex
:
Gμ
→
μd
.
In
particular,
if
the
homomomorphism
αG
:
μd
→
Z/dZ
is
of
order
dord
,
then
it
follows
that
(regardless
of
the
parity
of
d)
ψ
:
μd
→
Gm
is
—
up
to
a
factor
given
by
the
character
χex
—
the
pull-back
to
μd
via
the
natural
projection
μd
→
μdord
(arising
from
the
fact
that
dord
divides
d)
of
a
reduced
discrete
Gaussian
(cf.
Deﬁnition
2.2)
on
μdord
.
Proof.
It
remains
only
to
verify
that
the
bracketed
portions
of
the
expressions
that
we
obtained
above
for
ψ(a)
are
indeed
pull-backs
of
reduced
discrete
Gaussians
as
described.
But
this
follows
immediately
from
the
deﬁnitions.
Note
that
we
use
here
the
well-known
fact
that
the
pairings
[−,
−];
[−,
−]
are
nondegenerate.
(Indeed,
if
they
were
degenerate,

then
the
theory
of
theta
groups
would
imply
that
that
L
descends
to
some
quotient
of


E∞,S
by
a
ﬁnite
group
scheme
of
order
>
n2
·
d,
which
is
absurd,
since
deg(L
)
=
n2
·
d.)

Thus,
by
Proposition
1.1,
(ii.);
Proposition
1.2,
(i.);
and
Proposition
2.3,
it
follows
that
The
eﬀect
on
the
Fourier
expansion
of
the
theta
function
of
the
trivializa
(determined
tion
deﬁned
by
G
is
given
by
translation
by
an
element
of
G

of
the
by
the
character
χex
),
followed
by
convolution
by
a
function
on
G
form:
1
Z/dZ

·
dord
−
2
·
IndZ/dord
Z
ξ
23
√
where

is
a
4-th
root
of
unity
(respectively,
2
times
an
8-th
root
of
unity)
if
dord
is
odd
(respectively,
even),
and
ξ
is
a
reduced
discrete
Gaussian
on
Z/dord
Z.
Let
us
denote
the
function
ψ
·
Θμ
on
μd
(whose
Fourier
expansion
is
discussed
above)
by:
def
ΘG
=
ψ
·
Θμ
Then
if
we
assume
(so
that
we
do
not
have
to
deal
in
the
expression
below
with
“exceptional
k”)
that
dord
=
1
(note:
the
case
dord
=
1
was
dealt
with
above
in
Lemma
4.2),
then
since
the
values
of
ξ
are
all
∈
μ2dord
,
we
obtain
that
(for
k0
∈
Z/dZ)
the
coeﬃcient
of
(U|μd
)k0
+kex
(where
kex
∈
Z/dZ
is
a
ﬁxed
element
determined
by
χex
)
in
the
Fourier
expansion
of
ΘG
is
of
the
following
form:
Coeﬀ
(U
|μ
)k0
+kex
(ΘG
)
d
=

·
dord
−
2
·
1
=

·
dord
−
12
·


0
q
d
(
2
·k
+(iχ/n)·k)
·
χ(k)
·
ξ(
k−k
deff
)
1
k∈Z,
k≡k0
(mod
deff
)
2
1
a
μn·dord
-linear
combination
of
those
q
d
(
2
·k
+(iχ/n)·k)
1
1
2
for
which
k
∈
KCrit
,
k
≡
k0
(modulo
deﬀ
),
+
smaller
powers
of
q
def
where
deﬀ
=
d/dord
.
Since
the
power
of
q
that
appears
in
the
coeﬃcient
of
(U|μd
)k0
+kex
for
Θμ
is
precisely
the
smallest
exponent
of
q
that
appears
in
the
q-expansion
of
the
original
theta
function
Θ
among
those
terms
indexed
by
a
k
such
that
k
≡
k0
(modulo
d),
it
thus
follows
that
the
smallest
power
of
q
that
appears
in
the
coeﬃcient
of
(U|μd
)k0
+kex
for
ΘG
is
precisely
the
smallest
exponent
of
q
that
appears
in
the
q-expansion
of
the
original
theta
function
Θ
among
those
terms
indexed
by
a
k
such
that
k
≡
k0
(modulo
deﬀ
).
Moreover,
this
smallest
power
either
appears
precisely
once
in
Coeﬀ
(U
|μ
)k0
+kex
(ΘG
),
in
which
case
d
its
coeﬃcient
(i.e.,
in
the
“μn·dord
-linear
combination”
discussed
above)
is
∈
μn·dord
,
or
(cf.
the
“exceptional
case”
of
[HAT],
Chapter
VIII,
Lemmas
4.3,
4.4)
it
appears
twice
in
Coeﬀ
(U
|μ
)k0
+kex
(ΘG
),
in
which
case
its
coeﬃcient
is
the
sum
of
two
elements
∈
μn·dord
.
d
Thus,
by
the
same
reasoning
as
that
used
to
prove
Lemma
4.2,
we
obtain
the
following,
which
is
the
main
result
of
this
§:
Theorem
4.4.
Assume
that
the
Lagrangian
subgroup
H
is
of
étale
type.
Then
for
any
restriction
subgroup
G
⊆
d
E∞,S
,
we
have:
Avgη
(deg(ν))
≥
dord
·
Z(d,
deﬀ
,
m)
24
where
d
=
deﬀ
·
dord
,
and
dord
is
the
order
of
the
diﬀerence
between
G
and
the
multiplicative
subgroup
Gμ
=
μd
.
Moreover,
the
coeﬃcient
of
the
smallest
power
of
q
in
Coeﬀ
(U
|μ
)k0
+kex
(ΘG
)
is
of
the
d
form:
1

·
dord
−
2
·
(an
element
∈
μn·dord
)
√
(where

is
a
4-th
root
of
unity
(respectively,
2
times
an
8-th
root
of
unity)
if
dord
is
odd
(respectively,
even)),
with
at
most
one
possible
exceptional
class
of
k0
’s
in
Z/deﬀ
Z.
If
this
exception
occurs,
and
the
above
inequality
is
an
equality,
then
the
coeﬃcient
of
the
smallest
power
of
q
in
Coeﬀ
(U
|μ
)k0
+kex
(ΘG
)
in
this
case
is
of
the
form:
d

·
dord
−
2
·
(a
nonzero
sum
of
two
elements
∈
μn·dord
)
1
(where

is
a
4-th
root
of
unity
(respectively,
(respectively,
even)).
√
2
times
an
8-th
root
of
unity)
if
dord
is
odd
Proof.
Note
that
here,
we
only
obtain
an
inequality
Avgη
(deg(ν))
≥
dord
·
Z(d,
deﬀ
,
m)
because
we
do
not
know
whether
or
not
(in
the
“exceptional
case”
for
dord
=
1)
the
sum
of
the
two
(n
·
dord
)-th
roots
of
unity
is
nonzero.
The
factor
of
dord
that
appears
on
the
right-hand
side
of
this
inequality
arises
because
since
the
coeﬃcient
Coeﬀ
(U
|μ
)k0
+kex
(ΘG
)
d
depends
only
on
the
class
of
k0
in
Z/deﬀ
Z,
zeroes
occur
with
multiplicity
d/deﬀ
=
dord
.

§5.
The
Fourier
Transform
of
an
Algebraic
Theta
Function:
The
Case
of
a
Lagrangian
Subgroup
with
Nontrivial
Multiplicative
Part
In
this
§,
we
would
like
to
estimate
the
order
of
vanishing
of
the
section
ν
of
§3
at
those
points
at
inﬁnity
where
the
Lagrangian
subgroup
H
⊆
E∞,S
is
“not
necessarily
of
étale
type,”
i.e.,
does
not
necessarily
map
injectively
into
the
group
of
connected
components
Q/Z
in
the
special
ﬁber.
In
essence,
our
strategy
will
be
to
reduce
to
the
case
where
H
is
of
étale
type,
which
was
already
dealt
with
in
§4.
In
this
§,
we
maintain
the
notation
of
§4.
However,
unlike
the
situation
of
§4,
we
do
not
assume
that
H
is
of
étale
type.
Write
def
Hμ
=
H
25
μd
(where
μd
⊆
Gm
sits
inside
the
copy
of
Gm
that
uniformizes
E).
Note
that
the
subgroup
Hμ
⊆
H
denotes
the
portion
of
the
Lagrangian
subgroup
H
which
is
purely
of
multiplicative
type.
Write
Het
for
the
image
of
H
in
the
group
of
connected
components
in
the
special
ﬁber
of
E∞,S
(a
group
which
may
be
identiﬁed
with
Q/Z).
Thus,
we
have
an
exact
sequence:
0
→
Hμ
→
H
→
Het
→
0
def
def
We
denote
the
orders
of
Hμ
,
Het
by:
hμ
=
|Hμ
|;
het
=
|Het
|.
Thus,
hμ
·
het
=
d.
Also,
let
us
write
def
Get
=
Ker([hμ
]
:
G
→
G)
for
the
kernel
of
multiplication
by
hμ
on
G.
Thus,
|Get
|
=
het
.
Next,
let
us
set:
def
E∞μ
,S
=
E∞,S
/Hμ
def
On
the
other
hand,
let
us
recall
the
quotient
E∞H
,S
=
E∞,S
/H
of
§3.
Since
Hμ
⊆
H,
it
follows
that
the
isogeny
E∞,S
→
E∞H
,S
factors
into
a
composite
of
isogenies:
E∞,S
Hμ
−→
H
et
−→
E∞H
,S
E∞μ
,S
where
Hμ
=
μ(hμ
)
;
Het
=
Z/het
Z;
and
the
groups
above
the
arrows
denote
the
kernels
of
the
homomorphisms
corresponding
to
the
arrows.
If
we
denote
the
respective
“q-parameters”
and
“standard
multiplicative
coordinates
on
the
respective
Schottky
uniformizations”
by
q,
qμ
,
qH
,
and
U,
Uμ
,
and
UH
,
respectively,
then
we
have:
q
μ
=
qμ
;
h
het
qμ
=
qH
;
U
μ
=
Uμ
;
h
Uμ
=
UH
In
the
following,
we
will
also
write
Gm
,
(Gm
)μ
,
(Gm
)H
for
the
copies
of
“Gm
”
that
Schottky
uniformize
E∞,S
,
E∞μ
,S
,
and
E∞H
,S
,
respectively,
(so,
in
particular,
(Gm
)μ
=
μ
(Gm
)H
)
and
μN
⊆
Gm
;
μN
⊆
(Gm
)μ
;
μH
N
⊆
(Gm
)H
for
the
copies
of
“μN
”
lying
inside
these
copies
of
Gm
.
Finally,
observe
that
since
we
are
given
a
lifting
H
⊆
GL
of
H,
we
also
get
natural
metrized
line
bundles
Lμ
and
LH
on
E∞μ
,S
and
E∞H
,S
,
respectively,
that
descend
L.
Note
that
since
H
and
G
generate
d
E∞,S
,
it
follows
that
G
→
E∞μ
,S
.
Thus,
we
obtain
subgroup
schemes
26
Het
,
Get
→
E∞μ
,S
Note
that
Het
is
tautologically
of
étale
type.
Thus,
it
follows
that
the
image
ImE∞H
,S
(Get
)
of
Get
in
E∞H
,S
is
of
multiplicative
type.
(Indeed,
since
E∞H
,S
is
obtained
from
E∞μ
,S
by
forming
the
quotient
by
Het
,
which
is
of
étale
type,
it
follows
that
the
entire
image
μ
ImE∞H
,S
(het
E∞μ
,S
)
=
ImE∞H
,S
(μhet
)
in
E∞H
,S
is
of
multiplicative
type.)
Next,
write
def
Gμ
=
G/Get
Note
that
|Gμ
|
=
hμ
,
and
that
(since
the
image
ImE∞H
,S
(Get
)
of
Get
in
E∞H
,S
is
of
multiplicative
type)
Gμ
maps
naturally
into
the
group
of
connected
components
in
the
special
ﬁber
of
E∞H
,S
.
Moreover,
this
map
is
injective.
(Indeed,
this
injectivity
may
be
veriﬁed
for
each
of
the
p-primary
portions
(where
p
is
a
prime
number)
of
Gμ
independently;
thus,
it
suﬃces
to
verify
this
injectivity
in
the
case
where
d
is
a
prime
power.
But
then,
if
injectivμ
μ
ity
did
not
hold,
then
it
would
follow
that
(ImE∞
,S
(G)+Het
)
μd
⊆
μhet
,
which
implies
μ
μ
(by
multiplying
both
sides
of
this
non-inclusion
by
het
)
that
ImE∞
,S
(G)
μd
=
{1}
(so,
μ
in
particular,
G
μd
=
{1},
hence
(since
G
and
H
generate
d
E∞,S
)
that
hμ
=
|Hμ
|
=
1,
so
Gμ
=
{1}
—
which
implies
that
injectivity
holds
trivially.)
Thus,
in
summary,
this
injection
induces
a
natural
identiﬁcation
1
Z/Z
hμ
Gμ
=
Next,
let
us
deﬁne
def
heﬀ
=
|ImE∞
μ
,S
(Get
)
μ
μd
|
Note
that
since
H
and
G
generate
d
E∞,S
,
it
follows
that
(heﬀ
,
hμ
)
=
1.
Since
heﬀ
divides
het
,
let
us
write
het
=
heﬀ
·
hord
.
Write
Heﬀ
⊆
Het
;
Geﬀ
⊆
Get
for
the
respective
subgroups
given
by
the
kernel
of
multiplication
by
hord
.
Thus,
|Heﬀ
|
=
|Geﬀ
|
=
heﬀ
.
The
main
theme
of
this
§
is
the
following:
We
would
like
to
apply
the
theory
of
§4
to
the
data
(E∞μ
,S
;
Lμ
;
Het
,
Get
→
E∞μ
,S
)
27
where
we
take
the
point
“η”
of
§4
to
be
the
given
η
plus
a
collection
of
representatives
of
the
various
classes
of
Gμ
=
G/Get
.
Next,
we
consider
metrized
line
bundles.
Note
that
the
metrized
line
bundle
LH
on
E∞H
,S
has
degree
1
and
curvature
(cf.
[HAT],
Chapter
V,
§1)
given
by:
(hμ
)−1

1
·
δ[i/hμ
]
hμ
i=0
(where
δ[i/hμ
]
denotes
the
delta
distribution
on
S1
concentrated
at
the
point
[i/hμ
]
⊆
S1
).
Let

def
LH
=
LH
(ψ)

where
ψ
:
S1
→
R
is
the
unique
piecewise
smooth
function
such
that
the
curvature
of
LH


is
equal
to
δ[0]
,
and
S1
ψ
=
0.
Then,
as
reviewed
in
§4,
LH
is
generated
by
the
section
deﬁned
by
the
theta
function:
def
−
1
k2

ΘH
=
qH
2
η
1
(k+kη
)2
qH2
k
·
UH
·
χ(k)
k∈Z
def
where
we
write
kη
=
iχ
/n
(so
|kη
|
≤
12
).
Observe
that
as
a
function
on
Z,
the
function
k
→
12
(k
+
kη
)2
assumes
its
minimum
at
k
=
0.
Moreover,
if
we
restrict
ΘH
to
μH
het
,
then
k0
the
highest
power
of
qH
appearing
in
the
coeﬃcient
of
(UH
|μH
)
is
given
by:
het
1
1
−
kη2
+
Mink≡k0
mod
het
{
(k
+
kη
)2
}
2
2
1
1
=
−Mink∈Z
{
(k
+
kη
)2
}
+
Mink≡k0
mod
het
{
(k
+
kη
)2
}
2
2
Now
to
consider
such
coeﬃcients
of
(UH
|μH
)k0
amounts
to
considering
the
Fourier
transhet
form
of
the
restriction
of
the
theta
function
in
question
to
μH
het
.
More
generally
—
cf.
the
theory
of
§4,
which
we
think
of
as
being
applied
to
the
data
(E∞μ
,S
;
Lμ
;
Het
,
Get
→
E∞μ
,S
)
—
we
would
like
to
consider
the
Fourier
coeﬃcients
of
the
convolution
of
ΘH
|μH
with
het
some
reduced
discrete
Gaussian
(times
a
character)
on
μH
hord
(regarded
as
a
quotient
of
μ
μd
|.)
Then
μH
het
).
(Note
that
hord
=
het
/heﬀ
appears
here
since
heﬀ
=
|ImE∞μ
,S
(Get
)
28
the
highest
power
of
qH
appearing
in
the
coeﬃcient
of
(UH
|μH
)k0
+kex
(for
such
a
convohet
lution,
where
kex
is
a
constant
determined
by
the
character)
is
given
by:
1
1
−
kη2
+
Mink≡k0
mod
heff
{
(k
+
kη
)2
}
2
2
1
1
=
−Mink∈Z
{
(k
+
kη
)2
}
+
Mink≡k0
mod
heff
{
(k
+
kη
)2
}
2
2
Note
that
for
an
appropriate
choice
of
reduced
discrete
Gaussian,
this
convolution
amounts
precisely
to
the
restriction
of
the
theta
function
in
question
to
Get
.
Of
course,
ultimately,
we
wish
to
consider
the
Fourier
coeﬃcients
of
the
restriction
of
the
theta
function
in
question
to
G.
This
amounts
to
restricting
ΘH
to
Get
+
γ,
for
various
γ
∈
Gμ
=
G/Get
.
Write
kγ
∈
h1
Z
for
a
representative
of
γ
∈
Gμ
=
h1
Z/Z.
Also,
let
us
μ
μ
deﬁne
a
metrized
line
bundle
on
E∞H
,S

def
LH
=
LH
(ψ(0))


(where
ψ
:
S1
→
R
is
the
function
appearing
in
the
deﬁnition
of
LH
).
Thus,
LH
,
LH
,
and


LH
have
the
same
restriction
to
the
generic
ﬁber
of
E∞H
,S
;
LH
and
LH
have
the
same


curvature;
and
LH
and
LH
have
the
same
metric
structure
at
the
connected
component

m
for
the
q-adic
formal
of
the
identity
(in
the
special
ﬁber
of
E∞H
,S
).
Let
us
write
G
completion
of
(Gm
)S∞
.
Then
it
follows
from
the
determination
of
the
metric
given
in,
e.g.,
[HAT],
Chapter
VII,
Lemma
6.4
(cf.
also
the
discussion
following
this
lemma),
together
(1/(hμ
·n))·Z
with
the
well-known
explicit
form
of
theta
functions
on
(Gm
)H
/qH
(cf.
[HAT],

Chapter
V,
Theorem
4.8),
that
if
we
regard
ΘH
as
a
section
of
LH
,
then
its
restriction
to

m
corresponding
to
γ
will
be
given
(up
to
a
possible
factor
∈
μ
)
by:
the
copy
of
G
∞
def
−
1
k2
ΘH
[γ]
=
qH
2
η
·

1
(k+kη
+kγ
)2
k+kγ
·
UH
qH2
·
χ(k)
k∈Z
k
(where,
in
the
above
expression,
the
factor
UHγ
may
be
thought
of
as
part
of
the
trivialization
in
use;
moreover,
since
this
same
factor
multiplies
all
the
terms
in
the
above
expression,
it
may
be
ignored
—
i.e.,
we
essentially
have
a
function
in
integral
powers
of
UH
).
Thus,
if
we
write
1
1
2
def
1
kH
=
Mink∈Z,
γ∈Gμ
{
(k
+
kη
+
kγ
)2
}
≤
kη2
2
2
2
then
def
1
2
k2
−
12
kH
ΘH
[γ]
=
qH2
η
−
1
k2
·
ΘH
[γ]
=
qH
2
H
·

k∈Z
29
1
(k+kη
+kγ
)2
qH2
k+kγ
·
UH
·
χ(k)
is
the
theta
function
associated
to
a
generator
of
(fH
)∗
LH
.
Moreover,
if
we
then
convolute
ΘH
[γ]|μH
with
some
reduced
discrete
Gaussian
(times
a
character)
pulled
back
from
het
H
the
quotient
μH
het
→
μhord
,
then
it
follows
that
the
highest
power
of
qH
appearing
in
the
coeﬃcient
of
(UH
|μH
)k0
+kex
(where
k0
∈
Z)
for
such
a
convolution
is
given
by:
het
1
2
1
−
kH
+
Mink≡k0
−kγ
mod
heff
{
(k
+
kη
+
kγ
)2
}
2
2
(where
k
∈
Z,
and
the
congruence
symbol
“≡”
is
well-deﬁned
since,
as
remarked
above,
(heﬀ
,
hμ
)
=
1).
Thus,
if
we
allow
γ
to
vary,
then
we
obtain
that
the
highest
power
of
qH
appearing
in
the
coeﬃcient
of
(UH
|μH
)k0
+kex
(where
k0
∈
Z)
for
such
a
convolution
is
het
given
by:
1
1
2
+
Minj/hμ
≡k0
mod
heff
{
((j/hμ
)
+
kη
)2
}
−
kH
2
2
1
1
1
2
=
−
kH
+
2
·
Minj≡hμ
·k0
mod
heff
{
(j
+
hμ
·
kη
)2
}
2
hμ
2
(where
j
∈
Z,
and
the
congruence
symbol
“≡”
is
well-deﬁned
since,
as
remarked
above,
(heﬀ
,
hμ
)
=
1).
The
above
analysis
thus
implies
—
by
the
same
reasoning
as
that
used
to
derive
Theorem
4.4
in
§4
—
the
following
generalization
of
Theorem
4.4,
which
is
the
main
result
of
this
§:
Theorem
5.1.
For
any
Lagrangian
subgroup
H
and
any
restriction
subgroup
G
⊆
d
E∞,S
,
we
have:
Avgη
(deg(ν))
≥
(d/heﬀ
)
·
Z

(d,
heﬀ
,
m
)
where
heﬀ
=
|ImE∞
μ
,S
(Get
)
μ
μd
|.
Proof.
The
sums
Z

(−,
−,
−)
are
deﬁned
as
sums
of
minima
such
as
1
Minj≡hμ
·k0
mod
heff
{
(j
+
hμ
·
kη
)2
}
2
1/h2μ
1
regarded
as
powers
of
q
d
.
Here,
we
wish
to
regard
such
minima
as
powers
of
qH
1/hμ
het
/hμ
het
implies
q
=
qH
,
hence
in
fact,
q
=
qμ
,
qμ
=
qH
1
d
q
=q
1/(het
·hμ
)
30
1/h2μ
=
qH
.
But
so
we
see
that
we
do
not
need
to
multiply
the
Z

(−,
−,
−)’s
by
any
factor
in
our
estimate
of
the
degree
of
vanishing
of
the
product
of
the
Fourier
coeﬃcients
corresponding
to
a
single
collection
of
representatives
in
Z/dZ
of
the
set
of
“equivalence
classes”
(Z/dZ)/heﬀ
·
(Z/dZ)
=
Z/heﬀ
Z.
Since,
for
a
given
class
of
Z/dZ
modulo
heﬀ
,
we
must
contend
with
a
total
of
d/heﬀ
Fourier
coeﬃcients,
we
thus
obtain
a
factor
of
d/heﬀ
in
our
ﬁnal
estimate.
Finally,
note
that
the
term
hμ
·kη
appearing
in
the
minima
above
corresponds
precisely
to
the
image
“d
·
ηι
”
of
ηι
∈
S1
(where
this
S1
is
the
S1
corresponding
to
the
special
ﬁber
of
the
original
E∞,S
)
in
S1
/(
1d
Z/Z).
Indeed,
kη
corresponds
to
the
image
of
ηι
in
S1
/(
h1et
Z/Z)
=
(S1
)H
(i.e.,
the
S1
corresponding
to
the
special
ﬁber
of
E∞H
,S
),
so
the
image
“d
·
ηι”
of
ηι
in
S1
/(
1d
Z/Z)
is
given
by
multiplying
kη
by
d/het
=
hμ
,
as
desired.

def
Theorem
5.2.
In
the
situation
of
Theorem
5.1,
write
hμ
=
|H
μd
|;
d
=
hμ
·
het
;
het
=
heﬀ
·
hord
.
Then
the
coeﬃcient
of
the
smallest
power
of
q
in
the
Fourier
coeﬃcients
of
the
algebraic
theta
function
in
question
on
G
(cf.
the
discussion
of
§3)
are
of
the
form:

·
hord
−
2
·
(an
element
∈
μn·hμ
·hord
)
1
√
(where

is
a
4-th
root
of
unity
(respectively,
2
times
an
8-th
root
of
unity)
if
hord
is
odd
(respectively,
even)),
with
at
most
one
possible
exceptional
class
of
coeﬃcients
in

If
this
exception
occurs,
and
the
inequality
of
Theorem
5.1
is
an
equality,
then

eﬀ
·
G.
G/h
the
coeﬃcient
of
the
smallest
power
of
q
in
this
coeﬃcient
is
of
the
form:

·
hord
−
2
·
(a
nonzero
sum
of
two
elements
∈
μn·hμ
·hord
)
1
(where

is
a
4-th
root
of
unity
(respectively,
(respectively,
even)).
√
2
times
an
8-th
root
of
unity)
if
hord
is
odd
Proof.
This
follows
essentially
from
the
above
analysis,
together
with
the
following
remarks:
First
of
all,
it
follows
from
the
fact
that
the
function
j
→
(j
+
hμ
·
kη
)2
(on
integers
j
such
that
j
≡
hμ
·
k0
mod
heﬀ
)
is
“essentially”
injective
(i.e.,
either
injective
or,
if
it
is
not
injective,
then
the
ﬁber
consists
of
two
elements)
that
the
minima
discussed
above
are
achieved
for
“essentially”
only
one
value
of
j
(where
“essentially”
means
that
there
is
at
most
one
exception,
in
which
case
the
minimum
is
achieved
for
precisely
of
two
values
of
j).
Thus,
by
considering
the
class
of
this
j
modulo
hμ
,
we
see
that
we
need
only
consider
the
restriction
of
ΘH
to
Get
+
γ,
for
ﬁxed
γ
∈
Gμ
.
But
since
(by
deﬁnition)
Gμ
=
G/Get
,
it
follows
that
then
we
are
essentially
in
the
situation
of
§4,
applied
to
the
data
(E∞μ
,S
;
Lμ
;
Het
,
Get
→
E∞μ
,S
)
31
(so
“dord
”
of
§4
becomes
het
/heﬀ
=
hord
in
the
notation
of
the
present
discussion).
Thus,
Theorem
5.2
follows
from
Theorem
4.4.
Note
that
here,
when
we
apply
Theorem
4.4,
the
“n”
of
Theorem
4.4
becomes
n
·
hμ
(in
the
notation
of
the
present
discussion)
since
in
addition
to
translating
by
η,
we
are
also
translating
by
γ
whose
order
in
G/Get
divides
hμ
.
This
completes
the
proof
of
Theorem
5.2.

§6.
Generic
Properties
of
the
Norm
In
this
§,
we
maintain
the
notation
of
§4.
(In
particular,
we
continue
to
assume
that
the
Lagrangian
subgroup
is
of
étale
type.)
The
goal
of
the
present
§
is
to
determine
in
which
cases
the
norm
ν
(of
the
Fourier
transform
of
an
algebraic
theta
function)
is
generically
nonzero
(on
the
moduli
space
of
elliptic
curves
in
characteristic
zero).
Recall
the
notation
m
=
def
m
(m,
d)
Thus,
put
another
way,
m
is
the
order
of
the
torsion
point
d
·
η.
Deﬁnition
6.1.
If
our
data
satisﬁes
the
conditions:
(1)
d
is
even;
(2)
m
=
2;
(3)
d
·
η
∈
G
(where
G
is
the
restriction
subgroup);
then
we
shall
say
that
our
data
is
of
null
type.
If
our
data
is
not
of
null
type,
then
we
shall
say
that
it
is
of
general
type.
Remark.
In
fact,
condition
(1)
of
Deﬁnition
6.1
is
implied
by
conditions
(2)
and
(3).
The
main
result
of
this
§
is
the
following:
Proposition
6.2.
The
norm
ν
(introduced
in
§3)
is
generically
zero
on
S
if
and
only
if
our
data
is
of
null
type.
32
Proof.
If
we
work
over
a
global
S
as
in
§3,
then
it
is
immediate
that
every
connected
component
of
S
contains
points
at
inﬁnity
at
which
the
restriction
subgroup
G
is
of
multiplicative
type
(cf.
§4).
Thus,
it
suﬃces
to
prove
Proposition
6.2
in
the
case
where
G
is
of
multiplicative
type.
Now
we
return
to
a
local
S
(as
in
§4,
5).
Since
G
is
of
multiplicative
type,
we
know
the
explicit
form
of
the
restriction
to
G
of
the
theta
function
in
question
(cf.
§4):
def
Θμ
=

k0
(U|μd
)
k0
∈Z/dZ
=

·


q
d
(
2
·k
+(iχ/n)·k)
·
χ(k)
1
1
2
k∈Z,
k≡k0
(mod
d)
q
d
(
2
·k
+(iχ/n)·k)
·
(U|μd
)k
·
(χ(k)
+
k
)
·
{1
+
(smaller
powers
of
q)}
1
1
2
k∈KCrit
Thus,
if
ν
is
generically
zero,
then
it
follows
that
we
are
“in
the
exceptional
case,”
and
that
“χ(k)
+
k
”
is
zero.
In
this
case,
χ(k)
+
k
is
equal
(up
to
a
possible
factor
∈
μ∞
)
to
χ(d)
+
1.
Thus,
we
obtain:
χ(d)
=
−1
In
particular,
χ(d)2
=
1.
Now,
relative
to
the
notation
of
[HAT],
Chapter
V,
§4,
the
character
χ
may
be
identiﬁed
with
a
character
“χM
,”
and
“χM
”
is
related
to
another
character
χL
by:
χM
=
χL
·
χθ
(where
χθ
is
a
ﬁxed
character
which
is
independent
of
the
particulars
of
the
data
under
consideration).
Note
that
all
of
these
characters
are
characters
μn
×
Zet
→
μn
.
Next,
recall
that
χL
,
χM
(cf.
the
discussion
at
the
beginning
of
[HAT],
Chapter
V,
§4)
faithfully
capture
the
twist
induced
on
L
by
translation
by
η.
More
precisely,
If
d
is
odd
(respectively,
even),
then
the
order
of
χL
(respectively,
χM
)
restricted
to
μn
×
(d
·
Zet
)
is
equal
to
the
order
of
d
·
η,
i.e.,
to
m
.
(Here
the
factor
of
d
arises
since
the
discussion
of
[HAT],
Chapter
V,
concerns,
in
eﬀect,
degree
one
line
bundles
on
the
étale
quotient
E∞,S
→
E∞,S
/(Z/dZ),
relative
to
our
notation
in
the
present
discussion.)
Thus,
in
summary,
we
obtain
that
χM
2
|μn
×(d·Zet)
=
χL
2
|μn
×(d·Zet)
=
1
33
(where
we
use
the
fact
that
since
we
are
in
the
“exceptional
case”
(cf.
[HAT],
Chapter
VIII,
Lemma
4.3),
we
are
in
“Cases
I
or
II”
of
[HAT],
Chapter
V,
§4,
which
implies
that
the
restriction
of
χL
2
,
χM
2
to
μn
is
trivial).
Thus,
we
obtain
that:
2
·
(d
·
η)
=
1
i.e.,
that
m
=
2.
Also,
since
we
are
“in
the
exceptional
case”
(cf.
[HAT],
Chapter
VIII,
proof
of
Lemma
4.3),
it
follows
that
either
we
are
in
“Case
I”
(cf.
[HAT],
Chapter
V,
§4)
and
d
is
odd,
or
we
are
in
“Case
II”
(cf.
[HAT],
Chapter
V,
§4)
and
d
is
even.
Suppose
that
we
are
in
“Case
I”
(cf.
[HAT],
Chapter
V,
§4)
and
d
is
odd.
First,
observe
that
since
m
=
2
and
d
is
odd,
it
follows
that
we
may
assume
that
m
=
2.
Since
we
are
in
“Case
I,”
it
follows
that
χL
|μn
=
1.
Also,
since
d
is
odd,
and
n
=
4,
it
follows
(from
χ(d)
=
−1)
that
χM
2
|Zet
=
1
(but
χM
|Zet
=
1,
since
χM
(d)
=
χ(d)
=
−1),
hence
(by
the
explicit
description
of
χθ
in
[HAT],
Chapter
IV,
Theorem
2.1)
that
χM
|Zet
=
χθ
|Zet
,
so
χL
|Zet
=
1.
Thus,
we
obtain
that
χL
is
trivial.
But
since,
as
remarked
above,
the
order
of
χL
is
equal
to
m
,
we
thus
obtain
that
m
=
1,
which
is
absurd.
Thus,
we
conclude
that
the
hypothesis
that
ν
is
generically
zero
implies
that
we
are
in
“Case
II”
(cf.
[HAT],
Chapter
V,
§4);
that
d
is
even;
and
that
m
=
2.
I
claim
that
d
·
η
lies
in
G.
Indeed,
this
follows
from
the
fact
that
the
portion
of
χM
which
governs
the
“étale
portion”
of
d
·
η
(i.e.,
the
connected
component
of
the
special
ﬁber
of
E∞,S
in
which
d
·
η
lies),
namely,
χM
|μn
,
is
trivial
(since
we
are
in
“Case
II”).
Thus,
the
image
in
the
special
of
E∞,S
of
the
point
d
·
η
lies
in
the
connected
component
of
the
identity,
so
d
·
η
∈
G
(recall
that
we
have
assumed
in
this
discussion
that
G
is
“of
multiplicative
type”!),
as
claimed.
This
completes
the
proof
of
the
assertion
that
if
ν
is
generically
zero,
then
our
data
is
of
null
type.
Thus,
it
remains
to
show
that:
if
our
data
is
of
null
type,
then
ν
is
generically
zero.
But
this
follows
immediately
from
substitution
into
the
explicit
expression
for
Θμ
given
above
(i.e.,
one
uses
the
fact
that
χ(−)
of
any
odd
multiple
of
d
is
equal
to
−1
to
show
d
that
the
coeﬃcient
of
(U|μd
)
2
vanishes).
This
completes
the
proof
of
Proposition
6.2.

§7.
Some
Elementary
Computational
Lemmas
In
the
following
discussion,
we
assume
that
we
are
given
a
ﬁnite
collection
p1
,
p2
,
.
.
.
,
pr
(where
r
≥
1)
of
(distinct)
prime
numbers,
together
with
a
collection
of
positive
integers
e1
,
e2
,
.
.
.
,
er
.
Write
34
def
d
=
pe11
·
pe22
·
.
.
.
·
perr
If
A
⊆
{1,
2,
.
.
.
,
r}
is
a
nonempty
subset,
let
us
write
F
(A)
for
the
set
of
functions
ψ
:
A
→
Z
(whose
value
at
j
∈
A
we
write
ψj
)
such
that
for
each
j
∈
A,
we
have
1
≤
ψj
≤
ej
.
Lemma
7.1.
We
have:


d−1=
A⊆{1,...,r}
{(

2ψ
pj
j
)
−
1}·
j∈A
ψ∈F
(A)

(
j
∈A
pj
)
r
/
{
j=1
(pj
+
1)}

−ψ
pj
j
·
(pj
−
1
+
δψj
,ej
)
·
j∈A
where
δx,y
is
1
if
x
=
y
and
0
otherwise.
Proof.
It
is
immediate
that
it
is
equivalent
to
verify:
(pe11
·
.
.
.
·
perr
−
1)
·

∅=A⊆{1,...,r}
r

(pj
+
1)
=
j=1
(


pj
)
·
j
∈A
/
{(

2ψ
pj
j
)
−
1}
·
j∈A
ψ∈F
(A)

−ψj
pj
·
(pj
−
1
+
δψj
,ej
)
j∈A
Let
us
ﬁrst
ﬁx
A,
and
consider
the
sum
over
ψ
∈
F
(A).
This
sum
may
be
thought
of
as

2ψ
consisting
of
two
sums,
corresponding
to
the
two
terms
“
j∈A
pj
j
”
and
“−1.”
The
ﬁrst
sum
may
be
evaluated
as
follows:

ψ∈F
(A)
{
2ψ



ψ∈F
(A)
j∈A

j∈A
=
=
=
pj
j
}
·
·
(pj
−
1
+
δψj
,ej
)
j∈A
ψ
pj
j
·
(pj
−
1
+
δψj
,ej
)

ej

j∈A
ψj
=1

(pj
j
−
1)
e
+1
pj
(pj
−
1)
·
+
pj
j
(pj
−
1)

e
e
+1
pj
j
−
pj
+
pj
j
=
Ψj
j∈A
=
−ψj
pj

ψ
pj
j
·
(pj
−
1
+
δψj
,ej
)
e
−1
j∈A
j∈A
35
def
e
+1
e
where
we
write
Ψj
=
pj
j
−
pj
+
pj
j


ψ∈F
(A)
j∈A
−
−ψj
pj
.
On
the
other
hand,
·
(pj
−
1
+
δψj
,ej
)

ej

j∈A
ψj
=1
=−
·
(pj
−
1
+
δψj
,ej
)
−e
+1

=−
−ψj
pj
p−1
j
·
(pj
−
1)
·
(1
−
pj
j
)
−e
+1
=
−1
(1
−
p−1
j
)
j∈A

=−
−e
+1
(1
−
pj
j
)
+
pj
j
−e
+1
+
pj
j
j∈A
Thus,
in
summary,
it
suﬃces
to
show
that:
(pe11
·
.
.
.
·
perr
−
1)
·
r


(pj
+
1)
=
(
∅=A⊆{1,...,r}
j=1

pj
)
·

j
∈A
/
Ψj
−
1
j∈A
To
do
this,
we
use
induction
on
r.
The
result
is
clear
for
r
=
1.
Thus,
let
us
prove
it
for
r
≥
2,
assuming
the
result
known
for
strictly
smaller
r.
First,
let
us
note
that
the
above
sum
over
A
=
∅
may
be
split
into
three
sums:
the
ﬁrst
(respectively,
second;
third)
corresponding
to
the
case
where
A
=
{1}
(respectively,
1
∈
A
(but
A
=
{1});
1
∈
/
A).
Note
that
there
is
a
natural
bijective
correspondence
between
the
second
and
third
types
of
A
given
by
appending/deleting
the
element
“1.”
Thus,
we
obtain:

(
∅=A⊆{1,...,r}
=−

pj
)
·

j
∈A
/
Ψj
−
1
j∈A

(


pj
)
+
(
∅=A⊆{1,...,r}
j
∈A
/
∅=A⊆{1,...,r}


r

=−
(
∅=A⊆{1,...,r}
+

pj
)
+
(
j
∈A
/
1∈A⊆{1,...,r},
|A|≥2
(

j
∈A
/
j=2
pj
)
·

j
∈A
/

pj
)
·
Ψj
j∈A
pj
)
·
Ψ1

j∈A
36
Ψj
+

∅=A
⊆{2,...,r}
(

j
∈A
/

pj
)
·

j∈A
Ψj

=−
(
∅=A⊆{1,...,r}

+

j
∈A
/

A⊆{1,...,r}
(

j=2
pj
)
·
(Ψ1
+
p1
)
·
pj
)
+
(
j
∈A
/
r

(pj
+
1)
+
(
j=1
(

Ψj

pj
)
·
Ψj
j∈A
1=j
∈A
/

pj
)
·
pe11
·
(p1
+
1)
j=2

+
(p1
+
1)
·
pe11
·

pj
)
·
pe11
·
(p1
+
1)
j=2

r

pj
)
·
pe11
·
(p1
+
1)
j∈A
∅=A
⊆{2,...,r}
=−
r

1=j
∈A
/

+
(p1
+
1)
·
pe11
·
r

pj
)
+
(
j=1

(
∅=A
⊆{2,...,r}
=−
pj
)
−
(
r

(
∅=A
⊆{2,...,r}


pj
)
·
Ψj
j∈A
1=j
∈A
/

Next,
let
us
write
d
=
pe22
·
.
.
.
·
perr
def
so
d
=
pe11
·
d
.
Then
we
have
(d
−
1)
·
r

(pj
+
1)
=
(d
−
pe11
+
pe11
−
1)
·
j=1
r

(pj
+
1)
j=1
=
pe11
(d
−
1)
·
r

(pj
+
1)
+
(pe11
−
1)
·
j=1
r

(pj
+
1)
j=1
Thus,
by
dividing
by
(p1
+
1),
we
see
that
it
suﬃces
to
show
that:
(pe11
−
1)
·
=−
r

(pj
+
1)
+
pe11
(d
−
1)
·
j=2
r

j=2
r

(pj
+
1)
j=2
(pj
+
1)
r

e1
+
p1
·
(
j=2
pj
)
+
pe11
·

∅=A
⊆{2,...,r}
But
by
the
induction
hypothesis
on
r,
we
have
37
(

1=j
∈A
/

pj
)
·

j∈A
Ψj
−
r

r

e1
+
p1
·
(
j=2
(pj
+
1)
j=2
=−
r

(pj
+
1)
j=2
r

e1
+
p1
·
(
j=2
=−
(pj
+
1)
+
pe11
·
j=2
=
(pe11
−
1)
·
r


(
∅=A
⊆{2,...,r}
+
pe11
·
(d
−
1)
·
r


pj
)
+
pe11
·
pj
)
·
(
∅=A
⊆{2,...,r}
(pj
+
1)

pj
)
1=j
∈A
/

(pj
+
1)
j=2
r

(pj
+
1)
+
pe11
·
(d
−
1)
·
j=2
r

Ψj
j∈A
1=j
∈A
/


pj
)
+
pe11
·

r

(pj
+
1)
j=2
+
pe11
·
(d
−
1)
·
j=2
r

(pj
+
1)
j=2
as
desired.
This
completes
the
proof
of
Lemma
7.1.

Next,
we
shift
gears
and
write
S1
for
the
unit
circle
R/Z,
equipped
with
the
standard
coordinate
θ
(arising
from
the
standard
coordinate
on
R).
Write
f
:
S1
→
R
for
the
unique
continuous,
piecewise
linear
function
on
S1
which
is
linear
except
at
θ
=
0,
12
,
and
satisﬁes:
1
f(
)
=
−1
2
f(0)
=
+1;
Note
that
f
satisﬁes
the
property:
1
f(θ
+
)
=
−f(θ)
2
df
df
and
that
dθ
=
−4
for
θ
∈
[0,
12
]
and
dθ
=
4
for
θ
∈
[
21
,
1].
Next,
let
us
deﬁne,
for
N
a
positive
integer:
def
Φ(N)
=
N
·
N
−1

f(
i=0
def
i
)∈R
N
and
(by
induction
on
N
,
starting
with
Φexact
(1)
=
Φ(1))
38

def
Φexact
(N)
=
Φ(N)
−
Φexact
(a)
a|N,
a<N
where
in
the
sum,
a
ranges
over
all
positive
integers
<
N
which
divide
N
.
In
the
following,
we
would
like
to
compute
Φ(N)
and
Φexact
(N)
explicitly.
Lemma
7.2.
If
N
is
an
odd
positive
integer,
then
Φ(N)
=
1.
If
N
is
an
even
positive
integer,
then
Φ(N)
=
0.
Proof.
First,
assume
that
N
is
odd.
Write
def
(S1
)
=
S1
/(
1
Z/Z)
N
for
the
quotient
of
S1
by
the
subgroup
N1
Z/Z
⊆
S1
.
Thus,
(S1
)
is
also
naturally
isomorphic
to
a
copy
of
S1
.
Write
θ
for
the
standard
coordinate
on
(S1
)
.
Thus,
θ
=
N
·
θ.
Let
def

g(θ
)
=
N
−1

f(θ
+
i=0
i
)
N
for
the
“push-forward”
of
f
to
(S1
)
.
(Thus,
g
:
(S1
)
→
R.)
Note
that
g
is
itself
continuous
and
piecewise
linear
on
(S1
)
.
Moreover,


f=
g=0
S1
(S1
)
Finally,
the
derivative
of
g
for
“generic”
(i.e.,
all
but
ﬁnitely
many
exceptional
values)
θ
may
be
computed
as
follows:

df
i
dg
dg

(θ
)
=
N
·

(θ
)
=
(
)(θ
+
)
dθ
dθ
dθ
N
N
−1
i=0
=4·
N
−1

χ[
12
,1]
(θ
+
i=0
i
i
)
−
χ[0,
12
]
(θ
+
)
N
N
=
4
·
{χ[
12
,1]
(θ
)
−
χ[0,
12
]
(θ
)}
where
(for
an
interval
[a,
b]
⊆
R)
χ[a,b]
denotes
the
indicator
function
on
this
interval
(i.e.,
it
is
=
1
on
[a,
b]
and
=
0
outside
of
[a,
b]),
and,
in
the
ﬁnal
equality,
we
make
essential
use
of
the
fact
that
N
is
odd.
39
But
note
that
these
properties
imply
that
N
·
g
on
(S1
)
“looks
just
like”
f
on
S1
.
Thus,
in
particular,
it
follows
that
Φ(N)
=
N
·
g(0)
=
f(0)
=
1
as
desired.
Now
assume
that
N
is
even.
Then
observe
that
Φ(N)
is
deﬁned
as
(essentially)
the
sum
of
the
values
of
the
function
f
over
a
certain
ﬁnite
set
of
points
of
S1
.
Moreover,
since
N
is
even,
it
follows
that
this
set
is
invariant
with
respect
to
the
automorphism
of
S1
given
by
θ
→
θ
+
12
.
Since
f(θ
+
12
)
=
−f(θ),
we
thus
obtain
Φ(N)
=
0,
as
desired.

Lemma
7.3.
We
have:
Φexact
(1)
=
1,
Φexact
(2)
=
−1.
Moreover,
if
N
is
any
positive
integer
=
1,
2,
then
Φexact
(N)
=
0.
Proof.
By
deﬁnition
Φexact
(1)
=
Φ(1)
=
1,
and
Φexact
(2)
=
Φ(2)
−
Φ(1)
=
0
−
1
(by
Lemma
7.2).
The
ﬁnal
assertion
is
proven
by
induction
on
N
.
This
assertion
is
vacuous
for
N
=
1,
2.
Thus,
assume
that
N
≥
3,
and
that
the
assertion
in
question
is
known
for
strictly
smaller
N
.
We
begin
with
the
case
of
N
odd.
In
this
case,
2
does
not
divide
N
,
so,
by
the
induction
hypothesis,
we
obtain
(from
the
deﬁnition
of
Φexact
(N)):
Φexact
(N)
=
Φ(N)
−
Φ(1)
=
1
−
1
=
0
(by
Lemma
7.2).
This
completes
the
case
when
N
is
odd.
Now
assume
that
N
is
even.
In
this
case,
for
all
a
as
in
the
sum
appearing
in
the
deﬁnition
of
Φexact
(N),
we
have
Φexact
(a)
=
0,
unless
a
=
1,
2.
Moreover,
in
this
case,
a
=
1,
2
both
appear,
so
we
get:
Φexact
(N)
=
Φ(N)
−
{Φexact
(1)
+
Φexact
(2)}
=
0
−
{1
−
1}
=
0
(by
Lemma
7.2),
as
desired.

§8.
The
Various
Contributions
at
Inﬁnity
In
this
§,
we
piece
together
the
results
of
§5,
6,
and
7,
to
obtain
the
main
result
of
this
paper
concerning
degrees.
This
result
concerning
degrees
is
the
main
technical
result
underlying
the
theory
of
this
paper.
In
particular,
the
theorems
of
§9,
10,
below,
will
essentially
be
formal
consequences
of
this
result
concerning
degrees.
40
The
main
point
is
that
the
various
computations
performed
in
§5,
6,
and
7
are
suﬃcient
to
compute
the
total
degree
of
vanishing
of
the
norm
ν
of
§3,
as
follows.
In
this
§,
we
use
the
notation
of
the
latter
part
of
§3
(i.e.,
we
assume
that
S
is
a
curve
in
characteristic
0).
As
usual,
degrees
will
always
be
expressed
in
log(q)
units.
The
total
degree
of
vanishing
of
ν
will
be
a
weighted
sum/average
over
all
the
possibilities
for
H
(the
Lagrangian
subgroup)
and
G
(the
restriction
subgroup).
In
the
following
discussion,
we
shall
write
(cf.
§7)
def
d
=
pe11
·
pe22
·
.
.
.
·
perr
(where
p1
,
.
.
.
,
pr
are
distinct
prime
numbers;
and
e1
,
.
.
.
,
er
are
positive
integers).
First,
let
us
observe
that
the
estimate
(from
below)
for
deg(ν)
in
Theorem
5.1
(as
a
function
of
G,
H)
depends
only
on
heﬀ
.
For
a
given
G,
H,
we
shall
refer
to
the
primes
μ
that
divide
heﬀ
=
|ImE∞
,S
(Get
)
μd
|
(cf.
Theorem
5.1)
as
active
primes.
Thus,
the
set
μ
of
active
primes
forms
a
subset
A
⊆
{1,
.
.
.
,
r}
For
each
active
prime
pj
,
the
pj
-primary
part
of
the
resulting
heﬀ
(cf.
§5)
is
equal
to
some
ψ
pj
j
.
Thus,
we
obtain
a
function
ψ:A→Z
given
by
j
→
ψj
,
and
(by
deﬁnition)
we
have:
heﬀ
=

ψ
pj
j
j∈A
Next,
let
us
observe
that
the
probability
that,
at
a
given
point
at
inﬁnity,
the
pj
ψ
primary
part
of
heﬀ
has
order
pj
j
for
all
j
∈
A,
and
order
1
for
all
j
∈
/
A,
is
given
by:


pj
−
1
+
δψj
,ej
ψ
j∈A
(pj
+
1)pj
j
·


pj
pj
+
1
j
∈A
/
Indeed,
clearly
what
happens
for
one
pj
is
independent
of
what
happens
for
the
other
pj
’s.
Thus,
the
probability
in
question
is
equal
to
the
product
of
the
probabilities
for
each
individual
pj
.
On
the
other
hand,
to
compute
the
probability
for
a
given
pj
,
we
make
use
of
the
following
lemma
(where
we
think
of
“M”
as
the
module
of
d-torsion
points
in
the
Tate
curve;
“(Z/pe
Z)
⊕
0”
as
the
submodule
deﬁned
by
“μpej
”;
“N
”
as
the
submodule
j
deﬁned
by
the
restriction
subgroup
G;
“p”
as
pj
;
“e”
as
ej
;
and
“e
”
as
ψj
):
41
Lemma
8.1.
Let
p
be
a
prime
number,
and
e,
e
positive
integers
such
that
e
≤
e.
def
Write
M
=
(Z/pe
Z)
⊕
(Z/pe
Z).
Then
the
fraction
of
rank
one
free
Z/pe
Z-submodules


N
⊆
M
which
are
equal
to
the
module
(Z/pe
Z)
⊕
0
modulo
pe
but
not
modulo
pe
+1
(if
e
<
e)
is
given
by:
p
−
1
+
δe
,e
(p
+
1)pe
On
the
other
hand,
the
fraction
of
rank
one
free
Z/pe
Z-submodules
N
⊆
M
which
are
not
p
equal
to
the
module
(Z/pe
Z)
⊕
0
modulo
p
is
given
by
p+1
.
Proof.
Indeed,
the
computation
of
the
second
fraction
is
immediate,
so
let
us
concentrate
on
the
computation
of
the
ﬁrst
fraction.
First
of
all,
the
fraction
of
rank
one
free
Z/pe
Zsubmodules
N
⊆
M
which
are
equal
to
the
module
(Z/pe
Z)
⊕
0
modulo
p
is
given
by
1
p+1
Such
N
admit
a
unique
generator
of
the
form
γ
=
(1,
aγ
),
where
aγ
∈
pZ/pe
Z.
Thus,
the
1
ﬁrst
fraction
in
the
statement
of
Lemma
8.1
is
equal
to
p+1
times
the
fraction
of
aγ
which


are
≡
0
modulo
pe
but
not
modulo
pe
+1
(if
e
<
e).
The
fraction
of
such
aγ
is
given
by:




pe−e
−
pe−e
−1
|pe
Z/pe
Z|
−
|pe
+1
Z/pe
Z|
=
|pZ/pe
Z|
pe−1

pe−e
(1
−
p−1
)
=
pe−1


p−e
(1
−
p−1
)
=
=
p−e
(p
−
1)
−1
p
if
e
<
e,
and



|pe
Z/pe
Z|
pe−e
=
p1−e
=
e
e−1
|pZ/p
Z|
p
1
if
e
=
e.
Thus,
multiplying
by
p+1
gives
the
desired
result.

Now
let
us
recall
the
estimate
(for
a
ﬁxed
G,
H)
of
Theorem
5.1:
Avgη
(deg(ν))
≥
(d/heﬀ
)
·
Z

(d,
heﬀ
,
m
)
On
the
other
hand,
Z

(d,
heﬀ
,
m
)
has
been
computed
in
Proposition
3.3.
Note,
moreover,
that
by
Lemma
7.3,
the
“φ1
(−)”
term
in
the
expressions
of
Proposition
3.3
vanishes
if
42
d
is
odd
or
m
=
2.
(Indeed,
up
to
a
nonzero
factor,
one
computes
that
the
diﬀerences
φ1
(θ
+
12
)
−
φ1
(θ)
are
equal
(as
functions
on
S1
)
to
the
function
“f”
studied
in
the
latter
portion
of
§7.
Thus,
the
asserted
vanishing
follows
from
the
equality
Φexact
(m
)
=
0
proven
in
Lemma
7.3.)
Thus,
in
the
following,
we
shall
assume
ﬁrst
that
either
d
is
odd,
or
(if
d
is
even,
then)
m
=
2.
We
will
return
later
to
the
exceptional
case
where
d
is
even
and
m
=
2.
Thus,
under
the
present
assumptions
on
d
and
m
,
we
obtain
(by
Proposition
3.3):
(d/heﬀ
)
·
Z

(d,
heﬀ
,
m
)
=
1
((heﬀ
)2
−
1)
24
(where
we
omit
the
“log(q)”
since
we
will
always
work
in
log(q)
units).
Thus,
substituting
the
expression
for
heﬀ
given
above,
and
then
taking
the
weighted
sum
(relative
to
the
probabilities
for
various
types
of
G,
H
computed
above),
we
obtain
the
following
estimate
for
the
total
degree
of
vanishing
degtot
(ν)
of
the
norm
ν
at
the
various
points
at
inﬁnity
of
S:
degtot
(ν)
≥


A⊆{1,...,r}
ψ∈F
(A)
1

2ψj
pj
)
−
1}·
{(
24
j∈A


pj
−
1
+
δψj
,ej
ψ
j∈A
(pj
+
1)pj
j
·


pj
pj
+
1
j
∈A
/
1
(d
−
1)
24
=
deg(M⊗d
⊗
K⊗d
)
−
d
·
[L
·
e]
=
=
deg(M⊗d
⊗
K⊗d
)
where
in
the
ﬁrst
equality
(respectively,
second;
third),
we
apply
Lemma
7.1
(respectively,
Proposition
3.2;
Proposition
3.2
and
the
above
discussion
concerning
φ1
(−)).
On
the
other
hand,
since
ν
is,
by
deﬁnition,
a
section
of
the
line
bundle
M⊗d
⊗
K⊗d
(cf.
§3),
we
thus
conclude
that
all
the
zeroes
of
ν
have
been
accounted
for
in
the
estimates
of
Theorem
5.1,
i.e.,
that
(under
the
assumption
that
d
is
odd
or
m
=
2):
The
norm
ν
is
invertible
away
from
the
points
at
inﬁnity,
and,
moreover,
the
inequalities
of
Theorem
5.1
are
all
equalities.
Note
that
we
make
use
here
of
the
fact
that
(since
d
is
odd
or
m
=
2)
ν
is
nonzero
on
a
dense
open
subset
of
S,
by
Proposition
6.2.
It
remains
to
examine
the
case
where
d
is
even,
and
m
=
2.
By
the
theory
of
§6,
if
our
data
is
of
null
type
(cf.
Deﬁnition
6.1),
then
ν
will
be
generically
zero
(cf.
Proposition
6.2).
Thus,
we
assume
that
our
data
is
of
general
type
(cf.
Deﬁnition
6.1).
Note
that
the
43
estimate
from
below
for
degtot
(ν)
will
essentially
be
the
same
as
before,
except
that
we
obtain
an
additional
term
(cf.
Proposition
3.3)
1
−φ1
(−d
·
ηι
+
)
+
φ1
(−d
·
ηι
)
2
at
those
points
at
inﬁnity
ι
where
2
is
an
active
prime
(i.e.,
2
∈
A).
Note
that
here,
since
we
are
not
summing
over
all
ι,
but
only
certain
special
ι,
it
is
important
that
we
keep
both
of
the
two
terms
“φ1
(−)”
in
the
above
expression
(i.e.,
it
is
not
the
same,
in
this
case,
to
just
compute
the
sum
of
the
−φ1
(−d
·
ηι
+
12
)
over
the
speciﬁc
ι
in
question)
—
cf.
the
computations
of
[HAT],
Chapter
VI,
proof
of
Theorem
3.1,
in
the
even
case.
1
=
13
.
Moreover,
at
such
ι,
we
have:
Next,
note
that
the
probability
that
2
∈
A
is
2+1
d
·
ηι
∈
/
G
(since
our
data
is
of
general
type).
But
the
fact
that
2
∈
A
implies
that
2
G
=
μ2
,
so
we
thus
obtain
that
at
such
ι,
d
·
ηι
=
12
.
Thus,
the
net
contribution
to
the
estimate
from
below
for
degtot
(ν)
is:
1
1
1
1
1
1
1
1
1
1
(−φ1
(−
+
)
+
φ1
(−
))
=
(−φ1
(0)
+
φ1
(−
))
=
(−
−
)
=
−
3
2
2
2
3
2
3
12
24
24
Let
us
refer
to
this
contribution
as
the
ﬁrst
new
contribution.
On
the
other
hand,
in
the
present
context
(where
d
is
even
and
m
=
2),
the
degree
1
(d
−
1),
since
−d
·
[L
·
e]
is
of
the
line
bundle
deg(M⊗d
⊗
K⊗d
)
is
no
longer
equal
to
24
not
necessarily
zero
(cf.
Proposition
3.2).
The
resulting
contribution
of
this
new
term
—
which
we
shall
refer
to
as
the
second
new
contribution
—
is
given
by:
−d
·
[L
·
e]
=

ι
2
1
1
1
1
1
φ1
(−d
·
ηι
+
)
=
φ1
(−
+
)
+
φ1
(0
+
)
2
3
2
2
3
2
2
1
1
1
1
2
1
1
−
·
=
=
φ1
(0)
+
φ1
(
)
=
·
3
3
2
3
12
3
24
24
where
we
note
the
following:
(1)
In
the
ﬁrst
equality,
since
this
time
we
are
summing
over
all
points
at
inﬁnity
ι,
we
are
free
to
use
just
the
single
term
“φ1
(−d
·
ηι
+
12
)”
(instead
of
the
diﬀerence
“φ1
(−d
·
ηι
+
12
)
−
φ1
(−d
·
ηι
)”).
(2)
In
the
second
equality,
we
use
the
fact
that
the
probability
that
d·ηι
=
12
(respectively,
d
·
ηι
=
0)
is
23
(respectively,
13
)
—
cf.
Lemma
8.1
in
the
case
p
=
2.
Note,
in
particular,
that
the
ﬁrst
and
second
new
contributions
cancel
one
another
out
in
our
estimate
from
below
for
degtot
(ν).
Thus,
by
the
same
reasoning
as
in
the
case
where
44
d
is
odd
or
m
=
2,
we
conclude
the
following
result,
which
is
the
main
technical
result
of
this
paper:
Theorem
8.2.
If
the
given
data
(i.e.,
d,
m
,
and
η)
are
of
general
type
(cf.
Deﬁnition
6.1),
then
the
norm
ν
of
§3
is
invertible
away
from
the
points
at
inﬁnity,
and,
moreover,
the
inequalities
of
Theorem
5.1
are
all
equalities.
If
the
given
data
(i.e.,
d,
m
,
and
η)
are
of
null
type
(cf.
Deﬁnition
6.1),
then
the
norm
ν
of
§3
is
identically
zero.
§9.
The
Main
Theorem
So
far,
our
discussion
has
mainly
been
in
characteristic
zero.
In
this
present
§,
we
observe
that
what
we
have
done
so
far
extends
immediately
to
mixed
characteristic.
This
observation
allows
us
to
state
and
prove
the
main
theorem
of
this
paper,
concerning
the
invertibility
of
the
coeﬃcients
of
the
Fourier
transform
of
an
algebraic
theta
function
in
mixed
characteristic.
Our
notation
is
as
at
the
beginning
of
§3.
To
review
(cf.
§3
for
more
details):
S
log
is
a
Z-ﬂat
ﬁne
noetherian
log
scheme;
C
log
→
S
log
is
a
log
elliptic
curve
which
is
smooth
over
a
schematically
dense
open
subscheme
of
S,
hence
deﬁnes
a
“divisor
at
inﬁnity”
(i.e.,
the
pull-back
via
the
associated
classifying
morphism
of
the
divisor
at
inﬁnity
of
(M1,0
)Z
)
D
⊆
S.
Moreover,
we
have
a
stack
S∞
obtained
from
S
by
adjoining
the
roots
of
the
q-parameters
at
the
locus
D
⊆
S
over
which
C
log
→
S
log
degenerates,
together
with
a
smooth
group
scheme
f
:
E∞,S
→
S∞
(which
is
useful
for
carrying
out
the
constructions
of
[Zh]).
Let
m,
d
be
positive
integers
such
that
m
does
not
divide
d,
and
η
∈
E∞,S
(S∞
)
be
a
torsion
point
of
order
m.
Then
η
deﬁnes
a
certain
natural
metrized
line
bundle
L
which
ev
—
in
the
notation
of
[HAT],
Chapter
V,
§1
—
is
equal
to
Lst,η
(respectively,
Lst,η
)
if
d
is
odd
(respectively,
even).
The
push-forward
f∗
L
of
this
metrized
line
bundle
to
S∞
deﬁnes
a
metrized
vector
bundle
on
S∞,
equipped
with
the
action
of
a
certain
natural
theta
group
scheme
GL
(cf.
[HAT],
Chapter
IV,
§5).
Next,
we
assume
that
we
are
given
ﬁnite,
ﬂat
(i.e.,
over
S∞
)
subgroup
schemes
G,
H
⊆
E∞,S
which
are
étale
locally
isomorphic
to
Z/dZ
in
characteristic
0
(i.e.,
after
tensoring
with
Q),
and
which
satisfy
H
×
G
=
d
E∞,S
⊆
E∞,S
.
(where
d
E∞,S
is
the
kernel
of
multiplication
by
d
on
E∞,S
).
We
shall
refer
to
G
as
the
restriction
subgroup
(since
its
principal
use
will
be
as
a
collection
of
points
to
which
we
will
restrict
sections
of
L),
and
H
as
the
Lagrangian
subgroup
(since
its
primary
use
will
be
to
descend
L).
When
d
is
even,
we
also
assume
that
we
are
given
splittings
Gspl
,
Hspl
of
certain
natural
surjections

→
G,
H

→
H
(cf.
§3
for
more
details).
With
this
data,
we
obtain
(regardless
of
the
G
parity
of
d)
liftings
G,
H
⊆
GL
of
G,
H
⊆
d
E∞,S
.
Using
H
⊆
GL
,
we
may
descend
L
to
a
def
line
bundle
LH
on
E∞H
,S
=
E∞,S
/H.
45
We
are
now
ready
to
give
the
ﬁrst
main
result
of
this
paper:
Theorem
9.1.
(Invertibility
of
the
Coeﬃcients
of
the
Fourier
Transform
of
an
Algebraic
Theta
Function)
Suppose
that
we
are
given
C
log
→
S
log
,
m,
d,
η,
G,
Gspl
,
H,
and
Hspl
,
as
above.
Let
us
regard
the
Fourier
expansion
morphism
E
:
(fH
)∗
LH
→
OG

⊗OS∞
K
def
(where
K
=
L|e
is
the
restriction
of
L
to
the
identity
section
e
of
E∞,S
)
for
the
algebraic
theta
functions
obtained
by
restricting
global
sections
of
LH
to
G
as
a
“section”
of
the
OS∞
-algebra
OG

which
is
well-deﬁned
up
to
scalar
multiples.
If
our
data
is
of
null
type
(a
condition
on
d,
m,
η,
and
G
—
cf.
Deﬁnition
6.1),
then
the
norm
ν
of
E
is
generically
zero.
If
our
data
is
of
general
type
(a
condition
on
d,
m,
η,
and
G
—
cf.
Deﬁnition
6.1),
then
E
satisﬁes
the
following
invertibility
properties:
def
(1)
E
is
invertible
over
(US
)Q
(where
US
=
S
−
D;
the
subscripted
Q
denotes
“⊗ZQ”).
(2)
Let
ι
∈
D
be
a
point
at
inﬁnity.
Let
def
hμ
=
|H
μd
|;
def
het
=
d/hμ
;
def
heﬀ
=
|ImE∞
μ
,S
(Get
)
μ
μd
|;
def
hord
=
het
/heﬀ
be
the
local
invariants
at
ι
deﬁned
in
§5.
Then
in
a
neighborhood
of
ι,
the
endomorphisms
of
the
OS∞
-algebra
OG

deﬁned
by
multiplying
by
local
generators
of
the
image
of
E
may
be
written
(for
an
appropriate
basis)
as
diagonal
matrices
whose
diagonal
entries
are
of
the
form
d
·

·
hord
−
2
·
ω
·
q
d
·cRem(j,heff
)
(Case
Xι
)
·
(a
unit
≡
1
modulo
q
(>0)
)
1
1
√
where

is
a
4-th
root
of
unity
(respectively,
2
times
an
8-th
root
of
unity)
if
hord
is
odd
(respectively,
even);
ω
is
a
sum
of
either
one
or
two
elements
of
μn·hμ
·hord
(in
fact,
in
all
but
one
exceptional
case,
ω
∈
μn·hμ
·hord
);
the
notation
cj
(Case
Xι
)
is
as
in
§3
(cf.
[HAT],
Chapter
V,
§4,
for
more
details);
j
ranges
from
1
to
d;
and
Rem(j,
heﬀ
)
denotes
the
unique
positive
integer
≤
heﬀ
which
is
≡
j
modulo
heﬀ
.
Proof.
The
statement
of
Theorem
9.1
is
essentially
an
amalgamation
of
Theorems
5.2
and
Theorem
8.2.
Note,
in
(2),
that
the
extra
factor
of
d
(relative
to
the
expressions
in
Theorem
5.2)
arises
from
the
fact
that
when
we
take
Fourier
expansions
(i.e.,
apply
the
operator
F
of
§1),
the
coeﬃcients
of
the
various
characters
of
G
get
multiplied
by
d.
Also,
46
we
observe
that
although
our
computations
in
§4,
5,
were
in
a
characteristic
0
setting,
the
assertions
of
(2)
still
hold,
since
the
various
bases
of
function
spaces
—
i.e.,
in
essence,
q-expansions
—
that
were
used
in
§4,
5,
all
still
form
bases
of
the
corresponding
mixed
characterstic
spaces
—
cf.,
e.g.,
[HAT],
Chapter
IV,
§2,3,
where
everything
is
done
in
mixed
characteristic.
This
completes
the
proof.

Remark.
The
invertibility
of
the
coeﬃcients
of
the
Fourier
expansion
of
an
algebraic
theta
function
may
be
interpreted
as
the
statement
that
certain
modular
functions
are,
in
fact,
modular
units.
It
would
thus
be
interesting
to
consider
the
meaning
of
Theorem
9.1
from
the
point
of
view
of
the
theory
of
modular
units,
e.g.,
to
see
if
one
can
write
these
new
modular
units
explicitly
in
terms
of
classical
modular
units
such
as
the
Siegel
modular
units
(cf.,
for
instance,
[KL],
Chapter
4).
§10.
The
Theta
Convolution
We
maintain
the
notation
of
§9.
In
this
§,
we
apply
Theorem
9.1
to
study
a
morphism
which
we
call
the
theta
convolution.
This
morphism
is
(essentially)
the
endomorphism
of
the
space
of
functions
on
the
restriction
subgroup
G
given
by
convoluting
with
the
algebraic
theta
function
in
question.
In
particular,
we
observe
that
the
theory
of
the
present
paper
implies
that
this
theta
convolution
satisﬁes
certain
compatibility
properties
relative
to
the
evaluation
morphism
studied
in
[HAT].
In
this
§,
let
us
write
ΘCV
:
M−1
⊗
OG
→
OG
⊗
K
def
def
(where
all
tensor
products
are
over
OS∞
;
M
=
{(fH
)∗
LH
}−1
;
K
=
L|e
;
e
∈
E∞,S
(S∞
)
is
the
identity
section)
for
the
morphism
deﬁned
as
follows:
First,
recall
that
restricting
sections
of
LH
to
G
deﬁnes
a
morphism
M−1
→
L|G
∼
=
OG
⊗
K
On
the
other
hand,
the
convolution
operator
∗
(cf.
§1)
deﬁnes
a
morphism
OG
⊗
OG
→
OG
Thus,
if
we
compose
this
convolution
morphism
(tensored
with
K)
with
the
restriction
morphism
M−1
→
OG
⊗
K
(tensored
with
OG
),
we
get
a
morphism
ΘCV
as
above.
This
morphism
will
be
referred
to
as
the
theta
convolution.
By
Proposition
1.1,
(iii.),
and
Theorem
9.1,
(1),
it
follows
that
ΘCV
is
invertible
over
(US
)Q
.
Since
ΘCV
is
generically
invertible,
we
thus
obtain
that
the
image
of
ΘCV
in
OG
⊗
K
∼
=
L|G
,
which
we
denote
by
47
L|Θ
G
⊆
L|G
is
a
metrized
vector
bundle
on
S∞
which
satisﬁes
∼
−1
⊗
OG
L|Θ
G
=M
Note,
moreover,
that
the
inclusion
L|Θ
G
⊆
L|G
is
an
isomorphism
over
(US
)Q
.
On
the
other
hand,
let
us
recall
the
object
†
E∞,[d]
of
[HAT],
Chapter
V,
§2.
Over
(US
)Q
,
this
object
is
isomorphic
to
the
universal
extension
of
the
elliptic
curve
E|(US
)Q
→
(US
)Q
under
consideration.
Thus,
in
general,
one
may
†
think
of
E∞,[d]
as
a
certain
extension
of
this
universal
extension
over
the
divisor
at
inﬁnity
and
the
points
of
positive
characteristic.
Let
us
write
f∗
(L|
†
E∞,[d]
)<d
{et}
†
for
the
push-forward
consisting
of
sections
of
L
over
E∞,[d]
whose
torsorial
degree
(i.e.,
†
relative
degree
for
the
morphism
E∞,[d]
→
E∞,S
)
is
<
d,
equipped
with
the
étale-integral
structure
(cf.
[HAT],
Chapter
V,
§3)
at
the
ﬁnite
primes.
Note
that
this
push-forward
forms
a
metrized
vector
bundle
on
S∞
of
rank
d2
.
Since
we
are
given
a
subgroup
scheme
H
∼
=
H
⊆
GL
,
we
thus
obtain
a
natural
action
of
H
on
this
push-forward.
Let
us
denote
by
f∗
(L|
†
E∞,[d]
)<d
{et}H
the
metrized
vector
bundle
on
S∞
of
rank
d
consisting
of
sections
that
are
ﬁxed
by
H.
Then
it
follows
from
[HAT],
Chapter
VI,
Theorem
3.1,
(1),
(2),
that
we
have
a
natural
evaluation
map
ΞG
:
f∗
(L|
†
E∞,[d]
)<d
{et}H
→
L|G
which
is
an
isomorphism
over
(US
)Q
.
Now
we
have
the
following
important
application
of
the
theory
of
this
paper
(our
second
main
result):
48
Theorem
10.1.
(The
Theta-Convoluted
Scheme-Theoretic
Comparison
Isomorphism)
Suppose
that
we
are
in
the
situation
of
Theorem
9.1.
Let
us
denote
by
ΞG
:
f∗
(L|
†
E∞,[d]
)<d
{et}H
→
L|G
the
evaluation
map
derived
from
[HAT],
Chapter
VI,
Theorem
3.1,
(1).
Write
C
for
the
product
of
all
the
prime
numbers
that
divide
d
or
n.
Then
2d
·
C
·
ΞG
factors
through
L|Θ
G
⊆
L|G
.
Moreover,
the
resulting
morphism
ΞΘ
G
:
f∗
(L|
†
E∞,[d]
)<d
{et}H
→
L|Θ
G
satisﬁes
the
following
properties:
Θ
(1)
ΞΘ
G
is
invertible
over
(US
)Q
.
Moreover,
the
poles
of
the
inverse
of
ΞG
over
US
are
annihilated
by
2d
·
C
2.
(2)
There
exists
a
natural
modiﬁcation
of
the
integral
structure
at
inﬁnity
of
f∗
(L|
†
)<d
{et}H
analogous
to
the
new
integral
structure
at
inﬁnity
of
[HAT],
ChapE∞,[d]
ter
VI,
§1,
with
respect
to
which
ΞΘ
G
is
both
integral
and
invertible
over
SQ
.
(Thus,
in
particular,
relative
to
this
modiﬁed
integral
structure,
ΞΘ
G
will
be
integral
over
all
of
S,
and
invertible
over
S,
except
for
poles
annihilated
by
2d
·
C
2
.)
Moreover,
just
as
the
new
integral
structure
at
inﬁnity
of
[HAT],
Chapter
VI,
§1,
is
given
by
allowing
poles
on
the
1
F
j
/F
j−1
-portion
of
the
push-forward
of
the
form
q
−
d
cj
(Case
Xι
)
(cf.
[HAT],
Chapter
VI,
Theorem
3.1,
(3)),
in
the
present
context,
the
new
integral
structure
at
inﬁnity
is
given
by
allowing
poles
on
the
F
j
/F
j−1
-portion
of
the
push-forward
of
the
form
q
−
d
{cj
(Case
Xι
)−cRem(j,heff
)
(Case
Xι)}
1
(where
Rem(j,
heﬀ
)
is
as
in
Theorem
9.1).
Proof.
Over
(US
)Q
,
everthing
is
immediate.
Let
us
prove
that
2d
·
C
·
ΞG
factors
through
L|Θ
G
⊆
L|G
.
First,
observe
that
2d
·
C
is
suﬃcient
to
cancel
the
poles
of
the
inverse
of
1
the
expression
“d
·

·
hord
−
2
·
ω”
appearing
in
Theorem
9.1.
This
proves
the
existence
of
the
desired
factorization
over
US
.
Thus,
(by
working
over
various
appropriate
ﬁnite,
ﬂat
coverings
of
the
moduli
stack
(M1,0
)Z
)
one
sees
that
to
prove
the
existence
of
the
desired
factorization
over
S,
it
suﬃces
to
prove
its
existence
at
the
points
of
DQ
.
To
this
end,
we
recall
from
the
theory
of
[HAT]
(cf.,
especially,
[HAT],
Chapter
V,
§4,
Theorem
4.8;
[HAT],
Chapter
VI,
§4,
proof
of
Theorem
4.1)
that
to
consider
the
49
restriction
of
sections
of
f∗
(L|
†
E∞,[d]
)<d
{et}H
(as
opposed
to
just
(fH
)∗
LH
)
to
G
amounts
to
considering
the
various
derivatives
of
the
theta
function
in
question.
In
our
case,
this
∂
j
essentially
amounts
to
considering
the
various
derivatives
(U
·
∂U
)
Θ
(where
Θ
is
as
in
§4;
j
=
0,
.
.
.
,
d
−
1).
If
we
then
restrict
such
derivatives
to
G
and
apply
the
appropriate
trivializations
(as
discussed
in
§4,
5),
we
see
that
we
obtain
similar
expressions
to
those
obtained
in
§4,
5
in
the
case
of
Θ
itself.
The
only
diﬀerence
is
that,
in
the
case
of
the
various
derivatives
of
Θ,
the
leading
terms
(i.e.,
terms
involving
the
smallest
powers
of
q)
as
in
the
statement
of
Theorem
5.2
will
be
multiplied
by
various
constant
factors.
The
point
here,
however,
is
that
the
smallest
power
of
q
for
these
derivatives
of
Θ
will
always
be
≤
the
smallest
power
of
q
that
arises
in
the
case
of
the
original
Θ.
Thus,
even
if
we
divide
the
Fourier
coeﬃcients
of
the
restrictions
of
the
derivatives
of
Θ
by
the
Fourier
coeﬃcients
of
the
corresponding
restrictions
of
Θ
itself,
the
result
will
remain
integral.
This
implies
the
existence
of
the
factorization
stated
in
Theorem
10.1.
Next,
we
consider
the
invertibility
of
ΞΘ
G
over
US
.
The
fact
that
the
the
poles
of
the
inverse
of
ΞΘ
over
U
are
annihilated
by
2d
·
C
2
follows
formally
from
the
fact
that
the
S
G
poles
of
the
inverse
of
ΞG
are
annihilated
by
C
(cf.
[HAT],
Chapter
VI,
Theorem
4.1,
(2)),
together
with
the
fact
that
2d
·
C
·
ΞG
is
(by
deﬁnition)
the
composite
of
ΞΘ
G
with
another
morphism.
Finally,
we
consider
the
invertibility
of
ΞΘ
G
at
the
points
of
DQ
.
The
argument
is
essentially
the
same
as
in
the
proof
above
of
the
existence
of
the
factorization
ΞΘ
G
.
Indeed,
just
as
in
the
situation
of
[HAT]
(cf.,
especially,
[HAT],
Chapter
V,
Theorem
4.8;
[HAT],
Chapter
VI,
Theorem
4.1,
(3)),
a
collection
of
local
generators
for
the
new
integral
structure
is
given
by
the
CG
q
−
d
cj
(Case
Xι)
·
ζj−1
1
(for
j
=
1,
.
.
.
,
d),
in
the
present
context,
a
collection
of
local
generators
for
the
new
integral
structure
is
given
by
the
CG
q
−
d
{cj
(Case
Xι
)−cRem(j,heff
)
(Case
Xι
)}
·
ζj−1
1
1
(for
j
=
1,
.
.
.
,
d).
That
is
to
say,
the
“work
done
by
dividing
by
q
d
cj
(Case
Xι
)
”
is
partially
absorbed
by
the
inverse
of
the
theta
convolution,
which
results
in
division
by
1
q
d
cRem(j,heff
)
(Case
Xι
)
(cf.
the
theory
of
§4,
5;
Theorem
9.1).
Thus,
in
the
present
“thetaconvoluted
case,”
the
desired
integral
structure
at
inﬁnity
is
obtained
by
dividing
by
“what’s
left.”
This
completes
the
proof
of
Theorem
10.1.

Remark
1.
In
particular,
we
obtain
that
at
points
at
inﬁnity
ι
where
heﬀ
=
d
—
i.e.,
when
the
restriction
subgroup
G
is
of
multiplicative
type
—
no
modiﬁcation
of
the
integral
structure
at
inﬁnity
is
necessary.
Put
another
way,
at
such
ι:
50
The
“Gaussian
poles”
of
the
“comparison
isomorphism”
deﬁned
by
the
theta-convoluted
evaluation
map
ΞΘ
G
vanish.
(cf.
the
discussion
of
[HAT],
Introduction,
§5.1).
It
is
this
fact/observation
that
formed
the
fundamental
motivation
for
the
author
to
develop
the
theory
of
the
present
paper.
Remark
2.
Just
as
in
[HAT],
Chapter
IX,
§3,
we
constructed
an
“arithmetic
KodairaSpencer
morphism”
from
the
“Hodge-Arakelov
Comparison
Isomorphism”
([HAT],
Chapter
VIII,
Theorem
A)
of
[HAT],
one
can
now
construct
a
theta-convoluted
arithmetic
Kodaira-Spencer
morphism
from
the
theta-convoluted
comparison
isomorphism
of
Theorem
10.1.
The
procedure
is
entirely
formally
analogous
to
what
was
done
in
[HAT],
Chapter
IX,
§3,
i.e.,
one
simply
transports
the
natural
Galois
action
on
the
“étale
side”
(i.e.,
the
right-hand
side)
of
the
comparison
isomorphism
to
the
“de
Rham-theoretic
side”
(i.e.,
the
left-hand
side)
of
the
comparison
isomorphism,
and
considers
the
extent
to
which
this
Galois
action
preserves
the
Hodge
ﬁltration.
We
leave
the
entirely
routine
details
to
the
reader.
Note
that
the
key
technical
point
here
is
that:
The
range
of
the
theta-convoluted
comparison
isomorphism,
i.e.,
∼
−1
⊗
OG
L|Θ
G
=M
admits
a
natural
Galois
action
(arising
from
the
Galois
action
on
G).
Moreover,
we
would
like
to
emphasize
—
relative
to
the
context
of
the
theory
of
[HAT]
(cf.,
especially,
the
discussion
at
the
end
of
[HAT],
Chapter
IX,
§3)
—
that:
The
construction
of
an
arithmetic
Kodaira-Spencer
morphism
in
which
the
Gaussian
poles
have
been
at
least
partially
eliminated
brings
us
one
step
closer
to
the
possibility
of
applying
the
theory
of
[HAT]
and
the
present
paper
to
diophantine
geometry,
as
discussed
in
[HAT],
Introduction,
§5.1,
and
[HAT],
Chapter
IX,
§3.
Remark
3.
Of
course,
in
order
to
complete
the
analogy
with
the
theory
of
[HAT],
one
must
also
study
the
properties
of
the
theta
convolution
at
archimedean
primes.
Just
as
in
the
theory
of
[HAT],
by
pulling
back
the
natural
metric
on
the
étale
side
of
the
thetaconvoluted
comparison
isomorphism
one
obtains
an
étale
metric
on
the
de
Rham
side
of
the
theta-convoluted
comparison
isomorphism.
The
theta-convoluted
arithmetic
KodairaSpencer
morphism
of
Remark
2
will
have
natural
integrality
properties
with
respect
to
this
étale
metric.
Of
course,
in
order
to
make
use
of
this
machinery,
one
would
like
to
have
more
explicit
information
about
the
étale
metric,
in
particular,
concerning
the
metrics
induced
by
the
étale
metric
on
the
various
subquotients
of
the
Hodge
ﬁltration
(on
the
de
Rham
side
of
the
theta-convoluted
comparison
isomorphism).
For
the
Hodge-Arakelov
Comparison
Isomorphism
of
[HAT],
this
sort
of
computation
was
carried
out
in
[HAT],
Chapters
VII
51
and
VIII.
It
is
not
diﬃcult
to
compute
what
happens
to
the
“Hermite,
Legendre,
and
Binomial
Models”
of
the
theory
of
[HAT]
when
one
introduces
the
theta-convolution.
It
is
the
hope
of
the
author
to
give
an
explicit
exposition
of
this
computation
in
a
future
paper.
Bibliography
[DyMc]
H.
Dym
and
H.
P.
McKean,
Fourier
Series
and
Integrals,
Academic
Press
(1972).
[HAT]
S.
Mochizuki,
The
Hodge-Arakelov
Theory
of
Elliptic
Curves:
Global
Discretization
of
Local
Hodge
Theories,
manuscript.
[KL]
D.
S.
Kubert
and
S.
Lang,
Modular
Units,
Grundlehren
der
mathematischen
Wissenschaften
244,
Springer-Verlag
(1981).
[Lang]
S.
Lang,
Algebraic
Number
Theory,
Graduate
Texts
in
Mathematics
110,
SpringerVerlag
(1986).
[MB]
L.
Moret-Bailly,
Pinceaux
de
variétés
abéliennes,
Astérisque
129,
Soc.
Math.
France
(1985).
[Mumf1,2,3]
D.
Mumford,
On
the
equations
deﬁning
abelian
varieties
I,
II,
III,
Invent.
Math.
1
(1966),
pp.
287-354;
2
(1967),
pp.
71-135;
3
(1967),
pp.
215-244.
[Shz]
S.
S.
Shatz,
Group
Schemes,
Formal
Groups,
and
p-divisible
Groups
in
Arithmetic
Geometry,
edited
by
G.
Cornell
and
J.
H.
Silverman,
Springer-Verlag
(1986).
[Zh]
S.
Zhang,
Admissible
pairing
on
a
curve,
Invent.
Math.
112
(1993),
pp.
171-193.
52
